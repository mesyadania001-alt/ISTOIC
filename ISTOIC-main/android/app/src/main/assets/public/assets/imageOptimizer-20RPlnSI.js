const M=r=>new Promise((g,c)=>{if(r.size<512e3&&(r.type==="image/jpeg"||r.type==="image/png")){const n=new FileReader;n.onload=e=>{var o;const t=(o=e.target)==null?void 0:o.result;g({base64:t.split(",")[1],mimeType:r.type})},n.onerror=c,n.readAsDataURL(r);return}const a=new Image,s=URL.createObjectURL(r);a.onload=()=>{let e=a.width,t=a.height;e>t?e>1024&&(t*=1024/e,e=1024):t>1024&&(e*=1024/t,t=1024);const o=document.createElement("canvas");o.width=e,o.height=t;const i=o.getContext("2d");if(!i){URL.revokeObjectURL(s),c(new Error("Canvas context failed"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(a,0,0,e,t),URL.revokeObjectURL(s);const m="image/jpeg",d=o.toDataURL(m,.7).split(",")[1];console.log(`[IMG_OPT] Compressed: ${(d.length*.75/1024).toFixed(2)} KB`),g({base64:d,mimeType:m})},a.onerror=n=>{URL.revokeObjectURL(s),c(new Error("Image corrupt or format unsupported."))},a.src=s});export{M as o};
