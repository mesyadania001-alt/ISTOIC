import{j as e,a2 as Ye,R as ze,w as be,J as fe,aa as ge,z as De,E as Xe,n as Je,ab as Ze,ac as Qe,ad as et,ae as tt,af as st,ag as rt,ah as at,ai as nt,O as ce,X as se,aj as Me,a as it,ak as Ue,al as lt,am as ot,an as ct,ao as dt,ap as xt,aq as ut,ar as me,as as pt,y as Pe,at as Re,au as mt,av as ht,aw as $e,D as He,q as bt,s as ft,G as gt,a1 as kt,B as vt,ax as Nt,ay as jt,az as wt,F as St,aA as Tt,p as yt}from"./vendor-ui-BZMtAjw3.js";import{r}from"./vendor-react-BVD7n4_Z.js";import{g as Et,T as Ee,v as he,H as oe,V as Ge,d as $,U as H,F as G}from"./index-BuNBQ-bW.js";import"./vendor-ai-CXmbpsrq.js";import"./vendor-firebase-Zql6DR9P.js";const Le=[{label:"Sans",value:"Plus Jakarta Sans, sans-serif"},{label:"Mono",value:"JetBrains Mono, monospace"},{label:"Serif",value:"Playfair Display, serif"}],te=({onClick:i,icon:l,isActive:d,ariaLabel:k,className:a,label:x})=>e.jsxs("button",{onMouseDown:T=>{T.preventDefault(),i(T)},className:`
            relative flex items-center justify-center gap-1.5 rounded-lg transition-all duration-200 shrink-0
            ${x?"px-3 w-auto":"w-8"} h-8
            ${d?"bg-black dark:bg-white text-white dark:text-black shadow-md":"text-neutral-500 hover:text-black dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5"} ${a}
        `,"aria-label":k,type:"button",title:k,children:[l,x&&e.jsx("span",{className:"text-[9px] font-black uppercase tracking-wider",children:x})]}),At=[{id:"GRAMMAR",label:"FIX_GRAMMAR",icon:e.jsx(lt,{size:12}),prompt:"Correct grammar and spelling errors. Keep the tone natural."},{id:"FORMAL",label:"PROFESSIONAL",icon:e.jsx(ot,{size:12}),prompt:"Rewrite to be more professional, concise, and executive-ready."},{id:"EXPAND",label:"EXPAND",icon:e.jsx(Ue,{size:12}),prompt:"Elaborate on this point. Add detail and context."},{id:"SUMMARIZE",label:"SUMMARIZE",icon:e.jsx(De,{size:12}),prompt:"Summarize the key points into a concise list or paragraph."}],Ct=({initialContent:i,initialTitle:l,initialTasks:d=[],initialTags:k=[],onSave:a,onDelete:x,onBack:T,language:w,fontSize:f,onFontSizeChange:v})=>{const u=r.useRef(null),R=Et(),h=Ee[R].editor,[_,A]=r.useState(l),[N,I]=r.useState(d),[C,p]=r.useState(k),[b,M]=r.useState(!1),[U,J]=r.useState(!1),[V,Z]=r.useState(!1),[de,O]=r.useState(Le[0].value),[W,F]=r.useState(!1),[y,Q]=r.useState("SAVED"),[ke,ve]=r.useState(0),[Ne,je]=r.useState(0),[K,we]=r.useState({bold:!1,italic:!1,underline:!1,strikethrough:!1,ul:!1,ol:!1,justifyLeft:!1,justifyCenter:!1,justifyRight:!1,code:!1,h1:!1,h2:!1,quote:!1}),[Se,re]=r.useState(!1),[ae,ne]=r.useState(""),[q,xe]=r.useState(!1),[L,Y]=r.useState(null),[ie,le]=r.useState(""),[t,n]=r.useState(null),g=r.useRef(null),o=r.useRef(null),S=N.filter(s=>s.isCompleted).length,z=N.length>0?S/N.length*100:0,E=r.useCallback(()=>{if(!u.current)return;const s=u.current.innerText||"",c=s.trim()===""?0:s.trim().split(/\s+/).length;if(ve(c),je(Math.ceil(c/200)),!b){const m=document.queryCommandValue("formatBlock");we({bold:document.queryCommandState("bold"),italic:document.queryCommandState("italic"),underline:document.queryCommandState("underline"),strikethrough:document.queryCommandState("strikethrough"),ul:document.queryCommandState("insertUnorderedList"),ol:document.queryCommandState("insertOrderedList"),justifyLeft:document.queryCommandState("justifyLeft"),justifyCenter:document.queryCommandState("justifyCenter"),justifyRight:document.queryCommandState("justifyRight"),code:m==="pre",h1:typeof m=="string"&&m.toLowerCase()==="h1",h2:typeof m=="string"&&m.toLowerCase()==="h2",quote:m==="blockquote"});const j=document.queryCommandValue("fontName");if(j){const X=j.replace(/['"]+/g,""),ee=Le.find(ye=>ye.value.includes(X));ee&&O(ee.value)}}},[b]);r.useEffect(()=>{u.current&&(u.current.innerHTML!==i&&(u.current.innerHTML=i||"<div><br></div>"),A(l),I(d),p(k),E())},[i,l,d,k]);const B=r.useCallback((s,c,m,j)=>{a(s,c,m,j),Q("SAVED")},[a]),P=r.useCallback(()=>{var c;Q("SYNCING"),o.current&&clearTimeout(o.current);const s=((c=u.current)==null?void 0:c.innerHTML)||"";o.current=setTimeout(()=>{B(_,s,N,C)},800)},[_,N,C,B]);r.useEffect(()=>{N!==d&&P()},[N,P,d]);const Te=s=>{if(!s.trim())return;const c=[...N,{id:he(),text:s,isCompleted:!1}];I(c)},Fe=s=>{const c=N.map(m=>m.id===s?{...m,isCompleted:!m.isCompleted}:m);I(c)},Be=s=>{const c=N.filter(m=>m.id!==s);I(c)},Ve=s=>{A(s.target.value),Q("SYNCING"),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{u.current&&B(s.target.value,u.current.innerHTML,N,C)},800)};r.useEffect(()=>{const s=()=>{u.current&&(E(),Q("SYNCING"),o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{u.current&&B(_,u.current.innerHTML,N,C)},800))},c=()=>{E()},m=new MutationObserver(s);u.current&&m.observe(u.current,{childList:!0,characterData:!0,subtree:!0});const j=u.current;return j&&(j.addEventListener("input",s),j.addEventListener("keyup",E),j.addEventListener("mouseup",E),j.addEventListener("click",E),document.addEventListener("selectionchange",c)),()=>{m.disconnect(),j&&(j.removeEventListener("input",s),j.removeEventListener("keyup",E),j.removeEventListener("mouseup",E),j.removeEventListener("click",E),document.removeEventListener("selectionchange",c)),o.current&&clearTimeout(o.current)}},[B,E,_,N,C]);const D=(s,c=void 0)=>{b||(document.execCommand(s,!1,c),u.current&&u.current.focus(),E())},Ie=()=>{if(b||!u.current)return;const s=window.getSelection();if(!s||s.rangeCount===0)return;const X=`<pre style="background: #1e1e1e; color: #d4d4d4; padding: 12px; border-radius: 8px; font-family: monospace; overflow-x: auto; white-space: pre-wrap;"><code class="language-javascript">${s.getRangeAt(0).toString()||" // Your code here "}</code></pre><p><br></p>`;document.execCommand("insertHTML",!1,X),E()},We=s=>{if(!b&&(s.ctrlKey||s.metaKey))switch(s.key.toLowerCase()){case"b":s.preventDefault(),D("bold");break;case"i":s.preventDefault(),D("italic");break;case"u":s.preventDefault(),D("underline");break;case"z":s.preventDefault(),D("undo");break;case"y":s.preventDefault(),D("redo");break;case"j":s.preventDefault(),Ie();break}},Ke=()=>{if(b)return;const s=window.getSelection();if(s&&s.rangeCount>0&&!s.isCollapsed){const c=s.toString(),m=s.getRangeAt(0);le(c),n(m)}else le(""),n(null);Y(null),ne(""),re(!0)},_e=async s=>{var m;const c=s||ae;if(!(!c.trim()||q)){xe(!0),Y(null);try{const j=ie||((m=u.current)==null?void 0:m.innerText)||"",ee=`[ROLE: HANISAH_WRITER_MODULE] TASK: ${c} CONTEXT (${ie?"SELECTED_TEXT":"FULL_DOCUMENT"}): """${j}""" OUTPUT_DIRECTIVE: Return ONLY the revised/generated text. LANGUAGE_TARGET: ${Ee[R].meta.label}`,ye=await oe.execute(ee,"gemini-3-flash-preview",[]);Y(ye.text||"Output generation failed.")}catch{Y("Neural processing error.")}finally{xe(!1)}}},Oe=(s="REPLACE")=>{if(!(!L||!u.current)){if(u.current.focus(),t&&ie){const c=window.getSelection();c==null||c.removeAllRanges(),c==null||c.addRange(t),s==="REPLACE"?document.execCommand("insertHTML",!1,L.replace(/\n/g,"<br>")):(t.collapse(!1),document.execCommand("insertHTML",!1," "+L.replace(/\n/g,"<br>")))}else if(s==="REPLACE"){const c=L.split(`
`).filter(m=>m.trim()).map(m=>`<p>${m}</p>`).join("");u.current.innerHTML=c}else document.execCommand("insertHTML",!1,`<br>${L.replace(/\n/g,"<br>")}`);P(),E(),re(!1),Y(null),ne(""),le(""),n(null)}},qe=()=>{var m;if(b)return;if(V){(m=g.current)==null||m.stop(),Z(!1);return}const s=window.SpeechRecognition||window.webkitSpeechRecognition;if(!s){alert("Browser ini tidak mendukung dikte suara.");return}const c=new s;c.lang=Ee[R].meta.code,c.continuous=!0,c.interimResults=!0,c.onstart=()=>Z(!0),c.onend=()=>Z(!1),c.onerror=j=>{console.error("Dictation Error:",j),Z(!1)},c.onresult=j=>{const X=j.results[j.results.length-1],ee=X[0].transcript;X.isFinal&&u.current&&(u.current.focus(),document.execCommand("insertText",!1,ee+" "))},g.current=c,c.start()};return e.jsxs("div",{className:`flex flex-col h-full bg-skin-card ${W?"fixed inset-0 z-[1500] p-0":"relative rounded-[32px] overflow-hidden"}`,children:[e.jsxs("div",{className:"sticky top-0 z-[100] px-4 pb-3 pt-[calc(env(safe-area-inset-top)+0.75rem)] bg-skin-card/80 backdrop-blur-xl border-b border-skin-border flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:T,className:"w-10 h-10 rounded-full bg-skin-surface hover:bg-skin-surface-hover flex items-center justify-center text-skin-muted transition-all active:scale-95 shrink-0","aria-label":"Back to Notes",children:e.jsx(Ye,{size:18,strokeWidth:2.5})}),e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full border text-[9px] font-black uppercase tracking-widest ${y==="SYNCING"?"border-accent/30 text-accent bg-accent/5":"border-skin-border text-skin-muted bg-skin-surface"}`,children:[y==="SYNCING"?e.jsx(ze,{size:10,className:"animate-spin"}):e.jsx(be,{size:10}),y==="SAVED"?h.saved:h.save]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:x,className:"w-10 h-10 flex items-center justify-center rounded-full bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition-all active:scale-95 border border-red-500/20",title:"Delete Note",children:e.jsx(fe,{size:16})}),e.jsxs("button",{onClick:()=>J(!U),className:`relative px-4 py-2 rounded-full flex items-center gap-2 transition-all text-[10px] font-black uppercase tracking-widest border ${U?"bg-blue-500 text-white border-blue-600":"bg-transparent border-skin-border text-skin-muted hover:text-skin-text"}`,title:"Tasks",children:[e.jsx(ge,{size:14}),h.tasks.split(" ")[0],N.length>0&&e.jsx("div",{className:"flex items-center gap-1 ml-1 bg-skin-surface-hover px-1.5 rounded-md",children:e.jsx("span",{className:"text-[9px]",children:N.filter(s=>!s.isCompleted).length})})]}),e.jsx("button",{onClick:()=>F(!W),className:"w-10 h-10 rounded-full flex items-center justify-center text-skin-muted hover:bg-skin-surface transition-all",title:"Toggle Focus",children:W?e.jsx(De,{size:18}):e.jsx(Xe,{size:18})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scroll px-6 md:px-12 lg:px-24 pt-8 pb-32",children:e.jsxs("div",{className:"max-w-3xl mx-auto relative flex flex-col h-full",children:[e.jsxs("div",{className:"mb-6 group shrink-0",children:[e.jsx("input",{type:"text",value:_,onChange:Ve,readOnly:b,placeholder:"Untitled Note",className:"w-full bg-transparent text-4xl md:text-5xl font-black tracking-tight text-skin-text placeholder:text-skin-muted outline-none border-none p-0 leading-tight"}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 text-[9px] tech-mono font-bold text-skin-muted uppercase tracking-widest opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Je,{size:10})," ",Ne," MIN"]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-skin-border"}),e.jsxs("span",{children:[ke," WORDS"]}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-skin-border"}),e.jsx("span",{children:new Date().toLocaleDateString()})]})]}),e.jsx("div",{className:"sticky top-0 z-40 py-3 mb-6 bg-skin-card/95 backdrop-blur-md -mx-4 px-4 transition-all border-b border-skin-border shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto no-scrollbar relative",children:[e.jsxs("div",{className:"flex items-center gap-0.5 px-1 border-r border-skin-border pr-2 mr-1 shrink-0",children:[e.jsx(te,{onClick:()=>D("undo"),icon:e.jsx(Ze,{size:16}),ariaLabel:"Undo",className:"w-9 h-9 rounded-xl"}),e.jsx(te,{onClick:()=>D("redo"),icon:e.jsx(Qe,{size:16}),ariaLabel:"Redo",className:"w-9 h-9 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 px-1 border-r border-skin-border pr-2 mr-1 shrink-0",children:[e.jsx(te,{onClick:()=>D("bold"),icon:e.jsx(et,{size:16}),isActive:K.bold,ariaLabel:"Bold",className:"w-9 h-9 rounded-xl"}),e.jsx(te,{onClick:()=>D("italic"),icon:e.jsx(tt,{size:16}),isActive:K.italic,ariaLabel:"Italic",className:"w-9 h-9 rounded-xl"}),e.jsx(te,{onClick:()=>D("underline"),icon:e.jsx(st,{size:16}),isActive:K.underline,ariaLabel:"Underline",className:"w-9 h-9 rounded-xl"}),e.jsx(te,{onClick:Ie,icon:e.jsx(rt,{size:16}),isActive:K.code,ariaLabel:"Code Block",className:"w-9 h-9 rounded-xl"})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-1 ml-auto shrink-0",children:[e.jsx("button",{onClick:qe,className:`w-9 h-9 flex items-center justify-center rounded-xl transition-all ${V?"bg-red-500 text-white shadow-lg animate-pulse":"bg-skin-surface text-skin-muted hover:text-skin-text hover:bg-skin-surface-hover"}`,title:h.dictate,children:V?e.jsx(at,{size:16}):e.jsx(nt,{size:16})}),e.jsxs("button",{onClick:Ke,disabled:b,className:"flex items-center justify-center gap-2 px-4 h-9 bg-skin-text text-skin-card rounded-xl transition-all active:scale-95 hover:shadow-lg hover:scale-105 group",title:h.magic,children:[e.jsx(ce,{size:16,className:"group-hover:rotate-12 transition-transform"}),e.jsx("span",{className:"text-[9px] font-black uppercase tracking-wider hidden sm:inline",children:"MAGIC"})]})]})]})}),e.jsx("div",{ref:u,contentEditable:!b,suppressContentEditableWarning:!0,onKeyDown:We,className:`
                    min-h-[50vh] flex-1 w-full outline-none text-skin-text selection:bg-accent/20 
                    max-w-none prose dark:prose-invert prose-lg
                    prose-p:leading-loose prose-p:my-4 
                    prose-headings:font-black prose-headings:tracking-tight prose-headings:mb-4 prose-headings:mt-8
                    prose-ul:list-disc prose-ol:list-decimal prose-li:ml-4 prose-li:my-1
                    prose-pre:bg-skin-surface prose-pre:text-sm prose-pre:p-6 prose-pre:rounded-2xl prose-pre:font-mono prose-pre:border prose-pre:border-skin-border
                    prose-blockquote:border-l-4 prose-blockquote:border-accent prose-blockquote:pl-4 prose-blockquote:italic
                    ${b?"cursor-default":"cursor-text"}
                    break-words overflow-x-hidden
                `,style:{fontSize:`${f}px`,fontFamily:de},"data-placeholder":h.placeholder})]})}),e.jsxs("div",{className:`
          absolute top-0 right-0 bottom-0 w-[85%] md:w-80 bg-skin-card/95 backdrop-blur-xl border-l border-skin-border 
          transform transition-transform duration-300 ease-[cubic-bezier(0.23,1,0.32,1)] z-50 flex flex-col shadow-2xl
          ${U?"translate-x-0":"translate-x-full"}
      `,children:[e.jsxs("div",{className:"p-5 border-b border-skin-border flex items-center justify-between bg-skin-surface/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-500/10 text-blue-500 flex items-center justify-center",children:e.jsx(ge,{size:16})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em]",children:h.tasks}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:"w-16 h-1 bg-skin-surface-hover rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-500",style:{width:`${z}%`}})}),e.jsxs("span",{className:"text-[8px] font-mono text-skin-muted",children:[Math.round(z),"%"]})]})]})]}),e.jsx("button",{onClick:()=>J(!1),className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-skin-surface-hover text-skin-muted transition-all",children:e.jsx(se,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2.5 custom-scroll",children:[N.map(s=>e.jsxs("div",{className:`group flex items-start gap-3 p-3 rounded-xl border transition-all ${s.isCompleted?"bg-skin-surface border-transparent opacity-60":"bg-skin-card border-skin-border hover:border-blue-500/30"}`,children:[e.jsx("button",{onClick:()=>!b&&Fe(s.id),className:`mt-0.5 w-5 h-5 rounded-md border flex items-center justify-center transition-all shrink-0 ${s.isCompleted?"bg-blue-500 border-blue-500 text-white":"border-neutral-300 dark:border-white/20 hover:border-blue-500"}`,children:s.isCompleted&&e.jsx(be,{size:12,strokeWidth:3})}),e.jsx("span",{className:`text-xs font-medium leading-relaxed flex-1 break-words ${s.isCompleted?"text-skin-muted line-through decoration-neutral-300":"text-skin-text"}`,children:s.text}),!b&&e.jsx("button",{onClick:()=>Be(s.id),className:"w-6 h-6 flex items-center justify-center text-skin-muted hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-all opacity-0 group-hover:opacity-100",title:"Delete Task",children:e.jsx(fe,{size:12})})]},s.id)),N.length===0&&e.jsx("div",{className:"text-center py-10 text-[10px] font-black text-skin-muted uppercase tracking-widest opacity-50",children:"NO_TASKS_LINKED"})]}),!b&&e.jsx("div",{className:"p-4 border-t border-skin-border bg-skin-surface/50",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault();const c=s.target.taskInput;Te(c.value),c.value=""},className:"flex gap-2",children:[e.jsx("input",{name:"taskInput",placeholder:"Add new task...",className:"flex-1 bg-skin-surface border border-skin-border rounded-xl px-4 py-2.5 text-xs focus:outline-none focus:border-blue-500 transition-all",autoComplete:"off"}),e.jsx("button",{type:"submit",className:"w-10 flex items-center justify-center bg-skin-text text-skin-card rounded-xl hover:scale-105 active:scale-95 transition-all shadow-lg",children:e.jsx(Me,{size:18})})]})})]}),Se&&e.jsx("div",{className:"fixed inset-0 z-[2500] flex items-center justify-center p-4 bg-black/80 backdrop-blur-xl animate-fade-in",children:e.jsxs("div",{className:"w-full max-w-4xl bg-skin-card rounded-[32px] border border-skin-border overflow-hidden shadow-2xl flex flex-col md:flex-row h-[85vh] md:h-[600px] ring-1 ring-skin-border",children:[e.jsxs("div",{className:"w-full md:w-[400px] flex flex-col border-r border-skin-border bg-skin-surface/50",children:[e.jsxs("div",{className:"p-6 border-b border-skin-border flex items-center justify-between shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-orange-500/10 flex items-center justify-center text-orange-500 border border-orange-500/20",children:e.jsx(it,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-skin-text",children:"HANISAH_WRITER"}),e.jsx("p",{className:"text-[9px] text-skin-muted font-mono uppercase tracking-widest mt-0.5",children:"NEURAL EDITING MODULE"})]})]}),e.jsx("button",{onClick:()=>re(!1),className:"w-8 h-8 rounded-full hover:bg-skin-surface-hover flex items-center justify-center text-skin-muted transition-all",children:e.jsx(se,{size:18})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scroll p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[9px] font-black text-skin-muted uppercase tracking-[0.2em] pl-1",children:"QUICK_PROTOCOLS"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:At.map(s=>e.jsx("button",{onClick:()=>_e(s.prompt),disabled:q,className:"p-3 rounded-xl bg-skin-card border border-skin-border hover:border-orange-500/30 hover:bg-orange-500/5 transition-all text-left group",children:e.jsxs("div",{className:"flex items-center gap-2 text-skin-muted group-hover:text-orange-500 mb-1",children:[s.icon,e.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:s.label})]})},s.id))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-[9px] font-black text-skin-muted uppercase tracking-[0.2em] pl-1",children:"CUSTOM_DIRECTIVE"}),e.jsx("textarea",{value:ae,onChange:s=>ne(s.target.value),className:"w-full h-24 bg-skin-card rounded-xl p-4 text-xs font-medium border border-skin-border focus:outline-none focus:border-orange-500/50 resize-none transition-all placeholder:text-skin-muted",placeholder:"E.g., Rewrite this to be funnier..."}),e.jsxs("button",{onClick:()=>_e(),disabled:!ae||q,className:"w-full py-4 bg-skin-text text-skin-card rounded-xl text-[10px] font-black uppercase tracking-widest flex items-center justify-center gap-2 transition-all shadow-lg hover:scale-[1.02] active:scale-95 disabled:opacity-50",children:[q?e.jsx(ze,{size:14,className:"animate-spin"}):e.jsx(Ue,{size:14})," ",q?"SYNTHESIZING...":"EXECUTE"]})]})]})]}),e.jsxs("div",{className:"flex-1 bg-skin-surface flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"h-14 border-b border-skin-border flex items-center justify-between px-6 bg-skin-card",children:e.jsx("span",{className:"text-[9px] font-black text-skin-muted uppercase tracking-[0.2em]",children:"RESULT_MATRIX"})}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scroll p-6 md:p-8",children:L?e.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none text-skin-text leading-relaxed bg-skin-card p-6 rounded-2xl border border-skin-border shadow-sm",dangerouslySetInnerHTML:{__html:L.replace(/\n/g,"<br/>")}}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center gap-4",children:[e.jsx(ce,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"AWAITING_INSTRUCTION"})]})}),L&&e.jsxs("div",{className:"p-4 border-t border-skin-border bg-skin-card flex gap-3",children:[e.jsx("button",{onClick:()=>Oe("INSERT"),className:"flex-1 py-3 bg-skin-surface hover:bg-skin-surface-hover text-skin-text rounded-xl text-[9px] font-black uppercase tracking-widest transition-all",children:"INSERT BELOW"}),e.jsx("button",{onClick:()=>Oe("REPLACE"),className:"flex-1 py-3 bg-orange-600 hover:bg-orange-500 text-white rounded-xl text-[9px] font-black uppercase tracking-widest transition-all shadow-md",children:"REPLACE SELECTION"})]})]})]})})]})},Rt=({isSelectionMode:i,selectedCount:l,totalVisibleCount:d,isViewingArchive:k,selectedNotes:a,onSelectAll:x,onDeselectAll:T,onDeleteSelected:w,onArchiveSelected:f,onPinSelected:v,onCancel:u})=>{const R=i||l>0,h=l===d&&d>0,_=()=>{if(a.length===0)return;const A=JSON.stringify(a,null,2),N="data:application/json;charset=utf-8,"+encodeURIComponent(A),I=`istoic_vault_export_${new Date().toISOString().slice(0,10)}.json`,C=document.createElement("a");C.setAttribute("href",N),C.setAttribute("download",I),C.click()};return e.jsx("div",{className:`
            fixed transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) left-1/2 -translate-x-1/2
            z-[2000] 
            bottom-24 md:bottom-10 w-auto min-w-[320px] max-w-[95vw]
            ${R?"translate-y-0 opacity-100 scale-100 pointer-events-auto":"translate-y-[150%] opacity-0 scale-90 pointer-events-none"}
        `,children:e.jsxs("div",{className:"bg-white/95 dark:bg-[#0a0a0b]/95 backdrop-blur-2xl border border-black/5 dark:border-white/10 shadow-[0_20px_50px_-10px_rgba(0,0,0,0.5)] rounded-[32px] p-2 pr-3 flex items-center gap-3 ring-1 ring-white/10 pointer-events-auto",onClick:A=>A.stopPropagation(),children:[e.jsxs("button",{onClick:A=>{A.stopPropagation(),h?T():x()},type:"button",className:`
                        h-12 px-5 rounded-[24px] flex flex-col items-center justify-center min-w-[70px] shadow-sm transition-all active:scale-95 border
                        ${h?"bg-black dark:bg-white text-white dark:text-black border-transparent":"bg-zinc-100 dark:bg-white/5 border-black/5 dark:border-white/5 text-neutral-500 hover:text-black dark:hover:text-white"}
                    `,children:[h?e.jsx(ct,{size:18}):e.jsx(dt,{size:18}),e.jsx("span",{className:"text-[7px] font-black mt-0.5 uppercase tracking-widest",children:h?"NONE":"ALL"})]}),e.jsxs("div",{className:"flex flex-col px-1 min-w-[50px]",children:[e.jsx("span",{className:"text-[8px] font-black text-neutral-400 uppercase tracking-widest",children:"SELECTED"}),e.jsxs("span",{className:"text-xl font-black italic leading-none text-black dark:text-white font-sans",children:[l,e.jsxs("span",{className:"text-neutral-400 text-sm opacity-50",children:["/",d]})]})]}),e.jsx("div",{className:"w-[1px] h-8 bg-black/5 dark:bg-white/10 mx-1"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{icon:e.jsx(xt,{size:18}),label:"PIN",onClick:v,disabled:l===0}),e.jsx(ue,{icon:k?e.jsx(ut,{size:18}):e.jsx(me,{size:18}),label:k?"RESTORE":"ARCHIVE",onClick:f,disabled:l===0}),e.jsx(ue,{icon:e.jsx(pt,{size:18}),label:"EXPORT",onClick:_,disabled:l===0}),e.jsx("div",{className:"w-[1px] h-6 bg-black/5 dark:bg-white/5 mx-1"}),e.jsx(ue,{icon:e.jsx(Pe,{size:18}),label:"PURGE",onClick:w,variant:"danger",disabled:l===0})]}),e.jsx("button",{onClick:A=>{A.stopPropagation(),u()},type:"button",className:"w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-white/10 flex items-center justify-center text-neutral-400 hover:text-black dark:hover:text-white transition-all ml-1 active:scale-90",children:e.jsx(se,{size:14})})]})})},ue=({icon:i,label:l,onClick:d,variant:k="normal",disabled:a})=>e.jsx("button",{onClick:x=>{x.stopPropagation(),x.preventDefault(),a||d()},disabled:a,type:"button",className:`relative w-12 h-12 rounded-[20px] flex items-center justify-center transition-all duration-300 group hover:scale-105 active:scale-95 ${a?"opacity-30 cursor-not-allowed text-neutral-500":k==="danger"?"text-red-500 bg-red-500/10 hover:bg-red-500 hover:text-white hover:shadow-lg hover:shadow-red-500/20":"text-neutral-500 hover:text-accent hover:bg-accent/10 hover:shadow-lg hover:shadow-accent/10"}`,title:l,children:e.jsx("div",{className:"relative z-10",children:i})}),Ae=(i,l)=>{if(!i)return l;try{let d=i.replace(/```json|```/g,"").trim();try{return JSON.parse(d)}catch{}const k=i.match(/\[\s*\{[\s\S]*\}\s*\]/);if(k)try{return JSON.parse(k[0])}catch{}const a=i.match(/\{[\s\S]*\}/);if(a)try{return JSON.parse(a[0])}catch{}return console.warn("Agent JSON Extraction Failed. Raw:",i.slice(0,100)),l}catch(d){return console.error("Critical Parse Error",d),l}},Ce={async runOrganizer(i,l){const d=i.map(a=>({id:a.id,title:a.title,content:a.content.slice(0,300),tags:a.tags,created:a.created})),k=`
        [ROLE: ${l==="hanisah"?"Creative Librarian":"Strict Archivist"}]
        [TASK: ORGANIZE_VAULT]
        Analyze these notes. Return a JSON Array of objects with updates.
        
        RULES:
        1. "title": Rename to be professional, concise, and descriptive (Max 5 words).
        2. "tags": Add 2-3 relevant UPPERCASE tags. Merge synonyms.
        3. "is_archived": Set to true IF note is older than 30 days AND seems inactive/done.
        4. STRICTLY OUTPUT RAW JSON. NO MARKDOWN. NO CONVERSATION.
        
        INPUT DATA:
        ${JSON.stringify(d)}

        OUTPUT FORMAT:
        [
            { "id": "uuid", "title": "New Title", "tags": ["TAG1"], "is_archived": boolean }
        ]
        `;try{const a=await oe.execute(k,"gemini-3-flash-preview");return Ae(a.text,[])}catch(a){return console.error("Organizer Agent Failed",a),[]}},async runInsight(i){const d=`
        [TASK: GENERATE_INSIGHTS]
        Analyze the user's note titles and tags to find patterns.
        
        DATA:
        ${i.map(x=>{var T;return`${x.title} [Tags: ${(T=x.tags)==null?void 0:T.join(", ")}]`}).join(`
`)}

        OUTPUT FORMAT (Markdown):
        ## ðŸ§  V20 Cognitive Patterns
        - **Top Themes**: [List top 3 topics]
        - **Productivity Rhythm**: [Observation based on volume]
        - **Missing Links**: [What is the user forgetting to document?]
        
        Provide a brief, high-level strategic summary.
        `;return((await oe.execute(d,"gemini-3-pro-preview")).text||"No insights generated.").replace(/^> .*$/gm,"").trim()},async runActionExtractor(i){const d=i.sort((a,x)=>new Date(x.updated).getTime()-new Date(a.updated).getTime()).slice(0,10).map(a=>({id:a.id,content:a.content.slice(0,500)})),k=`
        [TASK: EXTRACT_TASKS_AND_PRIORITIZE]
        Scan content for action items, todos, or implied tasks.
        
        DATA:
        ${JSON.stringify(d)}

        RULES:
        1. Identify tasks.
        2. Assign priority labels: [URGENT], [HIGH], [NORMAL], [LATER].
        3. Prepend the label to the task text.

        OUTPUT JSON ONLY:
        [ { "text": "[URGENT] Fix server bug", "sourceNoteId": "id" } ]
        `;try{const a=await oe.execute(k,"gemini-3-flash-preview");return Ae(a.text,[])}catch{return[]}},async runMemoryRecall(i,l,d){if(!i||i.length<20)return[];const k=l.filter(x=>x.id!==d).map(x=>{var T;return{id:x.id,text:`${x.title} ${(T=x.tags)==null?void 0:T.join(" ")} ${x.content.slice(0,100)}`}}),a=`
        [TASK: FIND_RELATED]
        Current Context: "${i.slice(0,300)}..."
        
        Database:
        ${JSON.stringify(k)}

        Return JSON Array of IDs for notes that are highly relevant/related to the context. Max 3 IDs.
        Format: ["id1", "id2"]
        `;try{const x=await oe.execute(a,"gemini-3-flash-preview");return Ae(x.text,[])}catch{return[]}}},It=({isOpen:i,onClose:l,notes:d,onApplyUpdates:k,onAddTasks:a})=>{const[x,T]=r.useState("MENU"),[w,f]=r.useState(null),[v,u]=r.useState(null),[R,h]=r.useState(!1),[_,A]=r.useState(0);r.useEffect(()=>(i?(T("MENU"),f(null),u(null),document.body.style.overflow="hidden"):document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]);const N=async p=>{h(!0),u(p),T("RESULT"),f(null);try{if(p==="ORGANIZER"){const b=await Ce.runOrganizer(d,"hanisah");f(b)}else if(p==="INSIGHT"){const b=await Ce.runInsight(d);f(b)}else if(p==="TASKS"){const b=await Ce.runActionExtractor(d);f(b)}}catch(b){console.error(b),f({error:"Agent execution failed."})}finally{h(!1)}},I=async()=>{h(!0),u("INDEXING"),T("RESULT"),A(0);try{const p=await Ge.indexNotes(d,(b,M)=>{A(Math.round(b/M*100))});f(`Successfully indexed ${p} notes into local vector database.`)}catch(p){f({error:`Indexing failed: ${p.message}`})}finally{h(!1)}},C=()=>{w&&(v==="ORGANIZER"?(k(w),l()):v==="TASKS"&&(a(w),l()))};return i?e.jsx("div",{className:"fixed inset-0 z-[2500] flex items-end md:items-center justify-center p-0 md:p-6 bg-black/80 backdrop-blur-xl animate-fade-in",children:e.jsxs("div",{className:"w-full h-[100dvh] md:h-[650px] md:max-w-5xl bg-white dark:bg-[#0a0a0b] rounded-none md:rounded-[40px] border-t md:border border-white/10 shadow-2xl overflow-hidden flex flex-col md:flex-row relative transition-transform duration-500 ease-out translate-y-0 animate-slide-up",children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 z-50 p-2 rounded-full bg-black/5 dark:bg-white/10 hover:bg-black/10 dark:hover:bg-white/20 text-neutral-500 hover:text-black dark:hover:text-white transition-all hidden md:block active:scale-90",children:e.jsx(se,{size:20})}),e.jsxs("div",{className:`
                    w-full md:w-[350px] flex flex-col bg-zinc-50 dark:bg-[#050505] border-r border-black/5 dark:border-white/5
                    ${x==="MENU"?"flex h-full":"hidden md:flex"}
                `,children:[e.jsx("div",{className:"p-8 pb-4 relative pt-safe md:pt-8",children:e.jsxs("div",{className:"flex items-center justify-between mt-4 md:mt-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-500 border border-purple-500/20 shadow-sm",children:e.jsx(Re,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.2em] text-black dark:text-white",children:"NEURAL_AGENTS"}),e.jsx("p",{className:"text-[9px] text-neutral-500 font-mono uppercase tracking-widest mt-0.5",children:"AUTOMATED VAULT OPS"})]})]}),e.jsx("button",{onClick:l,className:"md:hidden p-2 text-neutral-400 bg-white/5 rounded-full active:scale-90",children:e.jsx(se,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scroll pb-safe",children:[e.jsx(pe,{id:"ORGANIZER",label:"AUTO_LIBRARIAN",desc:"Rename, tag, and archive notes intelligently.",icon:e.jsx(mt,{size:18}),color:"text-blue-500 bg-blue-500/10 border-blue-500/20",onClick:()=>N("ORGANIZER"),isActive:v==="ORGANIZER"}),e.jsx(pe,{id:"INSIGHT",label:"PATTERN_RECOGNITION",desc:"Discover hidden themes and connections.",icon:e.jsx(ht,{size:18}),color:"text-amber-500 bg-amber-500/10 border-amber-500/20",onClick:()=>N("INSIGHT"),isActive:v==="INSIGHT"}),e.jsx(pe,{id:"TASKS",label:"ACTION_EXTRACTOR",desc:"Convert note content into actionable tasks.",icon:e.jsx($e,{size:18}),color:"text-emerald-500 bg-emerald-500/10 border-emerald-500/20",onClick:()=>N("TASKS"),isActive:v==="TASKS"}),e.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 my-2"}),e.jsx(pe,{id:"INDEXING",label:"SEMANTIC_INDEXING",desc:"Embed notes into vector database for AI search.",icon:e.jsx(He,{size:18}),color:"text-pink-500 bg-pink-500/10 border-pink-500/20",onClick:I,isActive:v==="INDEXING"})]})]}),e.jsxs("div",{className:`
                    flex-1 flex flex-col bg-white dark:bg-[#0a0a0b] relative h-full
                    ${x==="RESULT"?"flex":"hidden md:flex"}
                `,children:[e.jsxs("div",{className:"md:hidden h-16 border-b border-black/5 dark:border-white/5 flex items-center justify-between px-4 shrink-0 bg-white dark:bg-[#0a0a0b] pt-safe",children:[e.jsxs("button",{onClick:()=>T("MENU"),className:"flex items-center gap-2 text-neutral-500 text-xs font-bold uppercase tracking-widest bg-zinc-100 dark:bg-white/5 px-3 py-1.5 rounded-lg active:scale-95",children:[e.jsx(bt,{size:16})," BACK_TO_MENU"]}),e.jsx("button",{onClick:l,className:"p-2 text-neutral-400 bg-white/5 rounded-full active:scale-90",children:e.jsx(se,{size:18})})]}),R?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-4 border-purple-500/20 border-t-purple-500 animate-spin"}),e.jsx(ce,{size:24,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-purple-500 animate-pulse"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-black uppercase tracking-[0.2em] text-black dark:text-white mb-2",children:v==="INDEXING"?"MAPPING_VECTOR_SPACE":"AGENT_WORKING"}),e.jsx("p",{className:"text-[10px] font-mono text-neutral-500 uppercase tracking-widest",children:v==="INDEXING"?`Embedding Progress: ${_}%`:`Processing ${d.length} Neural Nodes...`})]})]}):w?e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden animate-slide-up relative",children:[e.jsx("div",{className:"p-6 md:p-8 border-b border-black/5 dark:border-white/5 bg-zinc-50/50 dark:bg-white/[0.02] shrink-0",children:e.jsxs("h3",{className:"text-xl font-black italic uppercase tracking-tighter text-black dark:text-white",children:[v,"_REPORT"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scroll p-6 md:p-8 pb-32 md:pb-8",children:[v==="INDEXING"&&typeof w=="string"&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-emerald-500/10 text-emerald-500 flex items-center justify-center mb-2 animate-bounce",children:e.jsx(be,{size:32})}),e.jsx("h3",{className:"text-lg font-black uppercase tracking-tight text-emerald-500",children:"INDEXING COMPLETE"}),e.jsx("p",{className:"text-xs text-neutral-500 font-medium max-w-sm",children:w})]}),v==="ORGANIZER"&&Array.isArray(w)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-xs font-medium text-neutral-500 mb-4",children:[w.length," updates proposed."]}),w.map((p,b)=>{var M;return e.jsxs("div",{className:"p-4 rounded-xl border border-black/5 dark:border-white/5 bg-white dark:bg-white/5 flex items-start gap-4",children:[e.jsx("div",{className:"mt-1 w-6 h-6 rounded-full bg-blue-500/10 text-blue-500 flex items-center justify-center shrink-0 border border-blue-500/20",children:e.jsx(be,{size:12})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-[10px] font-mono text-neutral-400",children:["ID: ",p.id.slice(0,6)]}),e.jsx(ft,{size:10,className:"text-neutral-600"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-wider text-blue-500",children:p.title})]}),e.jsxs("div",{className:"flex gap-1 mt-2",children:[(M=p.tags)==null?void 0:M.map(U=>e.jsx("span",{className:"text-[8px] font-bold px-1.5 py-0.5 rounded bg-zinc-100 dark:bg-white/10 text-neutral-500 uppercase",children:U},U)),p.is_archived&&e.jsx("span",{className:"text-[8px] font-bold px-1.5 py-0.5 rounded bg-orange-500/10 text-orange-500 uppercase border border-orange-500/20",children:"ARCHIVE"})]})]})]},b)})]}),v==="INSIGHT"&&typeof w=="string"&&e.jsx("div",{className:"prose dark:prose-invert prose-sm max-w-none text-sm font-medium leading-relaxed bg-white dark:bg-white/5 p-6 rounded-2xl border border-black/5 dark:border-white/5",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:w})}),v==="TASKS"&&Array.isArray(w)&&e.jsx("div",{className:"space-y-3",children:w.map((p,b)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl border border-black/5 dark:border-white/5 bg-emerald-500/5 border-emerald-500/20",children:[e.jsx("div",{className:"w-5 h-5 rounded border border-emerald-500/30 flex items-center justify-center"}),e.jsx("span",{className:"text-xs font-medium text-black dark:text-white",children:p.text})]},b))})]}),v!=="INSIGHT"&&v!=="INDEXING"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 border-t border-black/5 dark:border-white/5 bg-white/95 dark:bg-[#0a0a0b]/95 backdrop-blur-md shrink-0 pb-safe z-20",children:e.jsx("button",{onClick:C,className:"w-full py-4 bg-black dark:bg-white text-white dark:text-black rounded-xl font-black uppercase text-[10px] tracking-[0.25em] hover:scale-[1.01] active:scale-95 transition-all shadow-lg",children:"APPLY_CHANGES"})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center opacity-30 gap-4 p-8 text-center",children:[e.jsx(ce,{size:48,strokeWidth:1}),e.jsx("p",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"SELECT_AGENT_PROTOCOL"})]})]})]})}):null},pe=({label:i,desc:l,icon:d,color:k,onClick:a,isActive:x})=>e.jsx("button",{onClick:a,className:`w-full text-left p-4 rounded-2xl border transition-all group duration-300 active:scale-95 ${x?"bg-white dark:bg-white/10 border-black/10 dark:border-white/20 shadow-md transform scale-[1.02]":"bg-transparent border-transparent hover:bg-white/60 dark:hover:bg-white/5 hover:border-black/5 dark:hover:border-white/5"}`,children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 transition-all ${x?k:"bg-zinc-200 dark:bg-white/5 text-neutral-400 group-hover:text-black dark:group-hover:text-white"}`,children:d}),e.jsxs("div",{children:[e.jsx("h4",{className:`text-[10px] font-black uppercase tracking-widest mb-1 ${x?"text-black dark:text-white":"text-neutral-500 group-hover:text-black dark:group-hover:text-white"}`,children:i}),e.jsx("p",{className:"text-[9px] font-medium text-neutral-400 leading-relaxed",children:l})]})]})}),Mt=({notes:i,setNotes:l})=>{const[d,k]=r.useState(""),[a,x]=r.useState(null),[T,w]=r.useState("grid"),[f,v]=r.useState(new Set),[u,R]=r.useState(!1),[h,_]=r.useState("all"),[A,N]=r.useState(16),[I,C]=r.useState(!1),[p,b]=r.useState(!1),[M,U]=r.useState([]),[J,V]=r.useState(!1),[Z,de]=r.useState(!1),[O,W]=r.useState(null);r.useEffect(()=>{a&&!i.find(t=>t.id===a)&&(x(null),w("grid"))},[i,a]),r.useEffect(()=>{if(!d.trim()||!p){U([]),V(!1);return}const t=setTimeout(async()=>{V(!0);try{const n=await Ge.search(d,20);U(n)}catch(n){console.error("Vector search error",n)}finally{V(!1)}},600);return()=>clearTimeout(t)},[d,p]);const F=r.useMemo(()=>p&&d.trim()?M.length===0&&!J?[]:M.map(n=>i.find(g=>g.id===n)).filter(n=>!!n).filter(n=>h==="archived"?n.is_archived:!n.is_archived):i.filter(t=>{var o;const n=t.title.toLowerCase().includes(d.toLowerCase())||t.content.toLowerCase().includes(d.toLowerCase())||((o=t.tags)==null?void 0:o.some(S=>S.toLowerCase().includes(d.toLowerCase()))),g=h==="archived"?t.is_archived:!t.is_archived;return n&&g}).sort((t,n)=>t.is_pinned&&!n.is_pinned?-1:!t.is_pinned&&n.is_pinned?1:new Date(n.updated).getTime()-new Date(t.updated).getTime()),[i,d,h,p,M,J]),y=r.useMemo(()=>i.find(t=>t.id===a),[i,a]),Q=()=>{$.logAction(H.NOTES_BTN_CREATE,G.NOTE_CREATE,"NEW_NOTE");const t={id:he(),title:"",content:"",tags:[],created:new Date().toISOString(),updated:new Date().toISOString(),tasks:[],is_pinned:!1,is_archived:!1};l(n=>[t,...n]),x(t.id),w("editor")},ke=()=>{$.logAction(H.NOTES_INPUT_SEARCH,G.NOTE_SEARCH,"FOCUS"),C(!0)},ve=()=>{const t=h==="all"?"archived":"all";$.logAction(H.NOTES_BTN_FILTER_ARCHIVE,G.NOTE_SEARCH,t.toUpperCase()),_(t)},Ne=()=>{$.logAction(H.NOTES_BTN_BATCH_MODE,G.NOTE_BATCH_ACTION,u?"OFF":"ON"),R(!u),u&&v(new Set)},je=t=>{u?ae(t.id):($.logAction(H.NOTES_CARD_ITEM,G.NOTE_UPDATE,"OPEN_EDITOR"),x(t.id),w("editor"))},K=(t,n)=>{t&&(t.stopPropagation(),t.preventDefault()),W(n)},we=()=>{O&&($.logAction(H.NOTES_BTN_DELETE_ITEM,G.NOTE_DELETE,O)&&(l(t=>t.filter(n=>n.id!==O)),a===O&&(x(null),w("grid"))),W(null))},Se=r.useCallback((t,n,g,o)=>{a&&l(S=>S.map(z=>z.id===a?{...z,content:n,title:t.trim()||"Untitled Note",tasks:g||z.tasks,tags:o||z.tags,updated:new Date().toISOString()}:z))},[a,l]),re=r.useCallback(()=>{if(a){const t=i.find(n=>n.id===a);t&&!t.title.trim()&&(!t.content||t.content==="<div><br></div>")&&(!t.tasks||t.tasks.length===0)&&l(g=>g.filter(o=>o.id!==a))}x(null),w("grid")},[a,i,l]),ae=t=>{const n=new Set(f);n.has(t)?n.delete(t):n.add(t),v(n)},ne=r.useCallback(()=>{const t=f.size;if(t===0)return;const n=new Set(f);window.confirm(`âš ï¸ SYSTEM PURGE PROTOCOL

You are about to PERMANENTLY DELETE ${t} selected item(s).

This is a destructive action. Data will be unrecoverable.

Proceed with purge?`)&&($.logAction(H.NOTES_BTN_BATCH_MODE,G.NOTE_BATCH_ACTION,"PURGE_EXECUTE",{count:t}),l(o=>o.filter(S=>!n.has(S.id))),v(new Set),R(!1))},[f,l]),q=r.useCallback(()=>{$.logAction(H.NOTES_BTN_BATCH_MODE,G.NOTE_BATCH_ACTION,"ARCHIVE_MANY");const g=!i.filter(o=>f.has(o.id)).every(o=>o.is_archived);l(o=>o.map(S=>f.has(S.id)?{...S,is_archived:g}:S)),v(new Set),R(!1)},[i,f,l]),xe=r.useCallback(()=>{$.logAction(H.NOTES_BTN_BATCH_MODE,G.NOTE_BATCH_ACTION,"PIN_MANY");const g=!i.filter(o=>f.has(o.id)).every(o=>o.is_pinned);l(o=>o.map(S=>f.has(S.id)?{...S,is_pinned:g}:S)),v(new Set),R(!1)},[i,f,l]),L=r.useCallback(()=>{const t=F.map(o=>o.id),n=t.length>0&&t.every(o=>f.has(o)),g=new Set(f);n?t.forEach(o=>g.delete(o)):t.forEach(o=>g.add(o)),v(g)},[F,f]),Y=t=>{l(n=>n.map(g=>{const o=t.find(S=>S.id===g.id);return o?{...g,...o,updated:new Date().toISOString()}:g}))},ie=t=>{const n={id:he(),title:`AUTO-TASKS ${new Date().toLocaleDateString()}`,content:"Tasks extracted from recent notes.",tags:["AUTO","TASKS"],created:new Date().toISOString(),updated:new Date().toISOString(),tasks:t.map(g=>({id:he(),text:g.text,isCompleted:!1})),is_pinned:!0};l(g=>[n,...g])},le=r.useMemo(()=>{if(!O)return"";const t=i.find(n=>n.id===O);return(t==null?void 0:t.title)||"Untitled Note"},[O,i]);return e.jsxs("div",{className:"h-[calc(100dvh-2rem)] md:h-[calc(100vh-2rem)] flex flex-col animate-fade-in bg-noise overflow-hidden",children:[e.jsxs("div",{className:"px-4 md:px-8 lg:px-12 pb-4 pt-[calc(env(safe-area-inset-top)+1.5rem)] md:pt-8 shrink-0 flex flex-col xl:flex-row justify-between items-start xl:items-end gap-6 z-20",children:[e.jsxs("div",{className:"space-y-3 w-full xl:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 animate-slide-down",children:[e.jsx("div",{className:"px-3 py-1 rounded-lg bg-accent/10 border border-accent/20 tech-mono text-[9px] font-black uppercase text-accent tracking-[0.3em]",children:"SECURE_VAULT_v2"}),e.jsxs("span",{className:"text-skin-muted tech-mono text-[9px] font-black uppercase tracking-widest flex items-center gap-1.5",children:[e.jsx(He,{size:10})," ENCRYPTED_STORAGE"]})]}),e.jsxs("h1",{className:"text-5xl md:text-6xl lg:text-7xl font-black italic tracking-tighter text-skin-text leading-[0.85] uppercase drop-shadow-sm animate-slide-down",style:{animationDelay:"50ms"},children:["SMART ",e.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-accent to-purple-500 animate-gradient-text",children:"VAULT"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full xl:w-auto animate-slide-down",style:{animationDelay:"100ms"},children:[e.jsxs("div",{className:`relative transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] ${I?"flex-1 md:w-96":"flex-1 md:w-64"}`,children:[e.jsx("input",{type:"text",value:d,onChange:t=>k(t.target.value),onFocus:ke,onBlur:()=>C(!1),placeholder:I?p?"NEURAL SEARCH...":"KEYWORD SEARCH...":"SEARCH...",className:`w-full h-12 bg-skin-card border rounded-2xl pl-11 pr-12 text-[10px] font-black uppercase tracking-widest focus:outline-none transition-all placeholder:text-skin-muted sheen
                        ${p?"border-purple-500/50 shadow-[0_0_20px_rgba(168,85,247,0.2)] text-purple-500":"border-skin-border focus:border-accent/50 focus:shadow-[0_0_30px_-10px_var(--accent-glow)] text-skin-text"}
                     `}),e.jsx(gt,{className:`absolute left-4 top-1/2 -translate-y-1/2 transition-colors ${p?"text-purple-500":I?"text-accent":"text-skin-muted"}`,size:16}),e.jsx("button",{onClick:()=>{b(!p),k("")},className:`absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded-lg transition-all ${p?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"text-skin-muted hover:text-skin-text hover:bg-skin-surface"}`,title:"Toggle Neural Search",children:J?e.jsx(kt,{size:14,className:"animate-spin"}):e.jsx(vt,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>de(!0),className:"w-12 h-12 flex items-center justify-center rounded-2xl border bg-purple-500/10 text-purple-500 border-purple-500/20 hover:bg-purple-500/20 hover:border-purple-500/50 hover:text-purple-400 transition-all shadow-sm active:scale-90 group",title:"Neural Agents",children:e.jsx(Re,{size:20,className:"group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:Ne,className:`w-12 h-12 flex items-center justify-center rounded-2xl border transition-all active:scale-90 group ${u?"bg-accent text-black border-accent shadow-[0_0_20px_var(--accent-glow)]":"bg-skin-card border-skin-border text-skin-muted hover:text-skin-text hover:border-skin-highlight"}`,title:"Batch Select",children:e.jsx(ge,{size:18,className:"group-hover:scale-110 transition-transform"})}),e.jsx("button",{onClick:ve,className:`w-12 h-12 flex items-center justify-center rounded-2xl border transition-all active:scale-90 group ${h==="archived"?"bg-orange-500 text-white border-orange-500 shadow-lg shadow-orange-500/20":"bg-skin-card border-skin-border text-skin-muted hover:text-skin-text hover:border-skin-highlight"}`,title:h==="all"?"View Archive":"Back to Active",children:h==="archived"?e.jsx(me,{size:18,fill:"currentColor"}):e.jsx(me,{size:18,className:"group-hover:scale-110 transition-transform"})}),e.jsxs("button",{onClick:Q,className:"h-12 px-6 bg-[var(--accent-color)] text-black rounded-2xl flex items-center gap-3 font-black uppercase text-[10px] tracking-widest hover:brightness-110 active:scale-95 transition-all shadow-[0_0_20px_var(--accent-glow)] group border border-white/20",children:[e.jsx(Me,{size:16,strokeWidth:3,className:"group-hover:rotate-90 transition-transform"})," ",e.jsx("span",{className:"hidden md:inline",children:"CREATE"})]})]})]})]}),(h==="archived"||d)&&e.jsxs("div",{className:"px-4 md:px-8 lg:px-12 pb-4 flex items-center gap-2 animate-fade-in",children:[e.jsx("div",{className:"h-[1px] bg-skin-border flex-1"}),e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-[9px] font-black uppercase tracking-widest shadow-sm ${p?"bg-purple-500/10 border-purple-500/20 text-purple-500":"bg-skin-surface border-skin-border text-skin-muted"}`,children:[p?e.jsx(ce,{size:10}):e.jsx(Nt,{size:10}),h==="archived"&&e.jsx("span",{children:"ARCHIVE_MODE"}),h==="archived"&&d&&e.jsx("span",{children:"+"}),d&&(p?e.jsx("span",{children:"NEURAL_MATCH"}):e.jsx("span",{children:"KEYWORD_MATCH"})),e.jsxs("span",{className:`ml-1 border-l pl-2 ${p?"text-purple-400 border-purple-500/20":"text-accent border-skin-border"}`,children:[F.length," ITEMS"]})]}),e.jsx("div",{className:"h-[1px] bg-skin-border flex-1"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scroll px-4 md:px-8 lg:px-12 pb-32",children:F.length===0?e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-skin-muted opacity-40 gap-6 animate-fade-in",children:[e.jsx("div",{className:"w-32 h-32 rounded-[40px] bg-skin-surface border border-skin-border flex items-center justify-center rotate-3",children:p?e.jsx(Re,{size:48,strokeWidth:1,className:"text-purple-500"}):h==="archived"?e.jsx(me,{size:48,strokeWidth:1}):e.jsx(jt,{size:48,strokeWidth:1})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("p",{className:"text-xs font-black uppercase tracking-[0.3em]",children:p?"NO_SEMANTIC_MATCHES":"NO_RECORDS_FOUND"}),e.jsx("p",{className:"text-[10px] font-mono",children:p?"Try rephrasing your query.":"Vault sector is empty."})]})]}):e.jsx("div",{className:"columns-1 md:columns-2 xl:columns-3 gap-6 space-y-6 pb-20",children:F.map(t=>{var z,E,B;const n=f.has(t.id),g=((z=t.tasks)==null?void 0:z.filter(P=>P.isCompleted).length)||0,o=((E=t.tasks)==null?void 0:E.length)||0,S=o>0?g/o*100:0;return e.jsxs("div",{onClick:()=>je(t),className:`
                                  break-inside-avoid relative p-6 rounded-[32px] cursor-pointer transition-all duration-300 ease-out group
                                  border hover:-translate-y-1 active:scale-[0.99]
                                  ${n?"bg-accent/10 border-accent shadow-[0_0_40px_-10px_var(--accent-glow)]":"bg-skin-card/80 backdrop-blur-md border-skin-border hover:border-accent/30 hover:shadow-xl sheen"}
                              `,children:[u&&e.jsx("div",{className:`absolute top-6 right-6 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all z-20 ${n?"bg-accent border-accent text-black":"border-neutral-400 bg-transparent"}`,children:n&&e.jsx(ge,{size:12,strokeWidth:3})}),t.is_pinned&&!u&&e.jsx("div",{className:"absolute top-6 right-6 text-accent animate-pulse",children:e.jsx(wt,{size:16,fill:"currentColor"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`
                                          w-12 h-12 rounded-2xl flex items-center justify-center shrink-0 transition-all duration-500 border
                                          ${n?"bg-accent text-black border-transparent":"bg-skin-surface border-skin-border text-skin-muted group-hover:text-accent group-hover:bg-accent/10 group-hover:border-accent/20"}
                                      `,children:e.jsx(St,{size:20,strokeWidth:2})}),e.jsxs("div",{className:"flex-1 min-w-0 pt-1",children:[e.jsx("h3",{className:`text-lg font-black uppercase tracking-tight truncate leading-none mb-1 ${n?"text-accent":"text-skin-text group-hover:text-accent transition-colors"}`,children:t.title||"UNTITLED_ENTRY"}),e.jsxs("div",{className:"flex items-center gap-2 text-[8px] tech-mono font-bold text-skin-muted uppercase tracking-wider",children:[e.jsx("span",{children:new Date(t.updated).toLocaleDateString()}),e.jsx("span",{className:"w-1 h-1 rounded-full bg-neutral-600"}),e.jsxs("span",{children:["ID: ",t.id.slice(0,4)]})]})]})]}),e.jsx("p",{className:"text-[11px] text-skin-muted font-medium leading-relaxed line-clamp-3",children:t.content.replace(/<[^>]*>/g," ").slice(0,150)||"No preview data available."}),o>0&&e.jsxs("div",{className:"space-y-1.5 pt-1",children:[e.jsxs("div",{className:"flex justify-between items-center text-[8px] font-black uppercase tracking-widest text-skin-muted",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($e,{size:10})," TASKS"]}),e.jsxs("span",{children:[Math.round(S),"%"]})]}),e.jsx("div",{className:"h-1.5 w-full bg-skin-border rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all duration-700",style:{width:`${S}%`}})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-2 opacity-60 group-hover:opacity-100 transition-opacity",children:(B=t.tags)==null?void 0:B.map((P,Te)=>e.jsxs("span",{className:"px-2 py-1 rounded bg-skin-surface border border-skin-border text-[8px] font-bold uppercase text-skin-muted flex items-center gap-1",children:[e.jsx(Tt,{size:8})," ",P]},Te))})]}),!u&&e.jsxs("div",{className:"absolute top-6 right-6 flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 translate-x-4 group-hover:translate-x-0 hidden md:flex z-20",children:[!t.is_pinned&&e.jsx("button",{onClick:P=>K(P,t.id),className:"w-8 h-8 rounded-full bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white flex items-center justify-center border border-red-500/20 shadow-sm transition-all active:scale-90",title:"Delete Note",children:e.jsx(fe,{size:14})}),e.jsx("div",{className:"w-8 h-8 rounded-full bg-skin-text text-skin-card flex items-center justify-center shadow-sm",children:e.jsx(yt,{size:14})})]})]},t.id)})})}),e.jsx("div",{className:`
          fixed inset-0 z-[1500] bg-skin-main transition-all duration-500 ease-[cubic-bezier(0.2,0,0,1)] flex flex-col
          ${T==="editor"?"translate-y-0 opacity-100":"translate-y-full opacity-0 pointer-events-none"}
      `,children:a&&e.jsx("div",{className:"flex flex-col h-full max-w-[1400px] mx-auto w-full p-0 md:p-6 lg:p-8",children:e.jsx("div",{className:"flex-1 bg-skin-card rounded-none md:rounded-[48px] border-x-0 md:border border-skin-border shadow-2xl overflow-hidden relative flex flex-col md:ring-1 ring-white/10 sheen",children:e.jsx(Ct,{initialContent:(y==null?void 0:y.content)||"",initialTitle:(y==null?void 0:y.title)||"",initialTasks:(y==null?void 0:y.tasks)||[],initialTags:(y==null?void 0:y.tags)||[],onSave:Se,onDelete:()=>K(null,a),onBack:re,language:"en",fontSize:A,onFontSizeChange:N},a)})})}),e.jsx(Rt,{isSelectionMode:u,selectedCount:f.size,totalVisibleCount:F.length,isViewingArchive:h==="archived",selectedNotes:i.filter(t=>f.has(t.id)),onSelectAll:L,onDeselectAll:()=>v(new Set),onDeleteSelected:ne,onArchiveSelected:q,onPinSelected:xe,onCancel:()=>{R(!1),v(new Set)}}),e.jsx(It,{isOpen:Z,onClose:()=>de(!1),notes:i,onApplyUpdates:Y,onAddTasks:ie}),O&&e.jsx("div",{className:"fixed inset-0 z-[2000] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in",children:e.jsxs("div",{className:"bg-skin-card w-full max-w-sm rounded-[32px] border border-red-500/20 shadow-[0_20px_50px_-10px_rgba(239,68,68,0.15)] p-8 animate-slide-up flex flex-col items-center text-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-red-500/5 pointer-events-none animate-pulse-slow"}),e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-red-500/10 flex items-center justify-center text-red-500 mb-6 border border-red-500/20 shadow-[0_0_30px_rgba(239,68,68,0.2)]",children:e.jsx(Pe,{size:36,strokeWidth:1.5})}),e.jsx("h3",{className:"text-2xl font-black italic tracking-tighter text-skin-text uppercase mb-2",children:"DELETE NOTE?"}),e.jsxs("p",{className:"text-[10px] font-medium text-neutral-500 mb-2 font-mono uppercase tracking-widest",children:["ID: ",O.slice(0,8)]}),e.jsxs("p",{className:"text-sm text-skin-muted mb-8 leading-relaxed max-w-[240px]",children:["Are you sure you want to purge ",e.jsxs("span",{className:"font-bold text-skin-text",children:['"',le,'"']}),"? This action is permanent and cannot be undone."]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full relative z-10",children:[e.jsx("button",{onClick:()=>W(null),className:"py-4 rounded-xl font-black uppercase text-[10px] tracking-[0.2em] text-skin-muted hover:text-skin-text bg-skin-surface hover:bg-skin-surface-hover transition-all active:scale-95",children:"CANCEL"}),e.jsxs("button",{onClick:we,className:"py-4 rounded-xl font-black uppercase text-[10px] tracking-[0.2em] bg-red-500 hover:bg-red-600 text-white shadow-lg hover:shadow-red-500/40 transition-all active:scale-95 flex items-center justify-center gap-2",children:[e.jsx(fe,{size:14})," PURGE"]})]})]})})]})};export{Mt as SmartNotesView};
