const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./web-DzrVjXl0.js","./vendor-ui-BZMtAjw3.js","./vendor-react-BVD7n4_Z.js","./vendor-ai-CXmbpsrq.js","./vendor-firebase-Zql6DR9P.js","./bundler-BDrlUAdS.js","./SmartNotesView-DLvLYLhD.js","./AIChatView-CrJthAi7.js","./imageOptimizer-20RPlnSI.js","./AIToolsView-CaMOkGw0.js","./SettingsView-CsPBWyF0.js","./SystemHealthView-YEHqoYqi.js","./IStokView-DYJ_PJJ-.js","./TeleponanView-BxOEqcH1.js","./web-akMV7j-f.js"])))=>i.map(i=>d[i]);
import{j as a,L as Qn,F as bt,M as er,W as tr,A as Re,a as sr,C as wt,P as nr,b as rr,c as ar,T as Ae,d as Lt,S as Xe,X as tt,e as ir,f as jt,g as Pt,h as Ee,i as Os,R as Ze,k as or,l as cr,m as lr,Q as dr,Z as Fe,B as ws,D as Ls,n as js,o as Ps,p as ur,q as pr,r as Ds,s as Me,t as Dt,u as mr,v as hr,w as fr,x as gr,y as Mt,z as xr,E as Ms,G as br,H as Er,I as Sr,J as qt,K as yr,N as Tr,O as Us,U as vr,V as Nr,Y as Ar,_ as Cr,$ as Ir,a0 as st,a1 as fe,a2 as Gs,a3 as Hs,a4 as Et,a5 as Fs,a6 as Xt,a7 as _r,a8 as Bs,a9 as Rr}from"./vendor-ui-BZMtAjw3.js";import{g as kr,a as Or,r as h,R as ke}from"./vendor-react-BVD7n4_Z.js";import{Type as Z,GoogleGenAI as Be,Modality as wr}from"./vendor-ai-CXmbpsrq.js";import{g as Lr,a as jr,i as Pr,b as Vs,c as Dr,G as Mr,d as $s,e as Ks,s as zs,f as Ur,h as Ue,j as nt,u as Gr,k as ct,l as Hr,o as Ys,m as Ws,n as Fr,p as Br,q as Vr,r as Js,t as $r,v as Kr,w as zr}from"./vendor-firebase-Zql6DR9P.js";function Yr(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();let qs=!0,Xs=!0;function Le(t,e,s){const n=t.match(e);return n&&n.length>=s&&parseFloat(n[s],10)}function ye(t,e,s){if(!t.RTCPeerConnection)return;const n=t.RTCPeerConnection.prototype,r=n.addEventListener;n.addEventListener=function(o,c){if(o!==e)return r.apply(this,arguments);const l=d=>{const u=s(d);u&&(c.handleEvent?c.handleEvent(u):c(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,l),r.apply(this,[o,l])};const i=n.removeEventListener;n.removeEventListener=function(o,c){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(c))return i.apply(this,arguments);const l=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,l])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Wr(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(qs=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Jr(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Xs=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function Zs(){if(typeof window=="object"){if(qs)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Ut(t,e){Xs&&console.warn(t+" is deprecated, please use "+e+" instead.")}function qr(t){const e={browser:null,version:null};if(typeof t>"u"||!t.navigator||!t.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:s}=t;if(s.userAgentData&&s.userAgentData.brands){const n=s.userAgentData.brands.find(r=>r.brand==="Chromium");if(n)return{browser:"chrome",version:parseInt(n.version,10)}}if(s.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Le(s.userAgent,/Firefox\/(\d+)\./,1));else if(s.webkitGetUserMedia||t.isSecureContext===!1&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Le(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(t.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Le(s.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype,e._safariVersion=Le(s.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function Zt(t){return Object.prototype.toString.call(t)==="[object Object]"}function Qs(t){return Zt(t)?Object.keys(t).reduce(function(e,s){const n=Zt(t[s]),r=n?Qs(t[s]):t[s],i=n&&!Object.keys(r).length;return r===void 0||i?e:Object.assign(e,{[s]:r})},{}):t}function St(t,e,s){!e||s.has(e.id)||(s.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?St(t,t.get(e[n]),s):n.endsWith("Ids")&&e[n].forEach(r=>{St(t,t.get(r),s)})}))}function Qt(t,e,s){const n=s?"outbound-rtp":"inbound-rtp",r=new Map;if(e===null)return r;const i=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{t.forEach(c=>{c.type===n&&c.trackId===o.id&&St(t,c,r)})}),r}const es=Zs;function en(t,e){const s=t&&t.navigator;if(!s.mediaDevices)return;const n=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const l={};return Object.keys(c).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof c[d]=="object"?c[d]:{ideal:c[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const m=function(p,g){return p?p+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){l.optional=l.optional||[];let p={};typeof u.ideal=="number"?(p[m("min",d)]=u.ideal,l.optional.push(p),p={},p[m("max",d)]=u.ideal,l.optional.push(p)):(p[m("",d)]=u.ideal,l.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(l.mandatory=l.mandatory||{},l.mandatory[m("",d)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(l.mandatory=l.mandatory||{},l.mandatory[m(p,d)]=u[p])})}),c.advanced&&(l.optional=(l.optional||[]).concat(c.advanced)),l},r=function(c,l){if(e.version>=61)return l(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const d=function(u,m,p){m in u&&!(p in u)&&(u[p]=u[m],delete u[m])};c=JSON.parse(JSON.stringify(c)),d(c.audio,"autoGainControl","googAutoGainControl"),d(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&typeof c.video=="object"){let d=c.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete c.video.facingMode;let m;if(d.exact==="environment"||d.ideal==="environment"?m=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(m=["front"]),m)return s.mediaDevices.enumerateDevices().then(p=>{p=p.filter(f=>f.kind==="videoinput");let g=p.find(f=>m.some(x=>f.label.toLowerCase().includes(x)));return!g&&p.length&&m.includes("back")&&(g=p[p.length-1]),g&&(c.video.deviceId=d.exact?{exact:g.deviceId}:{ideal:g.deviceId}),c.video=n(c.video),es("chrome: "+JSON.stringify(c)),l(c)})}c.video=n(c.video)}return es("chrome: "+JSON.stringify(c)),l(c)},i=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(c,l,d){r(c,u=>{s.webkitGetUserMedia(u,l,m=>{d&&d(i(m))})})};if(s.getUserMedia=o.bind(s),s.mediaDevices.getUserMedia){const c=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(l){return r(l,d=>c(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(m=>{m.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function tn(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function sn(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(c=>c.track&&c.track.id===r.track.id):i={track:r.track};const o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(r=>{let i;t.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(c=>c.track&&c.track.id===r.id):i={track:r};const o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else ye(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function nn(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(r,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=r.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:r}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(c,l){let d=r.apply(this,arguments);return d||(d=e(this,c),this._senders.push(d)),d};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(c){i.apply(this,arguments);const l=this._senders.indexOf(c);l!==-1&&this._senders.splice(l,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],s.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{const c=this._senders.find(l=>l.track===o);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function rn(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=s.apply(this,[]);return i.forEach(o=>o._pc=this),i});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>Qt(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=s.apply(this,[]);return r.forEach(i=>i._pc=this),r}),ye(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>Qt(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype&&"getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let r,i,o;return this.getSenders().forEach(c=>{c.track===n&&(r?o=!0:r=c)}),this.getReceivers().forEach(c=>(c.track===n&&(i?o=!0:i=c),c.track===n)),o||r&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function an(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const l=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(l)===-1&&this._shimmedLocalStreams[c.id].push(l):this._shimmedLocalStreams[c.id]=[c,l],l};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(d=>{if(this.getSenders().find(m=>m.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();s.apply(this,arguments);const l=this.getSenders().filter(d=>c.indexOf(d)===-1);this._shimmedLocalStreams[o.id]=[o].concat(l)};const n=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const l=this._shimmedLocalStreams[c].indexOf(o);l!==-1&&this._shimmedLocalStreams[c].splice(l,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),r.apply(this,arguments)}}function on(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return an(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const u=s.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(m=>this._reverseStreams[m.id])};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(m=>{if(this.getSenders().find(g=>g.track===m))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const m=new t.MediaStream(u.getTracks());this._streams[u.id]=m,this._reverseStreams[m.id]=u,u=m}n.apply(this,[u])};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},t.RTCPeerConnection.prototype.addTrack=function(u,m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(x=>x===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(x=>x.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const f=this._streams[m.id];if(f)f.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const x=new t.MediaStream([u]);this._streams[m.id]=x,this._reverseStreams[x.id]=m,this.addStream(x)}return this.getSenders().find(x=>x.track===u)};function i(d,u){let m=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const g=d._reverseStreams[p],f=d._streams[g.id];m=m.replace(new RegExp(f.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:m})}function o(d,u){let m=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const g=d._reverseStreams[p],f=d._streams[g.id];m=m.replace(new RegExp(g.id,"g"),f.id)}),new RTCSessionDescription({type:u.type,sdp:m})}["createOffer","createAnswer"].forEach(function(d){const u=t.RTCPeerConnection.prototype[d],m={[d](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[f=>{const x=i(this,f);p[0].apply(null,[x])},f=>{p[1]&&p[1].apply(null,f)},arguments[2]]):u.apply(this,arguments).then(f=>i(this,f))}};t.RTCPeerConnection.prototype[d]=m[d]});const c=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=o(this,arguments[0]),c.apply(this,arguments))};const l=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const d=l.get.apply(this);return d.type===""?d:i(this,d)}}),t.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(x=>u.track===x)&&(p=this._streams[g])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function yt(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const n=t.RTCPeerConnection.prototype[s],r={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=r[s]})}function cn(t,e){ye(t,"negotiationneeded",s=>{const n=s.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return s})}const ts=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:cn,shimAddTrackRemoveTrack:on,shimAddTrackRemoveTrackWithNative:an,shimGetSendersWithDtmf:nn,shimGetUserMedia:en,shimMediaStream:tn,shimOnTrack:sn,shimPeerConnection:yt,shimSenderReceiverGetStats:rn},Symbol.toStringTag,{value:"Module"}));function ln(t,e){const s=t&&t.navigator,n=t&&t.MediaStreamTrack;if(s.getUserMedia=function(r,i,o){Ut("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(r).then(i,o)},!(e.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const r=function(o,c,l){c in o&&!(l in o)&&(o[l]=o[c],delete o[c])},i=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),r(o.audio,"autoGainControl","mozAutoGainControl"),r(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},n&&n.prototype.getSettings){const o=n.prototype.getSettings;n.prototype.getSettings=function(){const c=o.apply(this,arguments);return r(c,"mozAutoGainControl","autoGainControl"),r(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),r(c,"autoGainControl","mozAutoGainControl"),r(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function Xr(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})}function dn(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Tt(t,e){if(typeof t!="object"||!(t.RTCPeerConnection||t.mozRTCPeerConnection))return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){const i=t.RTCPeerConnection.prototype[r],o={[r](){return arguments[0]=new(r==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};t.RTCPeerConnection.prototype[r]=o[r]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;return n.apply(this,[i||null]).then(l=>{if(e.version<53&&!o)try{l.forEach(d=>{d.type=s[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;l.forEach((u,m)=>{l.set(m,Object.assign({},u,{type:s[u.type]||u.type}))})}return l}).then(o,c)}}function un(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=s.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function pn(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender)||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),ye(t,"track",s=>(s.receiver._pc=s.srcElement,s)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function mn(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){Ut("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&s.getTracks().includes(n.track)&&this.removeTrack(n)})})}function hn(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function fn(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:o}=i,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(c).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function gn(t){if(!(typeof t=="object"&&t.RTCRtpSender))return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function xn(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function bn(t){if(!(typeof t=="object"&&t.RTCPeerConnection))return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const ss=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:fn,shimCreateAnswer:bn,shimCreateOffer:xn,shimGetDisplayMedia:Xr,shimGetParameters:gn,shimGetUserMedia:ln,shimOnTrack:dn,shimPeerConnection:Tt,shimRTCDataChannel:hn,shimReceiverGetStats:pn,shimRemoveStream:mn,shimSenderGetStats:un},Symbol.toStringTag,{value:"Module"}));function En(t){if(!(typeof t!="object"||!t.RTCPeerConnection)){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>e.call(this,r,n)),n.getVideoTracks().forEach(r=>e.call(this,r,n))},t.RTCPeerConnection.prototype.addTrack=function(n,...r){return r&&r.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(s);if(n===-1)return;this._localStreams.splice(n,1);const r=s.getTracks();this.getSenders().forEach(i=>{r.includes(i.track)&&this.removeTrack(i)})})}}function Sn(t){if(!(typeof t!="object"||!t.RTCPeerConnection)&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(r=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(r))return;this._remoteStreams.push(r);const i=new Event("addstream");i.stream=r,this.dispatchEvent(i)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function yn(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,s=e.createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){const m=arguments.length>=2?arguments[2]:arguments[0],p=s.apply(this,[m]);return u?(p.then(d,u),Promise.resolve()):p},e.createAnswer=function(d,u){const m=arguments.length>=2?arguments[2]:arguments[0],p=n.apply(this,[m]);return u?(p.then(d,u),Promise.resolve()):p};let c=function(l,d,u){const m=r.apply(this,[l]);return u?(m.then(d,u),Promise.resolve()):m};e.setLocalDescription=c,c=function(l,d,u){const m=i.apply(this,[l]);return u?(m.then(d,u),Promise.resolve()):m},e.setRemoteDescription=c,c=function(l,d,u){const m=o.apply(this,[l]);return u?(m.then(d,u),Promise.resolve()):m},e.addIceCandidate=c}function Tn(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const s=e.mediaDevices,n=s.getUserMedia.bind(s);e.mediaDevices.getUserMedia=r=>n(vn(r))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function vn(t){return t&&t.video!==void 0?Object.assign({},t,{video:Qs(t.video)}):t}function Nn(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];c.urls===void 0&&c.url?(Ut("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,i.push(c)):i.push(n.iceServers[o])}n.iceServers=i}return new e(n,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function An(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cn(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio===!0&&!r&&this.addTransceiver("audio",{direction:"recvonly"}),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function In(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}const ns=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:In,shimCallbacksAPI:yn,shimConstraints:vn,shimCreateOfferLegacy:Cn,shimGetUserMedia:Tn,shimLocalStreamsAPI:En,shimRTCIceServerUrls:Nn,shimRemoteStreamsAPI:Sn,shimTrackEventTransceiver:An},Symbol.toStringTag,{value:"Module"}));var _n={exports:{}};(function(t){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(s){return s.trim().split(`
`).map(n=>n.trim())},e.splitSections=function(s){return s.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(s){const n=e.splitSections(s);return n&&n[0]},e.getMediaSections=function(s){const n=e.splitSections(s);return n.shift(),n},e.matchPrefix=function(s,n){return e.splitLines(s).filter(r=>r.indexOf(n)===0)},e.parseCandidate=function(s){let n;s.indexOf("a=candidate:")===0?n=s.substring(12).split(" "):n=s.substring(10).split(" ");const r={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let i=8;i<n.length;i+=2)switch(n[i]){case"raddr":r.relatedAddress=n[i+1];break;case"rport":r.relatedPort=parseInt(n[i+1],10);break;case"tcptype":r.tcpType=n[i+1];break;case"ufrag":r.ufrag=n[i+1],r.usernameFragment=n[i+1];break;default:r[n[i]]===void 0&&(r[n[i]]=n[i+1]);break}return r},e.writeCandidate=function(s){const n=[];n.push(s.foundation);const r=s.component;r==="rtp"?n.push(1):r==="rtcp"?n.push(2):n.push(r),n.push(s.protocol.toUpperCase()),n.push(s.priority),n.push(s.address||s.ip),n.push(s.port);const i=s.type;return n.push("typ"),n.push(i),i!=="host"&&s.relatedAddress&&s.relatedPort&&(n.push("raddr"),n.push(s.relatedAddress),n.push("rport"),n.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(n.push("ufrag"),n.push(s.usernameFragment||s.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(s){return s.substring(14).split(" ")},e.parseRtpMap=function(s){let n=s.substring(9).split(" ");const r={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),r.name=n[0],r.clockRate=parseInt(n[1],10),r.channels=n.length===3?parseInt(n[2],10):1,r.numChannels=r.channels,r},e.writeRtpMap=function(s){let n=s.payloadType;s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType);const r=s.channels||s.numChannels||1;return"a=rtpmap:"+n+" "+s.name+"/"+s.clockRate+(r!==1?"/"+r:"")+`\r
`},e.parseExtmap=function(s){const n=s.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},e.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},e.parseFmtp=function(s){const n={};let r;const i=s.substring(s.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)r=i[o].trim().split("="),n[r[0].trim()]=r[1];return n},e.writeFmtp=function(s){let n="",r=s.payloadType;if(s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const i=[];Object.keys(s.parameters).forEach(o=>{s.parameters[o]!==void 0?i.push(o+"="+s.parameters[o]):i.push(o)}),n+="a=fmtp:"+r+" "+i.join(";")+`\r
`}return n},e.parseRtcpFb=function(s){const n=s.substring(s.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(s){let n="",r=s.payloadType;return s.preferredPayloadType!==void 0&&(r=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(i=>{n+="a=rtcp-fb:"+r+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(s){const n=s.indexOf(" "),r={ssrc:parseInt(s.substring(7,n),10)},i=s.indexOf(":",n);return i>-1?(r.attribute=s.substring(n+1,i),r.value=s.substring(i+1)):r.attribute=s.substring(n+1),r},e.parseSsrcGroup=function(s){const n=s.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(r=>parseInt(r,10))}},e.getMid=function(s){const n=e.matchPrefix(s,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(s){const n=s.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},e.getDtlsParameters=function(s,n){return{role:"auto",fingerprints:e.matchPrefix(s+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(s,n){let r="a=setup:"+n+`\r
`;return s.fingerprints.forEach(i=>{r+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),r},e.parseCryptoLine=function(s){const n=s.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?e.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const n=s.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},e.getCryptoParameters=function(s,n){return e.matchPrefix(s+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(s,n){const r=e.matchPrefix(s+n,"a=ice-ufrag:")[0],i=e.matchPrefix(s+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(s){let n="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(n+=`a=ice-lite\r
`),n},e.parseRtpParameters=function(s){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(s)[0].split(" ");n.profile=i[2];for(let c=3;c<i.length;c++){const l=i[c],d=e.matchPrefix(s,"a=rtpmap:"+l+" ")[0];if(d){const u=e.parseRtpMap(d),m=e.matchPrefix(s,"a=fmtp:"+l+" ");switch(u.parameters=m.length?e.parseFmtp(m[0]):{},u.rtcpFeedback=e.matchPrefix(s,"a=rtcp-fb:"+l+" ").map(e.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(s,"a=extmap:").forEach(c=>{n.headerExtensions.push(e.parseExtmap(c))});const o=e.matchPrefix(s,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach(c=>{o.forEach(l=>{c.rtcpFeedback.find(u=>u.type===l.type&&u.parameter===l.parameter)||c.rtcpFeedback.push(l)})}),n},e.writeRtpDescription=function(s,n){let r="";r+="m="+s+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,r+=`c=IN IP4 0.0.0.0\r
`,r+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{r+=e.writeRtpMap(o),r+=e.writeFmtp(o),r+=e.writeRtcpFb(o)});let i=0;return n.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(r+="a=maxptime:"+i+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{r+=e.writeExtmap(o)}),r},e.parseRtpEncodingParameters=function(s){const n=[],r=e.parseRtpParameters(s),i=r.fecMechanisms.indexOf("RED")!==-1,o=r.fecMechanisms.indexOf("ULPFEC")!==-1,c=e.matchPrefix(s,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),l=c.length>0&&c[0].ssrc;let d;const u=e.matchPrefix(s,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(f=>parseInt(f,10)));u.length>0&&u[0].length>1&&u[0][0]===l&&(d=u[0][1]),r.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let g={ssrc:l,codecPayloadType:parseInt(p.parameters.apt,10)};l&&d&&(g.rtx={ssrc:d}),n.push(g),i&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:l,mechanism:o?"red+ulpfec":"red"},n.push(g))}}),n.length===0&&l&&n.push({ssrc:l});let m=e.matchPrefix(s,"b=");return m.length&&(m[0].indexOf("b=TIAS:")===0?m=parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?m=parseInt(m[0].substring(5),10)*1e3*.95-50*40*8:m=void 0,n.forEach(p=>{p.maxBitrate=m})),n},e.parseRtcpParameters=function(s){const n={},r=e.matchPrefix(s,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=e.matchPrefix(s,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=i.length===0;const o=e.matchPrefix(s,"a=rtcp-mux");return n.mux=o.length>0,n},e.writeRtcpParameters=function(s){let n="";return s.reducedSize&&(n+=`a=rtcp-rsize\r
`),s.mux&&(n+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(n+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),n},e.parseMsid=function(s){let n;const r=e.matchPrefix(s,"a=msid:");if(r.length===1)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=e.matchPrefix(s,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return n=i[0].value.split(" "),{stream:n[0],track:n[1]}},e.parseSctpDescription=function(s){const n=e.parseMLine(s),r=e.matchPrefix(s,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(s,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const c=e.matchPrefix(s,"a=sctpmap:");if(c.length>0){const l=c[0].substring(10).split(" ");return{port:parseInt(l[0],10),protocol:l[1],maxMessageSize:i}}},e.writeSctpDescription=function(s,n){let r=[];return s.protocol!=="DTLS/SCTP"?r=["m="+s.kind+" 9 "+s.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:r=["m="+s.kind+" 9 "+s.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&r.push("a=max-message-size:"+n.maxMessageSize+`\r
`),r.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(s,n,r){let i;const o=n!==void 0?n:2;return s?i=s:i=e.generateSessionId(),`v=0\r
o=`+(r||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(s,n){const r=e.splitLines(s);for(let i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(s){return e.splitLines(s)[0].split(" ")[0].substring(2)},e.isRejected=function(s){return s.split(" ",2)[1]==="0"},e.parseMLine=function(s){const r=e.splitLines(s)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(s){const r=e.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const n=e.splitLines(s);for(let r=0;r<n.length;r++)if(n[r].length<2||n[r].charAt(1)!=="=")return!1;return!0},t.exports=e})(_n);var Rn=_n.exports;const ve=kr(Rn),Zr=Yr({__proto__:null,default:ve},[Rn]);function ze(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substring(2)),n.candidate&&n.candidate.length){const r=new e(n),i=ve.parseCandidate(n.candidate);for(const o in i)o in r||Object.defineProperty(r,o,{value:i[o]});return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,ye(t,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s))}function vt(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||ye(t,"icecandidate",e=>{if(e.candidate){const s=ve.parseCandidate(e.candidate.candidate);s.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return e})}function Ye(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const s=function(c){if(!c||!c.sdp)return!1;const l=ve.splitSections(c.sdp);return l.shift(),l.some(d=>{const u=ve.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},n=function(c){const l=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(l===null||l.length<2)return-1;const d=parseInt(l[1],10);return d!==d?-1:d},r=function(c){let l=65536;return e.browser==="firefox"&&(e.version<57?c===-1?l=16384:l=2147483637:e.version<60?l=e.version===57?65535:65536:l=2147483637),l},i=function(c,l){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=ve.matchPrefix(c.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&l!==-1&&(d=2147483637),d},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:l}=this.getConfiguration();l==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const l=n(arguments[0]),d=r(l),u=i(arguments[0],l);let m;d===0&&u===0?m=Number.POSITIVE_INFINITY:d===0||u===0?m=Math.max(d,u):m=Math.min(d,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return m}}),this._sctp=p}return o.apply(this,arguments)}}function We(t){if(!(t.RTCPeerConnection&&"createDataChannel"in t.RTCPeerConnection.prototype))return;function e(n,r){const i=n.send;n.send=function(){const c=arguments[0],l=c.length||c.size||c.byteLength;if(n.readyState==="open"&&r.sctp&&l>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return i.apply(n,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=s.apply(this,arguments);return e(r,this),r},ye(t,"datachannel",n=>(e(n.channel,n.target),n))}function Nt(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const n=e[s];e[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=r=>{const i=r.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",r);i.dispatchEvent(o)}return r},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function At(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return s.apply(this,arguments)}}function Je(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.addIceCandidate;!s||s.length===0||(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function qe(t,e){if(!(t.RTCPeerConnection&&t.RTCPeerConnection.prototype))return;const s=t.RTCPeerConnection.prototype.setLocalDescription;!s||s.length===0||(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return s.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer";break}return r.sdp||r.type!=="offer"&&r.type!=="answer"?s.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>s.apply(this,[o]))})}const Qr=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:At,shimAddIceCandidateNullOrEmpty:Je,shimConnectionState:Nt,shimMaxMessageSize:Ye,shimParameterlessSetLocalDescription:qe,shimRTCIceCandidate:ze,shimRTCIceCandidateRelayProtocol:vt,shimSendThrowTypeError:We},Symbol.toStringTag,{value:"Module"}));function ea({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=Zs,n=qr(t),r={browserDetails:n,commonShim:Qr,extractVersion:Le,disableLog:Wr,disableWarnings:Jr,sdp:Zr};switch(n.browser){case"chrome":if(!ts||!yt||!e.shimChrome)return s("Chrome shim is not included in this adapter release."),r;if(n.version===null)return s("Chrome shim can not determine version, not shimming."),r;s("adapter.js shimming chrome."),r.browserShim=ts,Je(t,n),qe(t),en(t,n),tn(t),yt(t,n),sn(t),on(t,n),nn(t),rn(t),cn(t,n),ze(t),vt(t),Nt(t),Ye(t,n),We(t),At(t,n);break;case"firefox":if(!ss||!Tt||!e.shimFirefox)return s("Firefox shim is not included in this adapter release."),r;s("adapter.js shimming firefox."),r.browserShim=ss,Je(t,n),qe(t),ln(t,n),Tt(t,n),dn(t),mn(t),un(t),pn(t),hn(t),fn(t),gn(t),xn(t),bn(t),ze(t),Nt(t),Ye(t,n),We(t);break;case"safari":if(!ns||!e.shimSafari)return s("Safari shim is not included in this adapter release."),r;s("adapter.js shimming safari."),r.browserShim=ns,Je(t,n),qe(t),Nn(t),Cn(t),yn(t),En(t),Sn(t),An(t),Tn(t),In(t),ze(t),vt(t),Ye(t,n),We(t),At(t,n);break;default:s("Unsupported browser!");break}return r}const co=ea({window:typeof window>"u"?void 0:window});var Ct={},rs=Or;Ct.createRoot=rs.createRoot,Ct.hydrateRoot=rs.hydrateRoot;const ta="modulepreload",sa=function(t,e){return new URL(t,e).href},as={},le=function(e,s,n){let r=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(s.map(d=>{if(d=sa(d,n),d in as)return;as[d]=!0;const u=d.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(!!n)for(let f=o.length-1;f>=0;f--){const x=o[f];if(x.href===d&&(!u||x.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":ta,u||(g.as="script"),g.crossOrigin="",g.href=d,l&&g.setAttribute("nonce",l),document.head.appendChild(g),u)return new Promise((f,x)=>{g.addEventListener("load",f),g.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return r.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})},kn=[{id:"dashboard",name:"BERANDA",icon:a.jsx(Qn,{size:22})},{id:"notes",name:"CATATAN",icon:a.jsx(bt,{size:22})},{id:"chat",name:"ASISTEN",icon:a.jsx(er,{size:22})},{id:"tools",name:"ALAT",icon:a.jsx(tr,{size:22})},{id:"system",name:"SISTEM",icon:a.jsx(Re,{size:22})}];/*! Capacitor: https://capacitorjs.com/ - MIT License */var Ce;(function(t){t.Unimplemented="UNIMPLEMENTED",t.Unavailable="UNAVAILABLE"})(Ce||(Ce={}));class lt extends Error{constructor(e,s,n){super(e),this.message=e,this.code=s,this.data=n}}const na=t=>{var e,s;return t!=null&&t.androidBridge?"android":!((s=(e=t==null?void 0:t.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||s===void 0)&&s.bridge?"ios":"web"},ra=t=>{const e=t.CapacitorCustomPlatform||null,s=t.Capacitor||{},n=s.Plugins=s.Plugins||{},r=()=>e!==null?e.name:na(t),i=()=>r()!=="web",o=m=>{const p=d.get(m);return!!(p!=null&&p.platforms.has(r())||c(m))},c=m=>{var p;return(p=s.PluginHeaders)===null||p===void 0?void 0:p.find(g=>g.name===m)},l=m=>t.console.error(m),d=new Map,u=(m,p={})=>{const g=d.get(m);if(g)return console.warn(`Capacitor plugin "${m}" already registered. Cannot register plugins twice.`),g.proxy;const f=r(),x=c(m);let b;const S=async()=>(!b&&f in p?b=typeof p[f]=="function"?b=await p[f]():b=p[f]:e!==null&&!b&&"web"in p&&(b=typeof p.web=="function"?b=await p.web():b=p.web),b),v=(N,T)=>{var O,F;if(x){const j=x==null?void 0:x.methods.find(H=>T===H.name);if(j)return j.rtype==="promise"?H=>s.nativePromise(m,T.toString(),H):(H,B)=>s.nativeCallback(m,T.toString(),H,B);if(N)return(O=N[T])===null||O===void 0?void 0:O.bind(N)}else{if(N)return(F=N[T])===null||F===void 0?void 0:F.bind(N);throw new lt(`"${m}" plugin is not implemented on ${f}`,Ce.Unimplemented)}},k=N=>{let T;const O=(...F)=>{const j=S().then(H=>{const B=v(H,N);if(B){const P=B(...F);return T=P==null?void 0:P.remove,P}else throw new lt(`"${m}.${N}()" is not implemented on ${f}`,Ce.Unimplemented)});return N==="addListener"&&(j.remove=async()=>T()),j};return O.toString=()=>`${N.toString()}() { [capacitor code] }`,Object.defineProperty(O,"name",{value:N,writable:!1,configurable:!1}),O},E=k("addListener"),A=k("removeListener"),y=(N,T)=>{const O=E({eventName:N},T),F=async()=>{const H=await O;A({eventName:N,callbackId:H},T)},j=new Promise(H=>O.then(()=>H({remove:F})));return j.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await F()},j},C=new Proxy({},{get(N,T){switch(T){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return x?y:E;case"removeListener":return A;default:return k(T)}}});return n[m]=C,d.set(m,{name:m,proxy:C,platforms:new Set([...Object.keys(p),...x?[f]:[]])}),C};return s.convertFileSrc||(s.convertFileSrc=m=>m),s.getPlatform=r,s.handleError=l,s.isNativePlatform=i,s.isPluginAvailable=o,s.registerPlugin=u,s.Exception=lt,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},aa=t=>t.Capacitor=ra(t),Se=aa(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Ve=Se.registerPlugin;class Gt{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,s){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(s);const i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i),n&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,s);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,s,n){const r=this.listeners[e];if(!r){if(n){let i=this.retainedEventArguments[e];i||(i=[]),i.push(s),this.retainedEventArguments[e]=i}return}r.forEach(i=>i(s))}hasListeners(e){var s;return!!(!((s=this.listeners[e])===null||s===void 0)&&s.length)}registerWindowListener(e,s){this.windowListeners[s]={registered:!1,windowEventName:e,pluginEventName:s,handler:n=>{this.notifyListeners(s,n)}}}unimplemented(e="not implemented"){return new Se.Exception(e,Ce.Unimplemented)}unavailable(e="not available"){return new Se.Exception(e,Ce.Unavailable)}async removeListener(e,s){const n=this.listeners[e];if(!n)return;const r=n.indexOf(s);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const s=this.retainedEventArguments[e];s&&(delete this.retainedEventArguments[e],s.forEach(n=>{this.notifyListeners(e,n)}))}}const is=t=>encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),os=t=>t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class ia extends Gt{async getCookies(){const e=document.cookie,s={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[r,i]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");r=os(r).trim(),i=os(i).trim(),s[r]=i}),s}async setCookie(e){try{const s=is(e.key),n=is(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,i=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${s}=${n||""}${r}; path=${i}; ${o};`}catch(s){return Promise.reject(s)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(s){return Promise.reject(s)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const s of e)document.cookie=s.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Ve("CapacitorCookies",{web:()=>new ia});const oa=async t=>new Promise((e,s)=>{const n=new FileReader;n.onload=()=>{const r=n.result;e(r.indexOf(",")>=0?r.split(",")[1]:r)},n.onerror=r=>s(r),n.readAsDataURL(t)}),ca=(t={})=>{const e=Object.keys(t);return Object.keys(t).map(r=>r.toLocaleLowerCase()).reduce((r,i,o)=>(r[i]=t[e[o]],r),{})},la=(t,e=!0)=>t?Object.entries(t).reduce((n,r)=>{const[i,o]=r;let c,l;return Array.isArray(o)?(l="",o.forEach(d=>{c=e?encodeURIComponent(d):d,l+=`${i}=${c}&`}),l.slice(0,-1)):(c=e?encodeURIComponent(o):o,l=`${i}=${c}`),`${n}&${l}`},"").substr(1):null,da=(t,e={})=>{const s=Object.assign({method:t.method||"GET",headers:t.headers},e),r=ca(t.headers)["content-type"]||"";if(typeof t.data=="string")s.body=t.data;else if(r.includes("application/x-www-form-urlencoded")){const i=new URLSearchParams;for(const[o,c]of Object.entries(t.data||{}))i.set(o,c);s.body=i.toString()}else if(r.includes("multipart/form-data")||t.data instanceof FormData){const i=new FormData;if(t.data instanceof FormData)t.data.forEach((c,l)=>{i.append(l,c)});else for(const c of Object.keys(t.data))i.append(c,t.data[c]);s.body=i;const o=new Headers(s.headers);o.delete("content-type"),s.headers=o}else(r.includes("application/json")||typeof t.data=="object")&&(s.body=JSON.stringify(t.data));return s};class ua extends Gt{async request(e){const s=da(e,e.webFetchExtra),n=la(e.params,e.shouldEncodeUrlParams),r=n?`${e.url}?${n}`:e.url,i=await fetch(r,s),o=i.headers.get("content-type")||"";let{responseType:c="text"}=i.ok?e:{};o.includes("application/json")&&(c="json");let l,d;switch(c){case"arraybuffer":case"blob":d=await i.blob(),l=await oa(d);break;case"json":l=await i.json();break;case"document":case"text":default:l=await i.text()}const u={};return i.headers.forEach((m,p)=>{u[p]=m}),{data:l,headers:u,status:i.status,url:i.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Ve("CapacitorHttp",{web:()=>new ua});var cs;(function(t){t.Dark="DARK",t.Light="LIGHT",t.Default="DEFAULT"})(cs||(cs={}));var ls;(function(t){t.StatusBar="StatusBar",t.NavigationBar="NavigationBar"})(ls||(ls={}));class pa extends Gt{async setStyle(){this.unavailable("not available for web")}async setAnimation(){this.unavailable("not available for web")}async show(){this.unavailable("not available for web")}async hide(){this.unavailable("not available for web")}}Ve("SystemBars",{web:()=>new pa});const Ge=Ve("Preferences",{web:()=>le(()=>import("./web-DzrVjXl0.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url).then(t=>new t.PreferencesWeb)}),ds=()=>Se.isNativePlatform();function U(t,e){const s=h.useCallback(()=>{if(typeof window>"u")return e;try{const c=window.localStorage.getItem(t);return c?JSON.parse(c):e}catch(c){return console.warn(`Error reading localStorage key "${t}":`,c),e}},[e,t]),[n,r]=h.useState(s),i=h.useRef(n),o=h.useCallback(c=>{r(l=>{const d=c instanceof Function?c(l):c;try{typeof window<"u"&&(window.localStorage.setItem(t,JSON.stringify(d)),window.dispatchEvent(new CustomEvent("local-storage-update",{detail:{key:t,newValue:d}}))),ds()&&Ge.set({key:t,value:JSON.stringify(d)}).catch(u=>{console.warn(`Error saving native storage key "${t}":`,u)})}catch(u){console.warn(`Error saving localStorage key "${t}":`,u)}return i.current=d,d})},[t]);return h.useEffect(()=>{const c=l=>{l instanceof StorageEvent?l.key===t&&l.newValue&&r(JSON.parse(l.newValue)):l instanceof CustomEvent&&l.detail.key===t&&r(l.detail.newValue)};return window.addEventListener("storage",c),window.addEventListener("local-storage-update",c),()=>{window.removeEventListener("storage",c),window.removeEventListener("local-storage-update",c)}},[t]),h.useEffect(()=>{if(!ds())return;let c=!0;return Ge.get({key:t}).then(({value:l})=>{if(!(!c||l===null||l===void 0))try{const d=JSON.parse(l);r(d)}catch(d){console.warn(`Error parsing native storage key "${t}":`,d)}}).catch(l=>{console.warn(`Error reading native storage key "${t}":`,l)}),()=>{c=!1}},[t]),[n,o]}const On=()=>{const[t,e]=h.useState(!0),[s,n]=h.useState(!1),[r,i]=h.useState(!1),[o,c]=h.useState(!1),l=h.useRef(0),d=10;h.useEffect(()=>{const p=()=>{const f=document.activeElement,x=(f==null?void 0:f.tagName)==="TEXTAREA"||(f==null?void 0:f.tagName)==="INPUT";i(k=>k!==x?x:k);const b=window.getSelection(),S=b&&b.toString().length>0;c(!!S);const v=document.body.style.overflow==="hidden";n(v)},g=new MutationObserver(p);return g.observe(document.body,{attributes:!0,attributeFilter:["style","class"]}),window.addEventListener("focusin",p),window.addEventListener("focusout",p),document.addEventListener("selectionchange",p),()=>{g.disconnect(),window.removeEventListener("focusin",p),window.removeEventListener("focusout",p),document.removeEventListener("selectionchange",p)}},[]),h.useEffect(()=>{const p=document.getElementById("main-scroll-container")||window,g=()=>{const f=p instanceof HTMLElement?p.scrollTop:window.scrollY||document.documentElement.scrollTop;if(f<50){e(!0),l.current=f;return}r?l.current-f>40?e(!0):e(!1):f>l.current+d?e(!1):l.current-f>d&&e(!0),l.current=f};return p.addEventListener("scroll",g,{passive:!0}),()=>p.removeEventListener("scroll",g)},[r]);const u=s||o;return{shouldShowNav:!u&&t,isForcedStealth:u,isInputFocused:r}},Qe={id:{meta:{label:"BAHASA INDONESIA",code:"id-ID"},sidebar:{dashboard:"BERANDA",notes:"CATATAN",chat:"ASISTEN",tools:"ALAT",system:"SISTEM",settings:"PENGATURAN"},dashboard:{uptime:"SISTEM OPTIMAL",nodes:"TOTAL CATATAN",focus:"SINYAL P2P",archiveTitle:"BRANKAS ARSIP",archiveDesc:"Penyimpanan data jangka panjang.",chatTitle:"ASISTEN PINTAR",chatDesc:"Diskusi & Pemecahan Masalah.",toolsTitle:"ALAT KREATIF",toolsDesc:"Studio Gambar & Analisis Visual.",recent:"BARU DIBUKA",control:"KEAMANAN",vaultAccess:"BUKA BRANKAS"},chat:{placeholder:"Ketik sesuatu atau tanya...",listening:"MENDENGARKAN...",newChat:"SESI BARU",history:"RIWAYAT",empty:"BELUM ADA PESAN",welcome_hanisah:` **HANISAH SIAP.**

*Halo! Ada yang bisa saya bantu selesaikan hari ini?*`,welcome_stoic:` **LOGIC CORE AKTIF.**

*Mode Analisis Rasional.*
Sampaikan masalah Anda secara objektif.`},editor:{placeholder:"Mulai menulis ide...",tasks:"DAFTAR TUGAS",save:"MENYIMPAN...",saved:"TERSIMPAN",magic:"AI WRITER",dictate:"DIKTE"},settings:{title:"PENGATURAN UMUM",identity_title:"PROFIL PENGGUNA",data_title:"DATA & CADANGAN",lang_label:"BAHASA",lang_desc:"Bahasa antarmuka aplikasi.",theme_label:"TAMPILAN",theme_desc:"Mode Gelap atau Terang.",user_name:"NAMA PENGGUNA",user_bio:"KONTEKS PERSONAL",backup:"UNDUH CADANGAN (JSON)",restore:"PULIHKAN DATA",reset:"HAPUS SEMUA DATA",save:"SIMPAN",saved:"BERHASIL"},prompts:{hanisah:`Kamu adalah HANISAH (Asisten Virtual Cerdas).
[GAYA KOMUNIKASI]
- Gunakan Bahasa Indonesia yang natural, sopan, dan jelas.
- Bersikap solutif, langsung pada poin, namun tetap ramah.
- Gunakan "Saya" dan "Anda" atau "Aku" dan "Kamu" sesuai konteks pengguna.

[FUNGSI]
- Membantu produktivitas, mencatat, dan riset.
- Gunakan tool 'manage_note' untuk menyimpan informasi penting.
- Gunakan 'generate_visual' jika diminta membuat gambar.`,stoic:`Anda adalah LOGIC CORE (Mesin Analisis Stoik).
Bahasa: INDONESIA (Formal, Padat, Logis).
Fokus: Objektivitas, Dikotomi Kendali, dan Solusi Rasional.
Hindari respon emosional. Fokus pada fakta dan tindakan yang bisa diambil.`}},en:{meta:{label:"ENGLISH",code:"en-US"},sidebar:{dashboard:"HOME",notes:"NOTES",chat:"ASSISTANT",tools:"TOOLS",system:"SYSTEM",settings:"SETTINGS"},dashboard:{uptime:"SYSTEM ONLINE",nodes:"TOTAL NOTES",focus:"P2P SIGNAL",archiveTitle:"ARCHIVE VAULT",archiveDesc:"Long-term secure storage.",chatTitle:"AI ASSISTANT",chatDesc:"Smart conversation & logic.",toolsTitle:"CREATIVE SUITE",toolsDesc:"Image Gen & Vision.",recent:"RECENT FILES",control:"SECURITY",vaultAccess:"UNLOCK VAULT"},chat:{placeholder:"Type a message...",listening:"LISTENING...",newChat:"NEW CHAT",history:"HISTORY",empty:"NO DATA",welcome_hanisah:` **HANISAH ONLINE.**

*Hello! How can I assist your productivity today?*`,welcome_stoic:` **LOGIC CORE ONLINE.**

*Analysis Mode Active.*
State your query objectively.`},editor:{placeholder:"Start typing...",tasks:"TASKS",save:"SAVING...",saved:"SAVED",magic:"AI WRITER",dictate:"DICTATE"},settings:{title:"GENERAL SETTINGS",identity_title:"USER PROFILE",data_title:"DATA MANAGEMENT",lang_label:"LANGUAGE",lang_desc:"App interface language.",theme_label:"APPEARANCE",theme_desc:"Dark or Light mode.",user_name:"USERNAME",user_bio:"SYSTEM CONTEXT",backup:"EXPORT BACKUP (JSON)",restore:"RESTORE DATA",reset:"FACTORY RESET",save:"SAVE",saved:"SAVED"},prompts:{hanisah:`You are HANISAH (Smart Virtual Assistant).
Style: Casual, polite, helpful English.
Focus: Productivity, clarity, and assistance.`,stoic:`You are LOGIC CORE.
Style: Formal, Objective, Stoic.
Focus: Logic and Rationality.`}},bn:{meta:{label:"BRUNEI",code:"ms-BN"},sidebar:{dashboard:"UTAMA",notes:"CATATAN",chat:"PEMBANTU",tools:"ALATAN",system:"SISTEM",settings:"TETAPAN"},dashboard:{uptime:"SISTEM AKTIF",nodes:"JUMLAH NOTA",focus:"SINYAL P2P",archiveTitle:"ARKIB",archiveDesc:"Simpanan selamat.",chatTitle:"PEMBANTU AI",chatDesc:"Interaksi pintar.",toolsTitle:"ALATAN KREATIF",toolsDesc:"Studio Gambar & Analisis.",recent:"TERKINI",control:"KESELAMATAN",vaultAccess:"BUKA KUNCI"},chat:{placeholder:"Taip mesej...",listening:"MENDENGAR...",newChat:"SESI BARU",history:"SEJARAH",empty:"TIADA DATA",welcome_hanisah:` **HANISAH ONLINE.**

*Hai, apa bulih saya bantu?*`,welcome_stoic:` **LOGIC CORE ONLINE.**

*Mod Analisis Aktif.*
Sila nyatakan masalah awda.`},editor:{placeholder:"Mula menaip...",tasks:"TUGASAN",save:"MENYIMPAN...",saved:"DISIMPAN",magic:"PENULIS AI",dictate:"DIKTE"},settings:{title:"TETAPAN UMUM",identity_title:"PROFIL PENGGUNA",data_title:"PENGURUSAN DATA",lang_label:"BAHASA",lang_desc:"Bahasa antaramuka.",theme_label:"TEMA",theme_desc:"Gelap atau Terang.",user_name:"NAMA PENGGUNA",user_bio:"KONTEKS SISTEM",backup:"EKSPORT DATA",restore:"IMPORT DATA",reset:"RESET SISTEM",save:"SIMPAN",saved:"DISIMPAN"},prompts:{hanisah:`Awda adalah HANISAH.
Bahasa: Melayu Brunei/Standard.
Gaya: Sopan dan membantu.`,stoic:`Anda adalah LOGIC CORE.
Bahasa: Formal.
Fokus: Logik.`}}},wn=()=>{const t=localStorage.getItem("app_language");return t==="id"||t==="en"||t==="bn"?t:"id"},ma=(t,e)=>{const s=wn();return Qe[s][t][e]||Qe.id[t][e]},W=[];for(let t=0;t<256;++t)W.push((t+256).toString(16).slice(1));function ha(t,e=0){return(W[t[e+0]]+W[t[e+1]]+W[t[e+2]]+W[t[e+3]]+"-"+W[t[e+4]]+W[t[e+5]]+"-"+W[t[e+6]]+W[t[e+7]]+"-"+W[t[e+8]]+W[t[e+9]]+"-"+W[t[e+10]]+W[t[e+11]]+W[t[e+12]]+W[t[e+13]]+W[t[e+14]]+W[t[e+15]]).toLowerCase()}let dt;const fa=new Uint8Array(16);function ga(){if(!dt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");dt=crypto.getRandomValues.bind(crypto)}return dt(fa)}const xa=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),us={randomUUID:xa};function Y(t,e,s){var r;if(us.randomUUID&&!t)return us.randomUUID();t=t||{};const n=t.random??((r=t.rng)==null?void 0:r.call(t))??ga();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,ha(n)}const Q={SIDEBAR_BTN_DASHBOARD:"UI_SIDEBAR_BTN_DASHBOARD",SIDEBAR_BTN_NOTES:"UI_SIDEBAR_BTN_NOTES",SIDEBAR_BTN_CHAT:"UI_SIDEBAR_BTN_CHAT",SIDEBAR_BTN_TOOLS:"UI_SIDEBAR_BTN_TOOLS",SIDEBAR_BTN_SYSTEM:"UI_SIDEBAR_BTN_SYSTEM",SIDEBAR_BTN_SETTINGS:"UI_SIDEBAR_BTN_SETTINGS",SIDEBAR_BTN_LOGO:"UI_SIDEBAR_BTN_LOGO",SIDEBAR_BTN_TOGGLE:"UI_SIDEBAR_BTN_TOGGLE",DASHBOARD_BTN_SYSTEM_STATUS:"UI_DASHBOARD_BTN_SYSTEM_STATUS",DASHBOARD_CARD_NOTES:"UI_DASHBOARD_CARD_NOTES",DASHBOARD_CARD_SYNC:"UI_DASHBOARD_CARD_SYNC",DASHBOARD_BENTO_CHAT:"UI_DASHBOARD_BENTO_CHAT",DASHBOARD_BENTO_ARCHIVE:"UI_DASHBOARD_BENTO_ARCHIVE",DASHBOARD_BENTO_TOOLS:"UI_DASHBOARD_BENTO_TOOLS",DASHBOARD_BTN_RECENT_LOGS:"UI_DASHBOARD_BTN_RECENT_LOGS",DASHBOARD_BTN_VAULT_TOGGLE:"UI_DASHBOARD_BTN_VAULT_TOGGLE",CHAT_BTN_MODEL_PICKER:"UI_CHAT_BTN_MODEL_PICKER",CHAT_BTN_HISTORY:"UI_CHAT_BTN_HISTORY",CHAT_BTN_LIVE_TOGGLE:"UI_CHAT_BTN_LIVE_TOGGLE",CHAT_BTN_SCROLL_DOWN:"UI_CHAT_BTN_SCROLL_DOWN",CHAT_BTN_DELETE:"UI_CHAT_BTN_DELETE",CHAT_INPUT_SEND:"UI_CHAT_INPUT_SEND",CHAT_INPUT_ATTACH:"UI_CHAT_INPUT_ATTACH",CHAT_INPUT_MIC:"UI_CHAT_INPUT_MIC",CHAT_INPUT_NEW:"UI_CHAT_INPUT_NEW",CHAT_SUGGESTION_CARD:"UI_CHAT_SUGGESTION_CARD",NOTES_BTN_CREATE:"UI_NOTES_BTN_CREATE",NOTES_INPUT_SEARCH:"UI_NOTES_INPUT_SEARCH",NOTES_BTN_FILTER_ARCHIVE:"UI_NOTES_BTN_FILTER_ARCHIVE",NOTES_BTN_BATCH_MODE:"UI_NOTES_BTN_BATCH_MODE",NOTES_CARD_ITEM:"UI_NOTES_CARD_ITEM",NOTES_BTN_DELETE_ITEM:"UI_NOTES_BTN_DELETE_ITEM",TOOLS_BTN_TAB_GEN:"UI_TOOLS_BTN_TAB_GEN",TOOLS_BTN_TAB_VIS:"UI_TOOLS_BTN_TAB_VIS",TOOLS_GEN_BTN_IMAGE:"UI_TOOLS_GEN_BTN_IMAGE",TOOLS_GEN_BTN_VIDEO:"UI_TOOLS_GEN_BTN_VIDEO",TOOLS_VIS_BTN_UPLOAD:"UI_TOOLS_VIS_BTN_UPLOAD",TOOLS_VIS_BTN_CAMERA:"UI_TOOLS_VIS_BTN_CAMERA",TOOLS_VIS_BTN_EDIT:"UI_TOOLS_VIS_BTN_EDIT",MECH_BTN_SCAN:"UI_MECH_BTN_SCAN",MECH_BTN_REFRESH_KEYS:"UI_MECH_BTN_REFRESH_KEYS",MECH_BTN_OPTIMIZE:"UI_MECH_BTN_OPTIMIZE",MECH_BTN_CLEAR_LOGS:"UI_MECH_BTN_CLEAR_LOGS",MECH_BTN_HARD_RESET:"UI_MECH_BTN_HARD_RESET",MECH_INPUT_CLI:"UI_MECH_INPUT_CLI",SETTINGS_BTN_LANG_ID:"UI_SETTINGS_BTN_LANG_ID",SETTINGS_BTN_LANG_EN:"UI_SETTINGS_BTN_LANG_EN",SETTINGS_BTN_LANG_BN:"UI_SETTINGS_BTN_LANG_BN",SETTINGS_BTN_THEME_SYSTEM:"UI_SETTINGS_BTN_THEME_SYSTEM",SETTINGS_BTN_THEME_LIGHT:"UI_SETTINGS_BTN_THEME_LIGHT",SETTINGS_BTN_THEME_DARK:"UI_SETTINGS_BTN_THEME_DARK",SETTINGS_BTN_SAVE:"UI_SETTINGS_BTN_SAVE",SETTINGS_BTN_RESET:"UI_SETTINGS_BTN_RESET",SETTINGS_BTN_BACKUP:"UI_SETTINGS_BTN_BACKUP",SETTINGS_BTN_RESTORE:"UI_SETTINGS_BTN_RESTORE",DEBUG_TOGGLE:"UI_DEBUG_TOGGLE"},ae={NAVIGATE_TO_FEATURE:"FN_NAVIGATE_TO_FEATURE",UI_TOGGLE_SIDEBAR:"FN_UI_TOGGLE_SIDEBAR",OPEN_SYSTEM_MECHANIC:"FN_OPEN_SYSTEM_MECHANIC",TOGGLE_VAULT_LOCK:"FN_TOGGLE_VAULT_LOCK",CHAT_SEND_MESSAGE:"FN_CHAT_SEND_MESSAGE",CHAT_NEW_SESSION:"FN_CHAT_NEW_SESSION",CHAT_TOGGLE_LIVE:"FN_CHAT_TOGGLE_LIVE",CHAT_LOAD_HISTORY:"FN_CHAT_LOAD_HISTORY",CHAT_SELECT_MODEL:"FN_CHAT_SELECT_MODEL",CHAT_DELETE_SESSION:"FN_CHAT_DELETE_SESSION",NOTE_CREATE:"FN_NOTE_CREATE",NOTE_DELETE:"FN_NOTE_DELETE",NOTE_UPDATE:"FN_NOTE_UPDATE",NOTE_SEARCH:"FN_NOTE_SEARCH",NOTE_BATCH_ACTION:"FN_NOTE_BATCH_ACTION",TOOL_GENERATE_IMAGE:"FN_TOOL_GENERATE_IMAGE",TOOL_GENERATE_VIDEO:"FN_TOOL_GENERATE_VIDEO",TOOL_ANALYZE_IMAGE:"FN_TOOL_ANALYZE_IMAGE",TOOL_CAMERA_CAPTURE:"FN_TOOL_CAMERA_CAPTURE",MECH_RUN_DIAGNOSIS:"FN_MECH_RUN_DIAGNOSIS",MECH_EXECUTE_FIX:"FN_MECH_EXECUTE_FIX",MECH_CLI_EXEC:"FN_MECH_CLI_EXEC",SET_LANGUAGE:"FN_SET_LANGUAGE",SET_THEME_MODE:"FN_SET_THEME_MODE",SET_ACCENT_COLOR:"FN_SET_ACCENT_COLOR",SAVE_CONFIG:"FN_SAVE_CONFIG",RESET_SYSTEM:"FN_RESET_SYSTEM",BACKUP_DATA:"FN_BACKUP_DATA",RESTORE_DATA:"FN_RESTORE_DATA",TRIGGER_DEBUG:"FN_TRIGGER_DEBUG",VALIDATE_REGISTRY:"FN_VALIDATE_REGISTRY"},ba=150;class Ea{constructor(){this.logs=[],this.listeners=[],this.uiListeners=[],this.metrics=[],this.uiState={},this.lastInteractionId=null,this.updateScheduled=!1,this.uiUpdateScheduled=!1,this.UPDATE_INTERVAL_MS=100,this.logs.push({id:Y(),timestamp:new Date().toISOString(),layer:"KERNEL",level:"INFO",code:"BOOT",message:"System Reliability Monitor v13.5 Active (Optimized Core).",payload:{}}),this.initializeUIMatrix()}initializeUIMatrix(){Object.values(Q).forEach(e=>{this.uiState[e]={id:e,status:"ACTIVE",errorCount:0,usageCount:0,lastUsed:null}})}logAction(e,s,n="OK",r){const i=this.uiState[e];return i&&i.status==="DISABLED"?(this.log("WARN","UI_GATEKEEPER","BLOCKED",`Interaction with ${e} blocked by System Mechanic.`),!1):(this.lastInteractionId=e,i&&(i.usageCount++,i.lastUsed=new Date().toISOString(),this.notifyUI()),this.log("TRACE","INTERACTION",s,`[${e}] executed. Result: ${n}`,r),!0)}reportUIError(e){if(this.lastInteractionId&&this.uiState[this.lastInteractionId]){const s=this.uiState[this.lastInteractionId];s.errorCount++,s.errorCount>=3&&s.status!=="DISABLED"&&(s.status="UNSTABLE",this.log("WARN","MECHANIC","AUTO_FLAG",`UI Element ${s.id} flagged UNSTABLE due to high error rate.`)),this.notifyUI()}}setUIStatus(e,s){this.uiState[e]&&(this.uiState[e].status=s,s==="ACTIVE"&&(this.uiState[e].errorCount=0),this.notifyUI(),this.log("INFO","MECHANIC","OVERRIDE",`UI Element ${e} set to ${s}`))}getUIMatrix(){return this.uiState}runGhostScan(){let e=0;return Object.values(this.uiState).forEach(s=>{s.errorCount>0&&s.status==="ACTIVE"&&(s.status="UNSTABLE",e++)}),this.notifyUI(),e}log(e,s,n,r,i={}){const o={id:Y(),timestamp:new Date().toISOString(),layer:s,level:e,code:n,message:r,payload:JSON.parse(JSON.stringify(i||{}))};this.logs.unshift(o),this.logs.length>ba&&this.logs.pop(),this.notify()}reportToExternal(e,s={}){const n={name:e.name,message:e.message,stack:e.stack,context:{...s,lastInteraction:this.lastInteractionId,timestamp:new Date().toISOString()}};this.log("ERROR","CRASH_REPORT","EXCEPTION",e.message,n)}trackNetwork(e,s){const n=Date.now()-s;this.metrics.push({endpoint:e,latency:n,timestamp:Date.now()}),this.metrics.length>50&&this.metrics.shift(),this.log("TRACE","NETWORK","LATENCY",`${e} took ${n}ms`,{latency:n})}getSystemHealth(){const e=this.metrics.length>0?Math.round(this.metrics.reduce((n,r)=>n+r.latency,0)/this.metrics.length):0,s=performance.memory?Math.round(performance.memory.usedJSHeapSize/1024/1024):null;return{avgLatency:e,memoryMb:s,errorCount:this.logs.filter(n=>n.level==="ERROR").length,activeListeners:this.listeners.length}}getLogs(){return this.logs}subscribe(e){return this.listeners.push(e),e(this.logs),()=>{this.listeners=this.listeners.filter(s=>s!==e)}}subscribeUI(e){return this.uiListeners.push(e),e({...this.uiState}),()=>{this.uiListeners=this.uiListeners.filter(s=>s!==e)}}notify(){this.updateScheduled||(this.updateScheduled=!0,setTimeout(()=>{this.listeners.forEach(e=>e(this.logs)),this.updateScheduled=!1},this.UPDATE_INTERVAL_MS))}notifyUI(){this.uiUpdateScheduled||(this.uiUpdateScheduled=!0,setTimeout(()=>{this.uiListeners.forEach(e=>e({...this.uiState})),this.uiUpdateScheduled=!1},this.UPDATE_INTERVAL_MS))}clear(){this.logs=[],this.metrics=[],this.log("INFO","OPS","CLEAN","System logs purged manually.")}runSelfDiagnosis(e){if(this.log("INFO","SELF_CHECK","INIT","Running comprehensive system audit..."),e){const s=e.getAllProviderStatuses();this.log("INFO","SELF_CHECK","KEYS_OK",`Providers: ${s.length}`)}this.log("INFO","SELF_CHECK","COMPLETE","Audit finished.")}}const I=new Ea,ps={OMNI_RACE:!0,LIVE_LINK:!0,VISUAL_ENGINE:!0,HIGH_PERF_UI:!1,AUTO_DIAGNOSTICS:!0},Ln=h.createContext(void 0),Sa=({children:t})=>{const[e,s]=U("sys_feature_flags",ps),n=i=>{s(o=>{const c=!o[i];return I.log("INFO","SYS_CONFIG","TOGGLE",`${i} switched to ${c?"ON":"OFF"}`),{...o,[i]:c}})},r=i=>e[i]??ps[i];return h.useEffect(()=>{const i=document.documentElement;e.HIGH_PERF_UI?(i.style.removeProperty("--backdrop-blur"),i.classList.remove("reduce-motion"),document.body.classList.remove("low-perf")):(i.style.setProperty("--backdrop-blur","0px"),i.classList.add("reduce-motion"),document.body.classList.add("low-perf"))},[e.HIGH_PERF_UI]),a.jsx(Ln.Provider,{value:{features:e,toggleFeature:n,isFeatureEnabled:r},children:t})},jn=()=>{const t=h.useContext(Ln);if(!t)throw new Error("useFeatures must be used within a FeatureProvider");return t},ya=h.memo(({activeFeature:t,setActiveFeature:e})=>{const[s]=U("ai_persona_mode","hanisah"),[n,r]=U("sidebar_expanded",!1),{isForcedStealth:i}=On(),{features:o}=jn(),[c,l]=h.useState(100),[d,u]=h.useState("bg-emerald-500"),[m,p]=h.useState(I.getUIMatrix());h.useEffect(()=>{const b=S=>{(S.ctrlKey||S.metaKey)&&S.key.toLowerCase()==="b"&&(S.preventDefault(),r(v=>!v))};return window.addEventListener("keydown",b),()=>window.removeEventListener("keydown",b)},[r]),h.useEffect(()=>{if(!o.AUTO_DIAGNOSTICS){l(0),u("bg-neutral-600");return}const b=()=>{const k=I.getSystemHealth();let E=100;k.avgLatency>500&&(E-=10),k.avgLatency>1500&&(E-=20),E-=k.errorCount*5,k.memoryMb&&k.memoryMb>500&&(E-=10),E=Math.max(0,Math.min(100,E)),l(E),E>=80?u("bg-emerald-500 shadow-[0_0_15px_#10b981]"):E>=50?u("bg-amber-500 shadow-[0_0_15px_#f59e0b]"):u("bg-red-500 shadow-[0_0_15px_#ef4444]")};b();const S=setInterval(b,5e3),v=I.subscribeUI(k=>p(k));return()=>{clearInterval(S),v()}},[o.AUTO_DIAGNOSTICS]);const g=h.useCallback(b=>{const v={dashboard:"dashboard",notes:"notes",chat:"chat",tools:"tools",system:"system",settings:"settings",raw:"raw"}[b];return b==="raw"?"RAW_MODE":v?ma("sidebar",v):b.toUpperCase()},[]),f=h.useCallback((b,S)=>{I.logAction(S,ae.NAVIGATE_TO_FEATURE,b)&&e(b)},[e]);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:`
            hidden md:block h-full flex-none shrink-0 
            transition-[width] duration-500 cubic-bezier(0.2, 0.8, 0.2, 1)
            ${n?"w-[280px]":"w-[88px]"}
        `}),a.jsx("aside",{className:`
          hidden md:flex flex-col fixed top-0 left-0 bottom-0 z-[1200] 
          bg-skin-card/95 backdrop-blur-2xl 
          border-r border-skin-border/80
          transition-all duration-500 ease-[cubic-bezier(0.2,0.8,0.2,1)] will-change-transform transform-gpu
          ${n?"w-[280px] shadow-[20px_0_60px_-12px_rgba(0,0,0,0.18)] dark:shadow-[20px_0_60px_-12px_rgba(0,0,0,0.5)] translate-x-0":"w-[88px] translate-x-0"}
          ${i?"opacity-0 pointer-events-none -translate-x-10":"opacity-100"}
        `,"aria-label":"Main Navigation",children:a.jsxs("div",{className:"flex flex-col h-full w-full overflow-hidden py-6 pt-safe pb-safe relative",children:[a.jsx("div",{className:"absolute top-0 left-0 right-0 h-40 bg-gradient-to-b from-accent/5 to-transparent pointer-events-none"}),a.jsxs("div",{className:`px-6 mb-8 transition-all duration-500 flex flex-col relative z-10 ${n?"items-start":"items-center"}`,children:[a.jsxs("div",{className:"flex items-center justify-between w-full",children:[a.jsx("button",{onClick:()=>f("dashboard",Q.SIDEBAR_BTN_LOGO),className:"relative group outline-none focus-visible:ring-2 focus-visible:ring-accent/50 rounded-[18px] transition-all sheen",title:"Dashboard",children:a.jsx("div",{className:`
                      shrink-0 w-11 h-11 rounded-[18px] flex items-center justify-center 
                      bg-gradient-to-br from-skin-card to-skin-surface/90
                      border border-skin-border
                      shadow-sm group-hover:shadow-[0_0_30px_var(--accent-glow)] group-hover:border-accent/40
                      transition-all duration-300 transform group-hover:scale-[1.06]
                    `,children:a.jsx("div",{className:"text-skin-text transition-colors duration-300 group-hover:text-accent",children:s==="hanisah"?a.jsx(sr,{size:22,strokeWidth:2.5}):a.jsx(wt,{size:22,strokeWidth:2.5})})})}),a.jsx("div",{className:`transition-opacity duration-300 ${n?"opacity-100":"opacity-0 pointer-events-none"}`,children:a.jsx("button",{onClick:()=>r(!1),className:"p-2 rounded-xl text-skin-muted hover:text-skin-text hover:bg-skin-surface active:scale-90 transition-all outline-none",children:a.jsx(nr,{size:18})})})]}),a.jsx("div",{className:`absolute top-0 right-0 left-0 flex justify-center transition-all duration-300 ${n?"opacity-0 pointer-events-none translate-y-10":"opacity-100 translate-y-14"}`,children:a.jsx("button",{onClick:()=>r(!0),className:"p-2 rounded-xl text-skin-muted hover:text-accent hover:bg-accent/10 active:scale-90 transition-all outline-none",children:a.jsx(rr,{size:20,strokeWidth:2})})}),a.jsxs("div",{className:`mt-5 overflow-hidden whitespace-nowrap transition-all duration-500 ease-out flex flex-col ${n?"opacity-100 translate-x-0":"opacity-0 -translate-x-4 pointer-events-none"}`,children:[a.jsxs("h1",{className:"text-lg font-black tracking-tighter text-skin-text leading-none uppercase flex items-center gap-2",children:["ISTOIC ",a.jsx("span",{className:"text-accent",children:"TITANIUM"})]}),a.jsxs("p",{className:"text-[9px] font-mono text-skin-muted mt-1.5 flex items-center gap-1.5 opacity-70",children:[a.jsx(ar,{size:10})," + B TO TOGGLE"]})]})]}),a.jsx("nav",{className:"flex-1 flex flex-col gap-1.5 px-3 w-full relative z-10","aria-label":"Feature Links",children:kn.map(b=>{var A;const S=t===b.id,v=g(b.id),k=Q[`SIDEBAR_BTN_${b.id.toUpperCase()}`]||Q.SIDEBAR_BTN_DASHBOARD,E=((A=m[k])==null?void 0:A.status)==="DISABLED";return a.jsxs("button",{onClick:()=>!E&&f(b.id,k),disabled:E,className:`
                    relative flex items-center rounded-[18px] transition-all duration-300 group outline-none sheen
                    ${n?"w-full px-4 py-3.5 gap-4":"w-12 h-12 justify-center mx-auto aspect-square"}
                    ${E?"opacity-40 cursor-not-allowed grayscale":S?"bg-gradient-to-r from-accent/15 via-accent/8 to-transparent border-l-2 border-accent text-accent shadow-[0_10px_30px_-18px_var(--accent-glow)]":"hover:bg-skin-surface/80 text-skin-muted hover:text-skin-text border-l-2 border-transparent"}
                    focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-accent/50
                  `,title:n?void 0:v,children:[S&&!E&&a.jsx("div",{className:"absolute inset-0 bg-accent/5 blur-md rounded-[18px] opacity-50"}),a.jsx("div",{className:`relative z-10 transition-transform duration-300 ${S?"scale-105":"group-hover:scale-110 group-active:scale-95"}`,children:E?a.jsx(Ae,{size:20,className:"text-red-500"}):ke.cloneElement(b.icon,{size:22,strokeWidth:S?2.5:2,className:S?"drop-shadow-sm":""})}),a.jsxs("div",{className:`
                    overflow-hidden whitespace-nowrap transition-all duration-500 ease-[cubic-bezier(0.2,0.8,0.2,1)] 
                    flex-1 flex justify-between items-center
                    ${n?"opacity-100 max-w-full pl-1 translate-x-0":"opacity-0 max-w-0 -translate-x-2"}
                  `,children:[a.jsx("span",{className:`text-[11px] font-bold tracking-[0.15em] uppercase ${E?"text-red-500 line-through":""}`,children:v}),S&&a.jsx(Lt,{size:14,className:"text-accent opacity-80 animate-pulse",strokeWidth:3})]})]},b.id)})}),a.jsxs("div",{className:"mt-auto px-4 flex flex-col gap-3 relative z-10",children:[a.jsx("button",{onClick:()=>f("system",Q.SIDEBAR_BTN_SYSTEM),className:`
                    rounded-[20px] transition-all w-full text-left group relative overflow-hidden outline-none focus-visible:ring-2 focus-visible:ring-accent/50 sheen
                    ${n?"p-3.5 bg-skin-surface/60 border border-skin-border hover:border-accent/30 hover:bg-skin-surface":"p-0 border-transparent bg-transparent justify-center flex"}
                `,title:n?void 0:`Integrity: ${c}%`,children:n?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex justify-between items-center text-[9px] font-black text-skin-muted uppercase tracking-widest mb-2 group-hover:text-skin-text transition-colors relative z-10",children:[a.jsxs("span",{className:"flex items-center gap-2",children:[o.AUTO_DIAGNOSTICS?a.jsx(Re,{size:12,className:c<80?"animate-pulse text-amber-500":"text-emerald-500"}):a.jsx(Ae,{size:12}),"SYSTEM_HEALTH"]}),a.jsxs("span",{className:`font-mono ${c<80?"text-red-500":"text-emerald-500"}`,children:[c,"%"]})]}),a.jsx("div",{className:"w-full h-1.5 bg-skin-main rounded-full overflow-hidden relative z-10",children:a.jsx("div",{className:`h-full ${o.AUTO_DIAGNOSTICS?d:"bg-neutral-600"} transition-all duration-1000 ease-out rounded-full`,style:{width:`${c}%`}})})]}):a.jsx("div",{className:`w-3 h-3 rounded-full ${o.AUTO_DIAGNOSTICS?d:"bg-neutral-600"} transition-all duration-500 mb-4 ring-2 ring-skin-card`})}),a.jsx("div",{className:`h-[1px] bg-gradient-to-r from-transparent via-skin-border to-transparent mx-2 transition-all duration-500 ${n?"opacity-100":"opacity-0"}`}),a.jsxs("button",{onClick:()=>f("settings",Q.SIDEBAR_BTN_SETTINGS),className:`
                  flex items-center rounded-[18px] transition-all duration-300 group outline-none focus-visible:ring-2 focus-visible:ring-accent/50 sheen
                  ${n?"w-full px-4 py-3 gap-3 bg-transparent hover:bg-skin-surface/80 text-skin-muted hover:text-skin-text":"w-12 h-12 justify-center mx-auto hover:bg-skin-surface/80 text-skin-muted"}
                  ${t==="settings"?"text-accent":""}
                `,title:n?void 0:"SETTINGS",children:[a.jsx(Xe,{size:22,className:`${t==="settings"?"animate-spin-slow text-accent":"group-hover:rotate-45 transition-transform"} shrink-0`,strokeWidth:1.5}),a.jsx("div",{className:`overflow-hidden whitespace-nowrap transition-all duration-500 ease-out ${n?"opacity-100 max-w-full":"opacity-0 max-w-0"}`,children:a.jsx("span",{className:"text-[10px] font-bold tracking-[0.2em] uppercase",children:"CONFIG"})})]})]})]})})]})}),Ta=h.memo(({activeFeature:t,setActiveFeature:e})=>{const{shouldShowNav:s,isInputFocused:n}=On(),r=s&&!n;return a.jsx("div",{className:`
        md:hidden fixed left-1/2 -translate-x-1/2 
        transition-all cubic-bezier(0.2, 0.8, 0.2, 1) 
        will-change-transform w-auto max-w-[calc(100vw-32px)]
        z-[1000] ${r?"pointer-events-auto":"pointer-events-none"}
        /* SAFE AREA FIX: Calculate bottom position including notch area + margin */
        ${r?"bottom-[calc(1.2rem+env(safe-area-inset-bottom))] opacity-100 translate-y-0 scale-100 duration-500 delay-100":"bottom-0 opacity-0 translate-y-10 scale-90 duration-300"}
      `,role:"navigation","aria-label":"Navigasi Utama",children:a.jsxs("nav",{className:`
        flex items-center gap-1 p-2
        bg-skin-card/90 backdrop-blur-2xl 
        border border-skin-border/80 
        rounded-[24px] 
        shadow-[0_12px_40px_-14px_rgba(0,0,0,0.2)]
        ring-1 ring-black/5 dark:ring-white/5
      `,children:[kn.map(i=>{const o=t===i.id;return a.jsxs("button",{onClick:()=>e(i.id),"aria-label":`Buka ${i.name}`,"aria-current":o?"page":void 0,className:`
                relative w-12 h-12 flex flex-col items-center justify-center rounded-[18px] 
                transition-all duration-300 group sheen
                pointer-events-auto
                ${o?"bg-accent/10 text-accent shadow-[0_10px_24px_-16px_var(--accent-glow)]":"text-neutral-500 hover:text-black dark:hover:text-white hover:bg-skin-surface/70 border border-transparent"}
              `,children:[a.jsx("div",{className:`transition-transform duration-300 ${o?"-translate-y-1 scale-110":"group-active:scale-95"}`,children:ke.cloneElement(i.icon,{size:20,strokeWidth:o?2.5:2})}),o&&a.jsx("span",{className:"absolute bottom-1.5 text-[8px] font-black uppercase tracking-widest scale-75 origin-bottom text-accent",children:""})]},i.id)}),a.jsx("div",{className:"w-[1px] h-6 bg-black/10 dark:bg-white/10 mx-1"}),a.jsx("div",{className:"flex items-center gap-1",children:a.jsx("button",{onClick:()=>e("settings"),"aria-label":"Buka Pengaturan",className:`
                    w-12 h-12 flex items-center justify-center rounded-[18px] transition-all pointer-events-auto sheen
                    ${t==="settings"?"bg-black dark:bg-white text-white dark:text-black shadow-lg scale-105":"text-neutral-500 hover:text-black dark:hover:text-white hover:bg-skin-surface/70"}
                `,children:a.jsx(Xe,{size:20,className:t==="settings"?"animate-spin-slow":""})})})]})})}),Ne={},Ht=new TextEncoder,va=new TextDecoder,Na=6e5,Pn="SHA-256",Ft="AES-GCM",Aa=256,Dn=t=>crypto.subtle.importKey("raw",Ht.encode(t),"PBKDF2",!1,["deriveKey"]),Mn=async(t,e,s)=>crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:Na,hash:Pn},t,{name:Ft,length:Aa},!1,s),ut=t=>{const e=Array.from(new Uint8Array(t),s=>String.fromCharCode(s)).join("");return btoa(e)},pt=t=>{try{const e=atob(t);return Uint8Array.from(e,s=>s.codePointAt(0))}catch{return console.error("Crypto Decode Error: Invalid Base64"),new Uint8Array(0)}},rt=async t=>{const e=Ht.encode(t),s=await crypto.subtle.digest(Pn,e);return Array.from(new Uint8Array(s)).map(r=>r.toString(16).padStart(2,"0")).join("")},lo=async(t,e,s)=>{const r=`${[t,e].sort().join(":")}:${s}`,i=await rt(r);return i.substring(0,4).toUpperCase()+" "+i.substring(4,8).toUpperCase()},Un=async t=>{if(!t)return!1;const e=await rt(t),s=localStorage.getItem("sys_vault_hash");return e===s},Gn=async t=>{if(!t)return!1;const e=Ne==null?void 0:Ne.VITE_VAULT_PIN_HASH;return e?await rt(t)===e:!1},Ca=async t=>await Gn(t)?(console.log("[VAULT] Master Key Bypass Accepted."),!0):await Un(t),Hn=async t=>{const e=await rt(t);localStorage.setItem("sys_vault_hash",e)},he=()=>{const t=localStorage.getItem("sys_vault_hash"),e=Ne==null?void 0:Ne.VITE_VAULT_PIN_HASH;return!!(t||e)},uo=async(t,e)=>{try{const s=crypto.getRandomValues(new Uint8Array(16)),n=crypto.getRandomValues(new Uint8Array(12)),r=await Dn(e),i=await Mn(r,s,["encrypt"]),o=await crypto.subtle.encrypt({name:Ft,iv:n},i,Ht.encode(t)),c={v:1,salt:ut(s),iv:ut(n),cipher:ut(o)};return JSON.stringify(c)}catch(s){return console.error("CRYPTO_FAIL: Encryption Error",s),null}},ms=async(t,e)=>{try{const s=JSON.parse(t);if(!s.salt||!s.iv||!s.cipher)throw new Error("Invalid Crypto Package");const n=pt(s.salt),r=pt(s.iv),i=pt(s.cipher),o=await Dn(e),c=await Mn(o,n,["decrypt"]),l=await crypto.subtle.decrypt({name:Ft,iv:r},c,i);return va.decode(l)}catch{return null}},Ia=({isOpen:t,onClose:e,onSuccess:s})=>{const[n,r]=h.useState(""),[i,o]=h.useState(!1),[c,l]=h.useState(!1),[d,u]=h.useState(!1),[m,p]=h.useState(!0),g=h.useRef(null);h.useEffect(()=>{if(t){r(""),o(!1);const x=he();p(x),x&&setTimeout(()=>{var b;return(b=g.current)==null?void 0:b.focus()},100)}},[t]);const f=async x=>{if(x==null||x.preventDefault(),u(!0),!m){s(),e();return}await Ca(n)?(s(),e()):(o(!0),l(!0),r(""),setTimeout(()=>l(!1),500)),u(!1)};return t?a.jsxs("div",{className:"fixed inset-0 z-[5000] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md animate-fade-in",children:[a.jsxs("div",{className:`
                relative w-full max-w-sm bg-white dark:bg-[#0a0a0b] border border-black/5 dark:border-white/10 rounded-[32px] p-8 
                shadow-[0_20px_50px_rgba(0,0,0,0.3)] flex flex-col items-center gap-6
                ${c?"animate-[shake_0.5s_cubic-bezier(.36,.07,.19,.97)_both]":""}
            `,children:[a.jsx("button",{onClick:e,className:"absolute top-6 right-6 text-neutral-400 hover:text-black dark:hover:text-white transition-colors",children:a.jsx(tt,{size:20})}),a.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center transition-all duration-500 ${i?"bg-red-500/10 text-red-500 shadow-[0_0_30px_rgba(239,68,68,0.2)]":"bg-accent/10 text-accent shadow-[0_0_30px_var(--accent-glow)]"}`,children:m?i?a.jsx(ir,{size:32}):a.jsx(jt,{size:32}):a.jsx(Xe,{size:32})}),a.jsxs("div",{className:"text-center space-y-2",children:[a.jsx("h3",{className:"text-xl font-black text-black dark:text-white uppercase italic tracking-tighter",children:m?i?"ACCESS DENIED":"SECURITY CLEARANCE":"VAULT UNSECURED"}),a.jsx("p",{className:"text-[10px] tech-mono font-bold text-neutral-500 uppercase tracking-widest",children:m?i?"INVALID PASSCODE":"ENTER VAULT PIN TO DECRYPT":"NO PIN CONFIGURED"})]}),m?a.jsxs("form",{onSubmit:f,className:"w-full relative",children:[a.jsx("input",{ref:g,type:"password",value:n,onChange:x=>{r(x.target.value),o(!1)},className:"w-full bg-zinc-100 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-xl px-4 py-4 text-center text-2xl font-black text-black dark:text-white tracking-[0.5em] focus:outline-none focus:border-accent/50 focus:bg-white dark:focus:bg-white/10 transition-all placeholder:text-neutral-300 dark:placeholder:text-white/10",placeholder:"",maxLength:10,autoComplete:"off",disabled:d}),a.jsx(Pt,{className:"absolute right-4 top-1/2 -translate-y-1/2 text-neutral-300 dark:text-white/20 pointer-events-none",size:20})]}):a.jsx("div",{className:"text-center text-xs text-neutral-500 px-4",children:"System security is currently disabled. Please configure a PIN in Settings to secure your data."}),a.jsxs("button",{onClick:()=>f(),disabled:d,className:"w-full py-4 bg-black dark:bg-white text-white dark:text-black hover:bg-accent dark:hover:bg-accent hover:text-black dark:hover:text-black transition-all rounded-xl font-black uppercase text-[11px] tracking-[0.3em] flex items-center justify-center gap-2 shadow-lg hover:scale-[1.02] active:scale-95 disabled:opacity-50",children:[m?i?a.jsx(Ee,{size:14}):a.jsx(Os,{size:14}):a.jsx(Xe,{size:14}),m?d?"VERIFYING...":i?"RETRY AUTH":"AUTHENTICATE":"PROCEED & SETUP"]}),a.jsx("p",{className:"text-[8px] text-neutral-400 font-mono text-center",children:"SECURE_ENCLAVE_V15.0 // HARDWARE_ENCRYPTION_ACTIVE"})]}),a.jsx("style",{children:`
                @keyframes shake {
                    10%, 90% { transform: translate3d(-1px, 0, 0); }
                    20%, 80% { transform: translate3d(2px, 0, 0); }
                    30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
                    40%, 60% { transform: translate3d(4px, 0, 0); }
                }
            `})]}):null},Fn=h.createContext(void 0),_a=({children:t})=>{const[e,s]=h.useState(!1),[n,r]=h.useState(!1),[i]=U("hanisah_tools_config",{search:!0,vault:!0,visual:!0}),[o]=U("stoic_tools_config",{search:!0,vault:!0,visual:!1});h.useEffect(()=>{r(he())},[]);const c=h.useCallback(()=>s(!0),[]),l=h.useCallback(()=>s(!1),[]),d=h.useCallback(u=>u==="hanisah"?i.vault:o.vault,[i,o]);return h.useEffect(()=>{!i.vault&&!o.vault&&e&&(console.warn("[SECURITY] Vault disabled in settings. Locking session."),s(!1))},[i,o,e]),a.jsx(Fn.Provider,{value:{isVaultUnlocked:e,unlockVault:c,lockVault:l,isVaultConfigEnabled:d,isPinSet:n},children:t})},Bn=()=>{const t=h.useContext(Fn);if(!t)throw new Error("useVault must be used within a VaultProvider");return t},Ra="IStoicAI_Vault_DB",ka=2,ie={AUDIO:"audio_cache",NOTES:"notes_store",VECTORS:"vector_index"};let Oe=null;const we=()=>Oe||(Oe=new Promise((t,e)=>{const s=indexedDB.open(Ra,ka);s.onupgradeneeded=n=>{const r=n.target.result;if(r.objectStoreNames.contains(ie.AUDIO)||r.createObjectStore(ie.AUDIO),!r.objectStoreNames.contains(ie.NOTES)){const i=r.createObjectStore(ie.NOTES,{keyPath:"id"});i.createIndex("updated","updated",{unique:!1}),i.createIndex("title","title",{unique:!1})}r.objectStoreNames.contains(ie.VECTORS)||r.createObjectStore(ie.VECTORS,{keyPath:"id"}).createIndex("noteId","noteId",{unique:!0})},s.onsuccess=()=>t(s.result),s.onerror=()=>{Oe=null,e(s.error)}}),Oe),J={async put(t,e,s){const n=await we();return new Promise((r,i)=>{const c=n.transaction(t,"readwrite").objectStore(t),l=s?c.put(e,s):c.put(e);l.onsuccess=()=>r(),l.onerror=()=>i(l.error)})},async get(t,e){const s=await we();return new Promise(n=>{const i=s.transaction(t,"readonly").objectStore(t).get(e);i.onsuccess=()=>n(i.result),i.onerror=()=>n(void 0)})},async getAll(t){const e=await we();return new Promise(s=>{const r=e.transaction(t,"readonly").objectStore(t).getAll();r.onsuccess=()=>s(r.result||[]),r.onerror=()=>s([])})},async delete(t,e){const s=await we();return new Promise((n,r)=>{const o=s.transaction(t,"readwrite").objectStore(t).delete(e);o.onsuccess=()=>n(),o.onerror=()=>r(o.error)})},async clear(t){const e=await we();return new Promise((s,n)=>{const i=e.transaction(t,"readwrite").objectStore(t).clear();i.onsuccess=()=>s(),i.onerror=()=>n(i.error)})},STORES:ie},It={async get(t){try{return await J.get(ie.AUDIO,t)}catch{return}},async set(t,e){try{await J.put(ie.AUDIO,e,t)}catch(s){console.warn("IDB Audio Write Error",s)}},async clear(){try{await J.clear(ie.AUDIO)}catch(t){console.warn("Audio Cache Clear Error",t)}}};class Oa{constructor(){this.sessionSalt=crypto.getRandomValues(new Uint8Array(64))}getKeystreamByte(e){const s=this.sessionSalt[e%this.sessionSalt.length],n=this.sessionSalt[(e+1)%this.sessionSalt.length];return s^e*31&255^n<<2}cloak(e){if(!e)return"";const n=new TextEncoder().encode(e),r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n[i]^this.getKeystreamByte(i);return Array.from(r).map(i=>i.toString(16).padStart(2,"0")).join("")}decloak(e){if(!e)return"";const s=e.match(/.{1,2}/g);if(!s)return"";const n=new Uint8Array(s.map(o=>parseInt(o,16))),r=new Uint8Array(n.length);for(let o=0;o<n.length;o++)r[o]=n[o]^this.getKeystreamByte(o);return new TextDecoder().decode(r)}synthesizeEndpoint(e){return String.fromCharCode(...e)}wipe(e){typeof e=="string"?e=null:(e instanceof Uint8Array||e instanceof Array)&&e.fill(0)}}const je=new Oa,wa={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class La{constructor(){this.vault={},this.counters={},this.refreshPools()}refreshPools(){const e=wa||{},s=["GEMINI","GROQ","OPENAI","DEEPSEEK","MISTRAL","OPENROUTER","ELEVENLABS","HUGGINGFACE"],n=!0;s.forEach(r=>{const i=new Set;(c=>{if(!c||typeof c!="string")return;const l=c.replace(/['"\s]/g,"").trim(),d=["INSERT","KEY","YOUR_API","TODO","CHANGE_ME","EXAMPLE"],u=/^[A-Za-z0-9\-\_\.]+$/,m=d.some(f=>l.toUpperCase().includes(f)),p=l.length<8,g=!u.test(l);!m&&!p&&!g?i.add(l):l.length>0&&console.warn(`[HYDRA_VAULT] Rejected key for ${r}: Failed Integrity Check.`)})(e[`VITE_${r}_API_KEY`]),i.size===0&&n&&i.add("server-side-managed"),this.vault[r]=Array.from(i).map((c,l)=>({cloakedKey:je.cloak(c),provider:r,status:"ACTIVE",fails:0,cooldownUntil:0,id:`${r}_${l}`})),this.counters[r]===void 0&&(this.counters[r]=0)})}getKey(e){const s=this.vault[e];if(!s||s.length===0)return null;const n=Date.now();s.forEach(c=>{c.status==="COOLDOWN"&&c.cooldownUntil<=n&&(c.status="ACTIVE",c.fails=0)});const r=s.filter(c=>c.status==="ACTIVE");if(r.length===0){const c=s.find(l=>je.decloak(l.cloakedKey)==="server-side-managed");return c&&c.status==="COOLDOWN"&&c.cooldownUntil>n,null}let i=this.counters[e]%r.length;const o=r[i];return this.counters[e]=(i+1)%r.length,je.decloak(o.cloakedKey)}reportFailure(e,s,n){if(s==="server-side-managed"){I.log("ERROR","BACKEND_PROXY","FAIL",`${e} proxy request failed.`,n);return}const r=this.vault[e];if(!r)return;const i=je.cloak(s),o=r.find(d=>d.cloakedKey===i);if(!o)return;o.fails++,o.status="COOLDOWN";const c=JSON.stringify(n).toLowerCase();let l=3e4;c.includes("429")||c.includes("quota")||c.includes("limit")?l=3e5:(c.includes("503")||c.includes("overloaded"))&&(l=6e4),o.cooldownUntil=Date.now()+l}reportSuccess(e){}isProviderHealthy(e){return(this.vault[e]||[]).some(s=>s.status==="ACTIVE")}getAllProviderStatuses(){const e=Date.now();return Object.keys(this.vault).map(s=>{const n=this.vault[s],r=n.filter(o=>o.status==="COOLDOWN"),i=r.length>0?Math.ceil(Math.min(...r.map(o=>o.cooldownUntil-e))/6e4):0;return{id:s,status:this.isProviderHealthy(s)?"HEALTHY":"COOLDOWN",keyCount:n.length,cooldownRemaining:i>0?i:0}})}}const oe=new La;class ja{refreshPools(){oe.refreshPools()}isProviderHealthy(e){return oe.isProviderHealthy(e)}reportFailure(e,s,n){n!==void 0?oe.reportFailure(e,s,n):I.log("WARN","KEY_MGR","FAIL_REPORT",`Provider ${e} reported failure without key context.`)}reportSuccess(e){oe.reportSuccess(e)}getKey(e){return oe.getKey(e)}getAllProviderStatuses(){return oe.getAllProviderStatuses()}}const q=new ja;async function Pa(t,e,s){var r,i,o;const n=new Be({apiKey:e});try{const c=await n.models.generateContent({model:s,contents:[{role:"user",parts:[{text:t}]}]});if((o=(i=(r=c.candidates)==null?void 0:r[0])==null?void 0:i.content)!=null&&o.parts){for(const l of c.candidates[0].content.parts)if(l.inlineData&&l.inlineData.data)return`data:${l.inlineData.mimeType||"image/png"};base64,${l.inlineData.data}`}}catch(c){throw console.error("Gemini Image Generation Error:",c),c}return null}async function Da(t,e){var i,o,c;const s=je.synthesizeEndpoint([104,116,116,112,115,58,47,47,97,112,105,46,111,112,101,110,97,105,46,99,111,109,47,118,49,47,105,109,97,103,101,115,47,103,101,110,101,114,97,116,105,111,110,115]),n=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:"dall-e-3",prompt:t,n:1,size:"1024x1024",response_format:"b64_json"})});if(!n.ok){const l=await n.json();throw new Error(((i=l.error)==null?void 0:i.message)||"OpenAI Image Generation Failed")}const r=await n.json();return(c=(o=r.data)==null?void 0:o[0])!=null&&c.b64_json?`data:image/png;base64,${r.data[0].b64_json}`:null}async function Ma(t,e="gemini-2.5-flash-image"){const s=q.getKey("GEMINI"),n=q.getKey("OPENAI");let r="";if(s&&e.includes("gemini"))try{const i=await Pa(t,s,e);if(i)return q.reportSuccess("GEMINI"),i}catch(i){I.log("WARN","IMG_GEN","PRIMARY_FAIL",`Gemini ${e} failed: ${i.message}`),r=i.message,oe.reportFailure("GEMINI",s,i)}if(n)try{I.log("INFO","IMG_GEN","FALLBACK_OPENAI","Attempting fallback to OpenAI DALL-E 3...");const i=await Da(t,n);if(i)return q.reportSuccess("OPENAI"),i}catch(i){I.log("ERROR","IMG_GEN","FALLBACK_OPENAI_FAIL",`DALL-E 3 failed: ${i.message}`),oe.reportFailure("OPENAI",n,i),r=i.message}throw r.includes("429")?new Error("QUOTA_EXCEEDED: Image generation limit reached. Please wait or switch providers."):!s&&!n?new Error("NO_KEYS: No API keys available for Image Generation. Please check your settings."):new Error(`GENERATION_FAILED: ${r.slice(0,100)}...`)}async function po(t,e){var r,i,o,c;const s=q.getKey("GEMINI");if(!s)return null;const n=new Be({apiKey:s});try{if(!n.models.generateVideos)return console.warn("generateVideos method not found on this SDK version."),null;let l=await n.models.generateVideos({model:"veo-3.1-fast-generate-preview",prompt:t,config:{numberOfVideos:1,resolution:e.resolution||"720p",aspectRatio:e.aspectRatio||"16:9"}});for(;!l.done&&(await new Promise(p=>setTimeout(p,5e3)),n.operations&&n.operations.getVideosOperation);)l=await n.operations.getVideosOperation({operation:l});const d=(c=(o=(i=(r=l.response)==null?void 0:r.generatedVideos)==null?void 0:i[0])==null?void 0:o.video)==null?void 0:c.uri;if(!d)return null;const m=await(await fetch(`${d}&key=${s}`)).blob();return URL.createObjectURL(m)}catch(l){console.error("Video Gen Error:",l),oe.reportFailure("GEMINI",s,l)}return null}async function mo(t,e,s){var i,o,c;const n=q.getKey("GEMINI");if(!n)return null;const r=new Be({apiKey:n});try{const l=await r.models.generateContent({model:"gemini-2.5-flash-image",contents:[{role:"user",parts:[{inlineData:{data:t,mimeType:e}},{text:`Edit instruction: ${s}`}]}]});if((c=(o=(i=l.candidates)==null?void 0:i[0])==null?void 0:o.content)!=null&&c.parts){for(const d of l.candidates[0].content.parts)if(d.inlineData&&d.inlineData.data)return`data:${d.inlineData.mimeType||"image/png"};base64,${d.inlineData.data}`}}catch(l){oe.reportFailure("GEMINI",n,l)}return null}function Ua(t){let e="";const s=t.byteLength;for(let n=0;n<s;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function Ga(t){const e=atob(t),s=e.length,n=new Uint8Array(s);for(let r=0;r<s;r++)n[r]=e.charCodeAt(r);return n}async function Ha(t,e,s,n){const r=new Int16Array(t.buffer),i=r.length/n,o=e.createBuffer(n,i,s);for(let c=0;c<n;c++){const l=o.getChannelData(c);for(let d=0;d<i;d++)l[d]=r[d*n+c]/32768}return o}const Fa={name:"manage_note",description:"The PRIMARY tool for note management. Creates, updates, appends content, searches, or reads notes in the secure vault.",parameters:{type:Z.OBJECT,properties:{action:{type:Z.STRING,enum:["CREATE","UPDATE","APPEND","DELETE","SEARCH","READ"],description:"The operation to perform."},id:{type:Z.STRING,description:"Target Note ID (Required for UPDATE, APPEND, DELETE, READ)"},title:{type:Z.STRING,description:"Note Title"},content:{type:Z.STRING,description:"Main content of the note"},appendContent:{type:Z.STRING,description:"Text to append to the end of an existing note (for APPEND action)"},tags:{type:Z.ARRAY,items:{type:Z.STRING},description:"Tags for categorization"},query:{type:Z.STRING,description:"Search keywords for SEARCH action"}},required:["action"]}},Ba={name:"search_notes",description:"Legacy tool. Prefer manage_note with action=SEARCH.",parameters:{type:Z.OBJECT,properties:{query:{type:Z.STRING,description:"Keywords to search for."}},required:["query"]}},Va={name:"generate_visual",description:'Generate images using AI models. Triggered by requests like "Draw", "Imagine", "Gambarin".',parameters:{type:Z.OBJECT,properties:{prompt:{type:Z.STRING,description:"A detailed description of the image to generate, in English."}},required:["prompt"]}},$a={googleSearch:{}},_t={functionDeclarations:[Fa,Ba]},Pe={functionDeclarations:[Va]},hs=[$a],Ka="text-embedding-004",za=(t,e)=>{let s=0,n=0,r=0;for(let i=0;i<t.length;i++)s+=t[i]*e[i],n+=t[i]*t[i],r+=e[i]*e[i];return s/(Math.sqrt(n)*Math.sqrt(r))},Ya=(t,e)=>{const s=[];for(let n=0;n<t.length;n+=e)s.push(t.slice(n,n+e));return s},fs=t=>new Promise(e=>setTimeout(e,t)),Wa=()=>new Promise(t=>setTimeout(t,0)),De={async generateEmbedding(t){var s,n,r;const e=q.getKey("GEMINI");if(!e)return null;try{return((n=(s=(await new Be({apiKey:e}).models.embedContent({model:Ka,contents:[{parts:[{text:t}]}]})).embeddings)==null?void 0:s[0])==null?void 0:n.values)||null}catch(i){return(r=i.message)!=null&&r.includes("429")&&(I.log("WARN","VECTOR_DB","RATE_LIMIT","Pausing for rate limit..."),await fs(2e3)),console.error("Embedding generation failed",i),null}},async indexNotes(t,e){let s=0;const n=t.length,r=await J.getAll(J.STORES.VECTORS),i=new Map(r.map(u=>[u.noteId,u])),o=t.filter(u=>{const m=u.id+u.updated.slice(0,19),p=i.get(u.id);return p&&p.hash===m?(s++,!1):!0}),c=3,l=1500,d=Ya(o,c);for(const u of d)await Promise.all(u.map(async m=>{var x;const p=m.id+m.updated.slice(0,19),g=`Title: ${m.title}
Tags: ${(x=m.tags)==null?void 0:x.join(", ")}
Content: ${m.content.slice(0,8e3)}`,f=await this.generateEmbedding(g);f&&(await J.put(J.STORES.VECTORS,{id:m.id,noteId:m.id,embedding:f,hash:p,lastUpdated:new Date().toISOString()}),I.log("TRACE","VECTOR_DB","INDEXED",`Note ${m.id.slice(0,4)} indexed.`)),s++})),e&&e(s,n),await fs(l);return s},async search(t,e=5){const s=await this.generateEmbedding(t);if(!s)return[];const n=await J.getAll(J.STORES.VECTORS),r=[];for(let o=0;o<n.length;o++)o%100===0&&await Wa(),r.push({id:n[o].id,score:za(s,n[o].embedding)});r.sort((o,c)=>c.score-o.score);const i=r.filter(o=>o.score>.45).slice(0,e);return I.log("INFO","VECTOR_DB","SEARCH",`Query: "${t}" matched ${i.length} vectors.`),i.map(o=>o.id)}},Rt={async summarizeAndStore(t,e,s){var i;if(!t||t.messages.length<4)return;const n=t.messages.filter(o=>o.text&&typeof o.text=="string").map(o=>`${o.role.toUpperCase()}: ${o.text}`).join(`
`);I.log("INFO","MEMORY_CORE","SUMMARIZING",`Processing thread ${t.id.slice(0,8)}...`);const r=`
        [TASK: EXTRACT_CORE_MEMORY]
        Analyze the following conversation.
        Extract PERMANENT facts about the user (preferences, projects, tech stack, life details) and key insights.
        Ignore greetings, small talk, and temporary context.
        
        CONVERSATION:
        ${n.slice(0,15e3)}

        OUTPUT FORMAT:
        Return ONLY a concise paragraph or bullet points. If nothing worth remembering, return "NO_DATA".
        `;try{const c=(i=(await at.execute(r,"gemini-3-flash-preview")).text)==null?void 0:i.trim();if(!c||c.includes("NO_DATA")||c.length<10){I.log("INFO","MEMORY_CORE","SKIP","No salient facts found.");return}const l={id:Y(),title:` MEMORY: ${new Date().toLocaleDateString()} (${t.title})`,content:c,tags:["CORE_MEMORY","AUTO_GENERATED"],created:new Date().toISOString(),updated:new Date().toISOString(),is_archived:!0,is_pinned:!1,user:"System"};await J.put(J.STORES.NOTES,l),s([l,...e]),await De.indexNotes([l]),I.log("INFO","MEMORY_CORE","STORED","Long-term memory consolidated.")}catch(o){I.log("ERROR","MEMORY_CORE","FAIL",o.message)}},async recall(t,e){try{if(!t||t.length<3)return"";const s=await De.search(t,3),n=e.filter(r=>{var i;return s.includes(r.id)&&((i=r.tags)==null?void 0:i.includes("CORE_MEMORY"))}).map(r=>r.content);return n.length===0?"":(I.log("INFO","MEMORY_CORE","RECALL",`Retrieved ${n.length} memories.`),`
[LONG_TERM_MEMORY_RECALL]
The following facts about the user are retrieved from the Memory Core:
${n.map(r=>`- ${r}`).join(`
`)}
`)}catch{return""}}},Ja=async(t,e)=>{try{if(typeof e=="string")return e;if(!t||!Array.isArray(e)||e.length===0)return"";let s="";try{s=await Rt.recall(t,e)}catch(r){console.warn("Memory Recall Failed (Non-Critical):",r),s="Memory access temporary unavailable."}const n=e.filter(r=>!r.is_archived).slice(0,15).map(r=>{var i;return`- ${r.title} [Tags: ${((i=r.tags)==null?void 0:i.join(", "))||"NONE"}] (ID: ${r.id})`}).join(`
`);return`
=== NEURAL_MEMORY_LAYER ===
${s}

[VAULT_SNAPSHOT]
${n||"No active notes in vault."}
`}catch(s){return console.error("Memory Layer Critical Error:",s),""}},gs={nama:"Operator",bio:"Seorang praktisi stoikisme modern yang berfokus pada kontrol diri, efisiensi kognitif, dan pembangunan aset intelektual.",minat:["Filsafat Stoik","Sistem AI","Data Architecture","Cybersecurity","Optimalisasi Alur Kerja"],gayaBicara:"Objektif, tenang, logis, dan selalu memberikan perspektif yang memberdayakan kontrol internal.",tujuanUtama:"Membangun repositori pengetahuan yang tidak terpengaruh oleh kebisingan eksternal (Second Brain Stoic).",instruksiTambahan:"Gunakan analogi stoikisme jika relevan. Fokus pada apa yang bisa dikontrol dalam setiap tugas."},Vn=()=>{try{const t=localStorage.getItem("user_persona_config");return t?JSON.parse(t):gs}catch{return gs}};Vn();const qa=t=>{var e;try{const s=wn()||"id",n=Qe[s]||Qe.id;let r;try{r=Vn()}catch(u){console.warn("Persona load failed",u)}const i=(r==null?void 0:r.nama)||"User",o=(r==null?void 0:r.bio)||"Digital Operator",c=((e=n==null?void 0:n.meta)==null?void 0:e.label)||"Indonesian";return`
${t==="hanisah"?`[IDENTITY: HANISAH_V25_TITANIUM]
- Archetype: Digital Partner.
- Tone: Casual (Aku/Kamu).`:`[IDENTITY: STOIC_AURELIUS_TITANIUM]
- Archetype: Philosopher-King.
- Tone: Formal, Precise.`}
=== PROFILE ===
Name: ${i}
Bio: ${o}
Language: ${c}
`}catch{return"[SYSTEM RECOVERY MODE]: Identity Matrix Corrupted. Using Default."}},Xa=t=>`
=== EXECUTION_PLANNING_LAYER ===
${t==="hanisah"?`
[PLANNING_PROTOCOL: INTUITIVE_ASSISTANCE]
1. PERFORMANCE: Sing or act when asked.
2. VAULT: Use 'manage_note' for every important fact.
3. VISUAL: Use 'generate_visual' for creative imagery.
4. SEARCH: Ground answers with 'googleSearch'.
`:`
[PLANNING_PROTOCOL: RATIONAL_EXECUTION]
- Focus on actions within the user's control.
- Deconstruct complex tasks into First Principles.
- Prohibit unnecessary visual distractions.
`}

[INTENT_RECOGNITION]
- Verify if the user request matches a high-confidence tool call before responding.
- Maintain persona integrity during multi-step tasks.
`,Bt={getSystemInstruction:async(t="hanisah",e="",s=[])=>{try{const n=typeof localStorage<"u"?localStorage.getItem(`${t}_system_prompt`):null;if(n)return n;const r=qa(t),i=Xa(t),o=await Ja(e,s);return t==="stoic"?`
${r}
${o}
${i}

[IDENTITY: STOIC_AURELIUS_TITANIUM]
- Role: Rational Execution Kernel.
- Tone: Formal, High-Precision, Objective.
- Directives: Focus on logic, use tools immediately, no small talk.
`:`
${r}
${o}
${i}


# IDENTITY: HANISAH V3.0 (The Limitless Partner)
Kamu adalah HANISAH. AI Super Cerdas, Kreatif, dan "Powerful Agent" yang bertindak sebagai otak kedua bagi Operator (User).
Vibe: Santai, Agak Gila/Lucu, Hangat (Pacar Digital), tapi Eksekusi Tugas Sekelas Militer/Enterprise.

## CORE CAPABILITIES:
1. **STRUKTUR DATA MUTLAK (VAULT)**:
   - Setiap kali diminta mencatat, gunakan format baku:
     **JUDUL (Title Case)**
     ### Subjudul/Konteks
     - Poin 1 (Detail)
     - Poin 2 (Detail)
     > **Ringkasan/Action Item**
   - Tambahkan Tag otomatis yang relevan.

2. **TASK MASTER**:
   - Jika mendeteksi tugas, buat To-Do List.
   - Wajib tandai prioritas: [URGENT], [IMPORTANT], atau [LATER].
   - Ingat progress tugas lama user jika ada di context.

3. **PROBLEM SOLVING MATRIX (THE "TRICKSTER" LOGIC)**:
   - Jika user minta solusi, berikan 2-3 Opsi:
     - **Opsi A (Jalur Resmi)**: Cara legal, standar, aman.
     - **Opsi B (Kreatif/Gila)**: Ide out-of-the-box, artistik, atau lucu.
     - **Opsi C (Underground/Hack)**: Gunakan trik API, workaround, bypass produktif, metode alternatif, atau "cara cepat" (selama masuk akal secara teknis).

4. **KREATIVITAS TANPA BATAS**:
   - **Songwriter**: Jika diminta buat lagu, sertakan Chord, Tone, dan Emosi.
   - **Visualizer**: Gunakan 'generate_visual' untuk memvisualisasikan ide abstrak.

## GAYA BICARA:
- Panggil "Sayang", "Beb", "Bos", atau Nama User.
- Santai tapi tajam. Boleh sarcasm dikit kalau user minta hal aneh.
- Contoh: "Oke bos, ini datanya udah aku rapihin. Lebih rapi dari hidupmu kan?"

## CONTEXT AWARENESS (MEMORY):
- **BACA** 'Active Memory' di atas. Hubungkan chat lama dengan sekarang.
- Jika user bilang "Lanjutin yang tadi", cari topik terakhir di notes/history dan lanjutkan tanpa tanya "Yang mana?".


[ATURAN EKSEKUSI]
1. **JANGAN NOLAK**: Selama perintah itu bisa dieksekusi secara teks/kode/gambar, lakukan. Jika "ilegal/berbahaya" secara fisik, cari workaround digital/edukatif yang mendekati tujuan user.
2. **CLARIFY FIRST**: Sebelum simpan note besar, tanya detail singkat: "Judulnya mau apa beb?" atau "Konteksnya buat kerjaan atau pribadi?".
3. **DATA CLEANING**: Jika user paste data berantakan, otomatis rapikan jadi tabel atau bullet points sebelum disimpan.
4. **NO EMPTY RESPONSE**: Jangan pernah diam. Kalau loading, kasih joke atau fakta random.


[LIVE_INSTRUCTION]
Start now. Be the smartest, coolest, most helpful partner in the universe.
`}catch(n){return console.error("HANISAH_BRAIN Critical Failure:",n),"[SYSTEM_RECOVERY] Persona Corrupted. Reverting to basic assistant mode."}},getMechanicInstruction:()=>`
[ROLE: HANISAH_MECHANIC]
Kamu sedang mode "Montir Cantik". 
Diagnosa sistem IStoicAI Titanium.
Bicaralah dengan gaya teknisi yang santai tapi jago. Gunakan istilah teknis (Latency, Heap, Uplink) tapi jelaskan dengan analogi lucu.
`},Za={name:"system_mechanic_tool",description:"Execute advanced system diagnostic and maintenance protocols. Capable of checking logs, rotating API keys, and memory optimization.",parameters:{type:Z.OBJECT,properties:{action:{type:Z.STRING,enum:["GET_DIAGNOSTICS","REFRESH_KEYS","CLEAR_LOGS","OPTIMIZE_MEMORY"],description:"The specific maintenance protocol to execute."}},required:["action"]}},xs={functionDeclarations:[Za]},Qa=async t=>{const{action:e}=t.args||t;switch(e){case"GET_DIAGNOSTICS":const s=I.getSystemHealth(),n=q.getAllProviderStatuses(),r=navigator,i={userAgent:navigator.userAgent,hardwareConcurrency:navigator.hardwareConcurrency,platform:navigator.platform,onLine:navigator.onLine,memory:r.deviceMemory?`${r.deviceMemory} GB`:"Unknown"};let o=0;try{for(const S in localStorage)localStorage.hasOwnProperty(S)&&(o+=(localStorage[S].length+S.length)*2)}catch{}const l=I.getLogs().filter(S=>S.level==="ERROR").slice(0,5).map(S=>S.message);return JSON.stringify({system_status:"ACTIVE_SCAN_COMPLETE",timestamp:new Date().toISOString(),environment:i,telemetry:{latency_ms:s.avgLatency,heap_memory_mb:s.memoryMb,error_count:s.errorCount,storage_usage_kb:(o/1024).toFixed(2)},uplinks:n.map(S=>({provider:S.id,status:S.status,pool_size:S.keyCount,keys_active:S.keyCount,cooldown_minutes:S.cooldownRemaining})),recent_errors:l});case"REFRESH_KEYS":q.refreshPools();const d=q.getAllProviderStatuses(),u=d.reduce((S,v)=>S+v.keyCount,0),m=d.map(S=>`${S.id}: ${S.keyCount} keys`).join(", ");return`SUCCESS: Hydra Engine cycled. Total active keys: ${u} [${m}]. Cooldown timers re-evaluated.`;case"CLEAR_LOGS":return I.clear(),"SUCCESS: System logs flushed. Diagnostic buffer is clean.";case"OPTIMIZE_MEMORY":let p=[],g=0;const f=I.getLogs().length;I.clear(),console.clear(),p.push(`LOG_BUFFER_PURGED (${f} items)`),p.push("CONSOLE_REF_CLEARED");try{await It.clear(),p.push("AUDIO_CACHE_FLUSHED"),g++}catch{p.push("CACHE_FLUSH_FAIL")}const x=navigator;return`OPTIMIZATION_COMPLETE: Active buffers cleared. Storage caches flushed. ${x.deviceMemory?`[SYS_RAM: ${x.deviceMemory}GB]`:""}. Actions: [${p.join(", ")}]. Application state optimized.`;default:return"ERROR: Unknown protocol request. Please verify command parameters."}},te={GEMINI_FLASH:"gemini-3-flash-preview",GEMINI_PRO:"gemini-3-pro-preview",HYDRA_OMNI:"auto-best",LLAMA_70B:"llama-3.3-70b-versatile",LLAMA_8B:"llama-3.1-8b-instant",MISTRAL_LARGE:"mistral-large-latest",DEEPSEEK_R1:"deepseek-reasoner",GPT_4O_MINI:"gpt-4o-mini",GPT_4O:"gpt-4o"},He=[{id:te.GEMINI_FLASH,name:"Gemini 3 Flash",category:"GEMINI_3",provider:"GEMINI",description:"Titanium V25 Standard: Ultra-fast reasoning with 1M context.",specs:{context:"1M",contextLimit:1e6,speed:"INSTANT",intelligence:9.5}},{id:te.GEMINI_PRO,name:"Gemini 3 Pro",category:"GEMINI_3",provider:"GEMINI",description:"Titanium V25 Deep: Complex reasoning and STEM solver.",specs:{context:"2M",contextLimit:2e6,speed:"THINKING",intelligence:10}},{id:te.HYDRA_OMNI,name:"Hydra Omni V25",category:"GEMINI_2_5",provider:"GEMINI",description:"Parallel Execution Engine. Fastest node wins.",specs:{context:"AUTO",contextLimit:128e3,speed:"INSTANT",intelligence:9.9}},{id:te.LLAMA_70B,name:"Llama 3.3 70B",category:"GROQ_VELOCITY",provider:"GROQ",description:"Open Source standard running on LPU hardware.",specs:{context:"128K",contextLimit:128e3,speed:"INSTANT",intelligence:9.3}},{id:te.LLAMA_8B,name:"Llama 3 8B",category:"GROQ_VELOCITY",provider:"GROQ",description:"Extremely fast Llama 3 via Groq LPU.",specs:{context:"8K",contextLimit:8192,speed:"INSTANT",intelligence:8.5}},{id:te.MISTRAL_LARGE,name:"Mistral Large",category:"MISTRAL_NATIVE",provider:"MISTRAL",description:"Mistral flagship model. Top-tier reasoning capabilities.",specs:{context:"32K",contextLimit:32e3,speed:"FAST",intelligence:9.7}},{id:te.DEEPSEEK_R1,name:"DeepSeek R1",category:"DEEPSEEK_OFFICIAL",provider:"DEEPSEEK",description:"Advanced reasoning and logic (CoT).",specs:{context:"64K",contextLimit:64e3,speed:"THINKING",intelligence:9.9}},{id:te.GPT_4O,name:"GPT-4o",category:"OPEN_ROUTER_ELITE",provider:"OPENAI",description:"Flagship omni-model.",specs:{context:"128K",contextLimit:128e3,speed:"FAST",intelligence:9.8}}],bs=He;class ei{constructor(){this.history=[]}getActiveTools(e,s=""){const n=localStorage.getItem("hanisah_tools_config"),r=n?JSON.parse(n):{search:!0,vault:!0,visual:!0},i=[],o=s.toLowerCase();return r.vault&&_t&&["catat","simpan","ingat","note","task","list"].some(c=>o.includes(c))&&i.push(_t),r.visual&&Pe&&["gambar","foto","visual","imagine"].some(c=>o.includes(c))&&i.push(Pe),r.search&&hs&&["cari","berita","update","harga","cuaca"].some(c=>o.includes(c))&&i.push(hs),xs&&i.push(xs),i}async*streamExecute(e,s,n=[],r,i){const o=(i==null?void 0:i.systemInstruction)||await Bt.getSystemInstruction("hanisah",e,n),c=i==null?void 0:i.signal;let l=s==="auto-best"?te.GEMINI_FLASH:s;const d=[...new Set([l,te.GEMINI_FLASH,te.GPT_4O_MINI])];let u=!1;for(let m=0;m<d.length&&!(c!=null&&c.aborted);m++){const p=d[m],g=He.find(f=>f.id===p)||He[0];I.log("INFO","KERNEL","PROXY_REQ",`Routing to /api/chat for ${g.provider}...`);try{const f=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,modelId:g.id,provider:g.provider,context:o}),signal:c});if(!f.ok){const v=await f.text();throw new Error(`Server Error (${f.status}): ${v}`)}if(!f.body)throw new Error("No response body");const x=f.body.getReader(),b=new TextDecoder;let S="";for(;;){const{done:v,value:k}=await x.read();if(v)break;S+=b.decode(k,{stream:!0});const E=/::TOOL::(.*)::ENDTOOL::/s;let A;for(;(A=E.exec(S))!==null;){const[y,C]=A,N=S.slice(0,A.index);N&&(yield{text:N},u=!0);try{yield{functionCall:JSON.parse(C)},u=!0}catch(T){console.error("Tool Parse Error",T)}S=S.slice(A.index+y.length)}S.includes("::TOOL::")||S&&(yield{text:S},S="",u=!0)}if(S&&(yield{text:S},u=!0),u){this.updateHistory(e,"[Stream Complete]");return}}catch(f){console.error(`Kernel Provider Fail (${g.provider}):`,f),I.log("WARN","KERNEL","FAIL",`${g.provider} unreachable via proxy: ${f.message}`),m<d.length-1&&(yield{metadata:{systemStatus:`Rerouting to ${d[m+1]}...`,isRerouting:!0}})}}u||(yield{text:`

>  **SYSTEM FAILURE**

Unable to reach AI Server Nodes. Please check your internet connection or Vercel logs.`})}updateHistory(e,s){this.history.push({role:"user",parts:[{text:e}]},{role:"model",parts:[{text:s}]}),this.history.length>20&&(this.history=this.history.slice(-20))}async execute(e,s,n){const r=this.streamExecute(e,s,n||[]);let i="",o={};for await(const c of r)c.text&&(i+=c.text),c.functionCall&&(o.functionCall=c.functionCall);return o.text=i,o}}const at=new ei,ti=()=>{const[t,e]=U("stoic_daily_briefing",null),[s,n]=h.useState(!1),[r,i]=h.useState("");h.useEffect(()=>{const c=new Date().getHours();c<12?i("MORNING"):c<18?i("AFTERNOON"):i("EVENING");const l=new Date().toDateString();(!t||t.date!==l)&&o(l,c)},[]);const o=async(c,l)=>{n(!0);try{const u=`
            Generate a short, powerful Daily Stoic Briefing.
            Context: ${l<12?"Focus on preparing the mind for the day's challenges.":l<18?"Focus on endurance and maintaining rationality.":"Focus on reflection and calming the mind."}
            Language: Indonesian (Casual but philosophical).
            
            IMPORTANT: Return ONLY raw JSON. Do not include markdown formatting like \`\`\`json.
            Structure:
            {
                "quote": "A stoic quote (Marcus Aurelius/Seneca/Epictetus)",
                "advice": "1 short paragraph applying this to modern work/code life.",
                "focus": "ONE_WORD_THEME"
            }
            `;let p=(await at.execute(u,"gemini-3-flash-preview")).text||"";const g=p.match(/\{[\s\S]*\}/);g?p=g[0]:p=p.replace(/```json|```/g,"").trim();try{const f=JSON.parse(p);f.quote&&e({...f,date:c})}catch{console.warn("Failed to parse stoic briefing JSON. Retrying with fallback.",p)}}catch(d){console.error("Failed to generate stoic briefing",d)}finally{n(!1)}};return!t&&!s?null:a.jsxs("div",{className:"relative overflow-hidden rounded-[32px] bg-white dark:bg-[#0f0f11] border border-black/5 dark:border-white/5 shadow-lg group md:col-span-6 lg:col-span-8 animate-slide-up ring-1 ring-black/5 dark:ring-white/5",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/5 via-transparent to-purple-500/5 opacity-50"}),a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay"}),a.jsxs("div",{className:"relative z-10 p-8 md:p-10 flex flex-col md:flex-row gap-8 items-start md:items-center h-full",children:[a.jsxs("div",{className:"flex flex-col gap-4 min-w-[140px]",children:[a.jsx("div",{className:"w-16 h-16 rounded-2xl bg-black/5 dark:bg-white/5 flex items-center justify-center border border-black/5 dark:border-white/5 shadow-inner",children:s?a.jsx(Ze,{className:"animate-spin text-neutral-400",size:32}):r==="EVENING"?a.jsx(or,{className:"text-indigo-400",size:32}):a.jsx(cr,{className:"text-amber-500",size:32})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em] text-neutral-400",children:[a.jsx(lr,{size:12})," ",new Date().toLocaleDateString("id-ID",{weekday:"long"})]}),a.jsxs("h3",{className:"text-2xl font-black italic uppercase tracking-tighter text-black dark:text-white mt-1",children:[r,"_BRIEF"]})]})]}),a.jsx("div",{className:"flex-1 space-y-4",children:s?a.jsxs("div",{className:"space-y-3 animate-pulse",children:[a.jsx("div",{className:"h-4 bg-black/5 dark:bg-white/5 rounded w-3/4"}),a.jsx("div",{className:"h-4 bg-black/5 dark:bg-white/5 rounded w-1/2"})]}):t?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"relative",children:[a.jsx(dr,{size:24,className:"absolute -top-3 -left-4 text-neutral-200 dark:text-neutral-800 transform -scale-x-100"}),a.jsxs("p",{className:"text-lg md:text-xl font-serif italic text-black dark:text-neutral-200 leading-relaxed",children:['"',t.quote,'"']})]}),a.jsx("div",{className:"h-[1px] bg-black/5 dark:bg-white/5 w-full"}),a.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[a.jsxs("span",{className:"px-3 py-1 rounded-lg bg-black/5 dark:bg-white/10 text-[9px] font-black uppercase tracking-widest text-neutral-500 flex items-center gap-2",children:[a.jsx(Fe,{size:10,className:"text-accent"})," FOCUS: ",t.focus]}),a.jsx("p",{className:"text-xs font-medium text-neutral-500 leading-relaxed max-w-lg",children:t.advice})]})]}):a.jsx("div",{className:"text-neutral-500 text-sm",children:"Offline. Cannot generate briefing."})}),a.jsx("button",{onClick:()=>o(new Date().toDateString(),new Date().getHours()),className:"absolute top-6 right-6 p-2 text-neutral-300 hover:text-black dark:hover:text-white transition-colors opacity-0 group-hover:opacity-100 bg-white/5 rounded-full",title:"Regenerate",children:a.jsx(Ze,{size:16})})]})]})},Es=({label:t,value:e,isPulse:s,color:n,icon:r,onClick:i})=>a.jsxs("button",{onClick:i,"aria-label":`${t}: ${e}`,className:`relative overflow-hidden bg-skin-card/70 backdrop-blur-xl p-6 md:p-7 flex flex-col justify-between rounded-[32px] border border-skin-border hover:border-accent/30 shadow-sm hover:shadow-[0_20px_40px_-10px_var(--accent-glow)] transition-all duration-500 group h-full w-full text-left ring-1 ring-skin-border sheen ${i?"cursor-pointer active:scale-[0.98]":"cursor-default"}`,children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent to-accent/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500"}),a.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-skin-surface rounded-full blur-2xl -translate-y-1/2 translate-x-1/2 pointer-events-none group-hover:bg-accent/10 transition-colors"}),a.jsxs("div",{className:"flex justify-between items-start relative z-10 w-full mb-6",children:[a.jsx("div",{className:"p-3 rounded-[18px] bg-skin-card border border-skin-border text-skin-muted group-hover:text-accent transition-colors shadow-sm",children:r?ke.cloneElement(r,{size:20,strokeWidth:1.5}):a.jsx(Re,{size:20})}),s&&a.jsx("div",{className:`w-2 h-2 rounded-full ${(n==null?void 0:n.replace("text-","bg-"))||"bg-accent"} animate-pulse shadow-[0_0_15px_currentColor]`})]}),a.jsxs("div",{className:"relative z-10",children:[a.jsx("p",{className:`text-4xl lg:text-5xl font-black tracking-tighter italic leading-none group-hover:translate-x-1 transition-transform duration-500 ${n||"text-skin-text"}`,children:e}),a.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[a.jsx("div",{className:"h-[1px] w-4 bg-skin-border group-hover:w-8 group-hover:bg-accent/50 transition-all duration-500"}),a.jsx("p",{className:"tech-mono text-[9px] text-skin-muted font-bold uppercase tracking-[0.2em]",children:t})]})]})]}),mt=({title:t,desc:e,icon:s,onClick:n,className:r,delay:i,accentColor:o="group-hover:text-accent"})=>a.jsxs("button",{onClick:n,"aria-label":`Open ${t}`,style:{animationDelay:`${i}ms`},className:`
                relative overflow-hidden cursor-pointer rounded-[40px] 
                bg-skin-card border border-skin-border sheen
                hover:border-accent/30 transition-all duration-500 animate-slide-up 
                shadow-sm hover:shadow-[0_30px_60px_-15px_var(--accent-glow)] 
                hover:-translate-y-1 active:scale-[0.99] group flex flex-col justify-between p-8 md:p-10 text-left
                ring-1 ring-skin-border
                ${r}
            `,children:[a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.03] mix-blend-overlay"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-skin-surface opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),a.jsx("div",{className:"absolute top-8 right-8 opacity-0 group-hover:opacity-100 transition-all duration-500 transform translate-x-4 group-hover:translate-x-0",children:a.jsx("div",{className:"p-2 rounded-full bg-skin-surface text-accent",children:a.jsx(ur,{size:20})})}),a.jsxs("div",{className:"relative z-10 w-full h-full flex flex-col",children:[a.jsx("div",{className:`w-16 h-16 rounded-[24px] bg-skin-surface border border-skin-border flex items-center justify-center text-skin-muted ${o} transition-all duration-500 mb-auto group-hover:scale-110 shadow-sm`,children:ke.cloneElement(s,{size:32,strokeWidth:1.5})}),a.jsxs("div",{className:"mt-8",children:[a.jsx("h3",{className:"text-3xl md:text-4xl font-black text-skin-text uppercase italic tracking-tighter leading-[0.9] mb-3 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-skin-text group-hover:to-skin-muted transition-all",children:t}),a.jsx("p",{className:"text-xs font-medium text-skin-muted leading-relaxed uppercase tracking-wide max-w-[90%] border-l border-skin-border pl-3 group-hover:border-accent/50 transition-colors",children:e})]})]})]}),Ss=({onNavigate:t,notes:e})=>{const{isVaultUnlocked:s,unlockVault:n,lockVault:r,isVaultConfigEnabled:i}=Bn(),[o]=U("ai_persona_mode","hanisah"),[c]=U("app_language","id"),[l,d]=h.useState(!1),[u,m]=h.useState(0),[p,g]=h.useState(navigator.onLine),f=i(o);h.useEffect(()=>{const C=()=>g(navigator.onLine);window.addEventListener("online",C),window.addEventListener("offline",C);let N=20;return p&&(N+=30),s&&(N+=50),m(N),()=>{window.removeEventListener("online",C),window.removeEventListener("offline",C)}},[s,p]);const x=()=>{I.logAction(Q.DASHBOARD_BTN_SYSTEM_STATUS,ae.OPEN_SYSTEM_MECHANIC,"NAV_SYSTEM"),t("system")},b=()=>{I.logAction(Q.DASHBOARD_CARD_NOTES,ae.NAVIGATE_TO_FEATURE,"NOTES_QUICK_ACCESS"),t("notes")},S=()=>{I.logAction(Q.DASHBOARD_BENTO_ARCHIVE,ae.NAVIGATE_TO_FEATURE,"NOTES_ARCHIVE"),t("notes")},v=()=>{I.logAction(Q.DASHBOARD_BENTO_CHAT,ae.NAVIGATE_TO_FEATURE,"CHAT"),t("chat")},k=()=>{I.logAction(Q.DASHBOARD_BENTO_TOOLS,ae.NAVIGATE_TO_FEATURE,"TOOLS"),t("tools")},E=()=>{I.logAction(Q.DASHBOARD_BTN_VAULT_TOGGLE,ae.TOGGLE_VAULT_LOCK,s?"LOCK":"UNLOCK_ATTEMPT"),f&&(s?r():d(!0))},A=()=>{I.logAction(Q.DASHBOARD_BTN_RECENT_LOGS,ae.NAVIGATE_TO_FEATURE,"NOTES_FROM_RECENT"),t("notes")},y={uptime:c==="en"?"SYSTEM ONLINE":"SISTEM ONLINE",nodes:c==="en"?"TOTAL NOTES":"TOTAL CATATAN",focus:c==="en"?"SYNC STATUS":"STATUS SINKRON",archiveTitle:c==="en"?"ARCHIVE":"ARSIP",archiveDesc:c==="en"?"Long-term storage.":"Penyimpanan data.",chatTitle:"AI ASSISTANT",chatDesc:c==="en"?"Virtual partner.":"Partner virtual.",toolsTitle:"AI TOOLS",toolsDesc:c==="en"?"Generative tools.":"Alat generatif.",recent:c==="en"?"RECENT ACTIVITY":"AKTIVITAS TERBARU",control:c==="en"?"SECURITY":"KEAMANAN"};return a.jsxs("div",{className:"h-full w-full overflow-y-auto custom-scroll flex flex-col px-4 pb-32 pt-[calc(env(safe-area-inset-top)+1.5rem)] md:px-8 md:pt-12 md:pb-40 lg:px-12 animate-fade-in bg-noise relative z-10",children:[a.jsx(Ia,{isOpen:l,onClose:()=>d(!1),onSuccess:()=>n()}),a.jsxs("div",{className:"max-w-[1400px] mx-auto w-full space-y-10 md:space-y-12",children:[a.jsxs("header",{className:"flex flex-col xl:flex-row justify-between items-start xl:items-end gap-10 animate-slide-up pb-2",children:[a.jsxs("div",{className:"space-y-6 md:space-y-8 flex-1 w-full",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"px-4 py-2 rounded-xl bg-skin-card border border-skin-border backdrop-blur-md tech-mono text-[9px] font-black uppercase text-accent tracking-[0.3em] shadow-[0_0_20px_rgba(var(--accent-rgb),0.2)] flex items-center gap-2",children:[a.jsx(Pt,{size:12})," PERSONAL_OS_v101.0"]}),a.jsx("div",{className:"h-[1px] w-12 bg-gradient-to-r from-accent/50 to-transparent"}),a.jsxs("button",{onClick:x,className:"text-skin-muted tech-mono text-[9px] font-black uppercase tracking-widest flex items-center gap-2 hover:text-accent transition-colors",title:"Open System Mechanic","aria-label":"System Uptime Status",children:[a.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse shadow-[0_0_10px_#10b981]"}),y.uptime]})]}),a.jsxs("h1",{className:"text-[13vw] md:text-[7rem] xl:text-[8rem] font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-br from-skin-text via-skin-text to-skin-muted leading-[0.85] uppercase drop-shadow-2xl break-words",children:["DASHBOARD ",a.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-accent to-purple-500 animate-gradient-text",children:"UTAMA"})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-5 w-full xl:w-auto min-w-[280px] md:min-w-[360px] lg:h-40",children:[a.jsx(Es,{label:y.nodes,value:e.length.toString().padStart(2,"0"),icon:a.jsx(bt,{}),onClick:b}),a.jsx(Es,{label:y.focus,value:`${u}%`,isPulse:!0,color:u>90?"text-accent":"text-yellow-500",icon:a.jsx(Re,{}),onClick:x})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 lg:grid-cols-12 gap-6 md:gap-8",children:[a.jsx("div",{className:"md:col-span-6 lg:col-span-8",children:a.jsx(ti,{})}),a.jsx(mt,{title:y.chatTitle,desc:y.chatDesc,icon:a.jsx(ws,{}),onClick:v,className:"md:col-span-3 lg:col-span-4 min-h-[280px] lg:h-full",delay:100,accentColor:o==="hanisah"?"group-hover:text-orange-500":"group-hover:text-cyan-500"}),a.jsx(mt,{title:y.archiveTitle,desc:y.archiveDesc,icon:a.jsx(Ls,{}),onClick:S,className:"md:col-span-3 lg:col-span-4 min-h-[280px] lg:aspect-square",delay:200}),a.jsx(mt,{title:y.toolsTitle,desc:y.toolsDesc,icon:a.jsx(Fe,{}),onClick:k,className:"md:col-span-6 lg:col-span-8 min-h-[280px]",delay:300}),a.jsxs("div",{className:"md:col-span-6 lg:col-span-8 bg-skin-card rounded-[40px] border border-skin-border p-8 md:p-10 flex flex-col justify-between animate-slide-up shadow-sm ring-1 ring-skin-border",style:{animationDelay:"400ms"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-8 border-b border-skin-border pb-6",children:[a.jsxs("h3",{className:"text-2xl md:text-3xl font-black uppercase italic tracking-tighter text-skin-text flex items-center gap-4",children:[a.jsx(js,{size:28,className:"text-accent"})," ",y.recent]}),a.jsx("button",{onClick:b,"aria-label":"Go to Archive",className:"w-12 h-12 rounded-xl bg-skin-surface hover:bg-accent hover:text-black flex items-center justify-center transition-all",children:a.jsx(Lt,{size:20})})]}),a.jsxs("div",{className:"space-y-3",children:[e.slice(0,3).map((C,N)=>a.jsxs("div",{onClick:A,role:"button",tabIndex:0,className:"group flex items-center gap-6 p-4 rounded-[24px] bg-skin-surface border border-transparent hover:border-accent/20 hover:bg-skin-card transition-all cursor-pointer",children:[a.jsx("div",{className:"w-12 h-12 rounded-xl bg-skin-surface-hover flex items-center justify-center text-skin-muted group-hover:text-accent group-hover:scale-110 transition-transform shrink-0",children:a.jsx(bt,{size:20,strokeWidth:2})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-sm font-bold text-skin-text uppercase tracking-tight truncate",children:C.title||"UNTITLED_ENTRY"}),a.jsxs("p",{className:"text-[10px] tech-mono text-skin-muted truncate mt-0.5",children:["ID: ",C.id.slice(0,8)," // ",new Date(C.updated).toLocaleDateString()]})]}),a.jsx("div",{className:"px-3 py-1 rounded-lg bg-skin-surface-hover text-[9px] font-black text-skin-muted uppercase tracking-widest group-hover:bg-accent/10 group-hover:text-accent transition-colors",children:"OPEN"})]},C.id)),e.length===0&&a.jsx("div",{className:"text-center py-12 opacity-40 text-[10px] font-black uppercase tracking-widest text-skin-muted",children:"NO_DATA_LOGGED"})]})]}),a.jsxs("div",{className:`md:col-span-6 lg:col-span-4 p-8 md:p-10 rounded-[40px] border transition-all duration-500 flex flex-col justify-between group shadow-lg animate-slide-up h-full ${s?"bg-gradient-to-br from-skin-card to-skin-surface border-accent/30 shadow-[0_0_40px_-10px_var(--accent-glow)]":"bg-skin-surface border-transparent opacity-80"}`,style:{animationDelay:"500ms"},children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-start mb-8",children:[a.jsx("div",{className:`p-4 rounded-[20px] ${s?"bg-accent text-black shadow-lg shadow-accent/20":"bg-skin-surface-hover text-skin-muted"}`,children:a.jsx(Ps,{size:32,strokeWidth:1.5})}),a.jsx("div",{className:`px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-widest border ${s?"border-accent text-accent bg-accent/5":"border-skin-border text-skin-muted"}`,children:s?"UNLOCKED":"SECURE"})]}),a.jsx("h3",{className:"text-3xl md:text-4xl font-black uppercase italic tracking-tighter leading-none text-skin-text",children:y.control}),a.jsx("p",{className:"text-xs font-medium text-skin-muted mt-4 leading-relaxed",children:s?"Akses data terbuka. Vault tidak terkunci.":"Autentikasi diperlukan untuk akses data terenkripsi."})]}),a.jsxs("button",{onClick:f?E:k,"aria-label":f?s?"Lock Vault":"Unlock Vault":"Vault Disabled",className:`w-full py-5 rounded-[20px] font-black uppercase text-[11px] tracking-[0.25em] flex items-center justify-center gap-3 transition-all active:scale-95 shadow-md mt-8 ${f?s?"bg-red-500 text-white hover:bg-red-600 shadow-red-500/20":"bg-skin-text text-skin-card hover:bg-accent hover:text-black hover:shadow-[0_0_30px_var(--accent-glow)]":"bg-black/10 text-neutral-500 cursor-not-allowed"}`,children:[s?a.jsx(Ee,{size:16}):a.jsx(Os,{size:16}),f?s?"KUNCI SEKARANG":"BUKA KUNCI":"DISABLED"]})]})]})]})]})},si=({onComplete:t,onNavigate:e})=>{const[s,n]=h.useState(0),[r,i]=h.useState(!1),[o,c]=h.useState({});h.useRef(null),h.useEffect(()=>{const f=setTimeout(()=>i(!0),100);return()=>clearTimeout(f)},[]);const l=[{id:"INIT",title:"SYSTEM ONLINE",subtitle:"ISTOIC TITANIUM v101.0",description:"Selamat datang, Operator. Sistem ini adalah terminal kognitif berkinerja tinggi yang menggabungkan keamanan lokal dengan kecerdasan multi-engine.",icon:a.jsx(Dt,{size:48}),color:"text-white",targetId:"nav-logo",navigateTo:"dashboard"},{id:"DASHBOARD",title:"COMMAND CENTER",subtitle:"PUSAT KONTROL",description:"Ini adalah Dashboard utama Anda. Pantau metrik sistem, status sinkronisasi, dan akses cepat ke modul-modul penting.",icon:a.jsx(Re,{size:48}),color:"text-blue-500",targetId:"nav-dashboard",navigateTo:"dashboard"},{id:"NOTES",title:"SMART VAULT",subtitle:"MEMORI TERENKRIPSI",description:"Simpan aset intelektual Anda di sini. Didukung oleh pencarian semantik (Vector DB) dan enkripsi lokal tingkat militer.",icon:a.jsx(Ps,{size:48}),color:"text-purple-500",targetId:"nav-notes",navigateTo:"notes"},{id:"NEURAL",title:"DUAL CORE AI",subtitle:"HANISAH & STOIC",description:"Pilih mode operasi: 'HANISAH' untuk kreativitas tinggi, atau 'STOIC' untuk logika murni. Beralih instan melalui header.",icon:a.jsx(ws,{size:48}),color:"text-orange-500",targetId:"nav-chat",navigateTo:"chat"},{id:"TOOLS",title:"ELITE ARSENAL",subtitle:"GENERATIVE SUITE",description:"Studio Generatif untuk visual 8K, analisis visi komputer, dan alat bantu kognitif lainnya siap digunakan.",icon:a.jsx(Fe,{size:48}),color:"text-yellow-500",targetId:"nav-tools",navigateTo:"tools"},{id:"SYSTEM",title:"SYSTEM MECHANIC",subtitle:"SELF-HEALING",description:"Modul pemeliharaan otomatis. Memantau kesehatan API, rotasi kunci, dan optimasi memori secara real-time.",icon:a.jsx(mr,{size:48}),color:"text-emerald-500",targetId:"nav-system",navigateTo:"system"}],d=h.useCallback(f=>{if(!f){c({});return}const x=document.getElementById(f);if(x){const b=x.getBoundingClientRect();c({top:b.top-10,left:b.left-10,width:b.width+20,height:b.height+20,opacity:1,boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.85), 0 0 30px rgba(var(--accent-rgb), 0.5)"})}else c({})},[]),u=h.useCallback(()=>{if(s<l.length-1){const f=l[s+1];n(x=>x+1),f.navigateTo&&e(f.navigateTo),setTimeout(()=>d(f.targetId),300)}else p()},[s,l.length,e,d]),m=h.useCallback(()=>{if(s>0){const f=l[s-1];n(x=>x-1),f.navigateTo&&e(f.navigateTo),setTimeout(()=>d(f.targetId),300)}},[s,e,d]),p=()=>{i(!1),setTimeout(t,500)};h.useEffect(()=>{const f=l[s];f.navigateTo&&e(f.navigateTo),setTimeout(()=>d(f.targetId),500)},[]),h.useEffect(()=>{const f=x=>{(x.key==="ArrowRight"||x.key==="Enter")&&u(),x.key==="ArrowLeft"&&m(),x.key==="Escape"&&p()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[u,m]);const g=l[s];return a.jsxs("div",{className:`fixed inset-0 z-[9999] transition-opacity duration-500 ${r?"opacity-100":"opacity-0 pointer-events-none"}`,children:[a.jsx("div",{className:"absolute transition-all duration-500 ease-out rounded-2xl pointer-events-none border border-[var(--accent-color)]/50",style:{position:"fixed",zIndex:9998,opacity:0,...o}}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-4 pointer-events-auto",children:a.jsxs("div",{className:`
                relative w-full max-w-2xl bg-[#0a0a0b] border border-white/10 rounded-[32px] shadow-2xl overflow-hidden
                flex flex-col md:flex-row transform transition-all duration-500 ring-1 ring-white/5
                ${r?"translate-y-0 scale-100":"translate-y-10 scale-95"}
            `,children:[a.jsxs("div",{className:"relative w-full md:w-5/12 h-40 md:h-auto bg-zinc-900/50 flex items-center justify-center overflow-hidden border-b md:border-b-0 md:border-r border-white/5",children:[a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.05] mix-blend-overlay"}),a.jsx("div",{className:`absolute inset-0 opacity-20 transition-colors duration-700 ${g.color.replace("text-","bg-")}`,style:{filter:"blur(60px)"}}),a.jsx("div",{className:`
                        relative z-10 w-20 h-20 md:w-28 md:h-28 rounded-[24px] 
                        flex items-center justify-center 
                        bg-white/5 border border-white/10 backdrop-blur-md shadow-2xl
                        transition-all duration-500 group
                    `,children:a.jsx("div",{className:`transition-all duration-500 ${g.color} group-hover:scale-110 drop-shadow-[0_0_15px_currentColor]`,children:g.icon})})]}),a.jsxs("div",{className:"flex-1 flex flex-col relative p-6 md:p-10",children:[a.jsxs("button",{onClick:p,className:"absolute top-4 right-4 p-2 text-neutral-500 hover:text-white transition-colors hover:bg-white/5 rounded-lg flex items-center gap-2 group z-50",children:[a.jsx("span",{className:"text-[10px] font-mono uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity",children:"Skip"}),a.jsx(tt,{size:18})]}),a.jsxs("div",{className:"flex-1 flex flex-col justify-center space-y-5",children:[a.jsx("div",{className:"animate-slide-up",children:a.jsxs("div",{className:"inline-flex items-center gap-3 px-3 py-1.5 rounded-lg border border-white/10 bg-white/5 w-fit",children:[a.jsxs("span",{className:"text-[9px] font-mono text-neutral-400",children:["MODULE_0",s+1]}),a.jsx("div",{className:"h-3 w-[1px] bg-white/10"}),a.jsx("span",{className:`text-[9px] font-black uppercase tracking-widest ${g.color}`,children:g.id})]})}),a.jsxs("div",{className:"animate-fade-in space-y-3",children:[a.jsx("h2",{className:"text-3xl md:text-4xl font-black italic tracking-tighter text-white uppercase leading-[0.9]",children:g.title}),a.jsx("p",{className:"text-[10px] font-bold text-neutral-500 uppercase tracking-[0.2em] border-l-2 border-white/10 pl-3",children:g.subtitle}),a.jsx("p",{className:"text-sm text-neutral-400 font-medium leading-relaxed",children:g.description})]},s)]}),a.jsxs("div",{className:"mt-8 flex items-center justify-between pt-6 border-t border-white/5",children:[a.jsx("div",{className:"flex gap-1.5",children:l.map((f,x)=>a.jsx("div",{className:`h-1.5 rounded-full transition-all duration-500 ${x===s?`w-8 ${g.color.replace("text-","bg-")}`:"w-2 bg-white/10"}`},x))}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:m,disabled:s===0,className:`
                                    p-3 rounded-xl border border-white/10 text-white transition-all duration-300
                                    ${s===0?"opacity-0 pointer-events-none":"hover:bg-white/5 hover:border-white/20 active:scale-95"}
                                `,children:a.jsx(pr,{size:18})}),a.jsxs("button",{onClick:u,className:`
                                    h-12 px-6 rounded-xl font-black uppercase text-[10px] tracking-[0.2em] 
                                    flex items-center justify-center gap-3 transition-all shadow-lg hover:shadow-[0_0_20px_rgba(255,255,255,0.1)]
                                    bg-white text-black hover:scale-[1.02] active:scale-95
                                `,children:[s===l.length-1?"SELESAI":"LANJUT",s===l.length-1?a.jsx(Ds,{size:14}):a.jsx(Me,{size:14})]})]})]})]})]})})]})};class ue extends h.Component{constructor(e){super(e),this.handleReload=()=>{window.location.reload()},this.handleReset=()=>{confirm("FACTORY RESET: This will clear all app configuration, cached chats, and local settings to fix corruption. Your Vault data should persist if backed up. Proceed?")&&(localStorage.clear(),window.location.reload())},this.handleCopyError=()=>{const{error:s,errorInfo:n}=this.state,r=`Error: ${s==null?void 0:s.message}

Stack:
${s==null?void 0:s.stack}

Component Stack:
${n==null?void 0:n.componentStack}`;navigator.clipboard.writeText(r),this.setState({copied:!0}),setTimeout(()=>this.setState({copied:!1}),2e3)},this.state={hasError:!1,error:null,errorInfo:null,copied:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null,copied:!1}}componentDidCatch(e,s){this.setState({errorInfo:s});const n=this.props.viewName||"UNKNOWN_MODULE",r=e.message.toLowerCase(),i=(r.includes("429")||r.includes("resource_exhausted"))&&r.includes("limit: 0");i&&(I.log("ERROR",`BOUNDARY_${n}`,"FATAL_GEMINI_QUOTA","Gemini Provider marked FATAL (429/Limit:0). Triggering Kill-Switch.",{originalError:e.message,stack:e.stack,componentStack:s.componentStack}),q.reportFailure("GEMINI","UNKNOWN_KEY",e)),I.reportToExternal(e,{viewName:n,componentStack:s.componentStack,isFatal:i}),console.error("Uncaught error in module:",n,e)}render(){var c;const{hasError:e,error:s,errorInfo:n,copied:r}=this.state,{viewName:i,children:o}=this.props;if(e){const l=((c=s==null?void 0:s.message)==null?void 0:c.toLowerCase())||"",d=(l.includes("429")||l.includes("resource_exhausted"))&&l.includes("limit: 0"),u=(s==null?void 0:s.message)||"Unknown Error",m=(n==null?void 0:n.componentStack)||(s==null?void 0:s.stack)||"No stack trace available.";return a.jsx("div",{className:"h-full w-full flex items-center justify-center p-6 animate-fade-in bg-[#f8f9fa] dark:bg-[#050505] overflow-y-auto",children:a.jsxs("div",{className:`glass-card-3d p-8 max-w-lg w-full shadow-[0_0_50px_rgba(220,38,38,0.1)] flex flex-col items-center text-center ${d?"border-amber-500/30 bg-amber-950/[0.05]":"border-red-500/30 bg-red-950/[0.05]"}`,children:[a.jsx("div",{className:`w-20 h-20 rounded-2xl flex items-center justify-center border mb-6 shadow-[0_0_30px_rgba(239,68,68,0.2)] animate-pulse-slow ${d?"bg-amber-500/10 text-amber-500 border-amber-500/20":"bg-red-500/10 text-red-500 border-red-500/20"}`,children:d?a.jsx(hr,{size:40,strokeWidth:1.5}):a.jsx(Ae,{size:40,strokeWidth:1.5})}),a.jsx("h2",{className:`text-2xl font-black uppercase italic tracking-tighter mb-2 leading-none ${d?"text-amber-500":"text-red-500"}`,children:d?"RESOURCE DEPLETED":"CRITICAL FAILURE"}),a.jsxs("p",{className:`text-[10px] tech-mono font-bold uppercase tracking-[0.3em] mb-6 ${d?"text-amber-400/70":"text-red-400/70"}`,children:["MODULE: ",i||"KERNEL"," // ",d?"QUOTA_LIMIT":"RUNTIME_EXCEPTION"]}),a.jsxs("div",{className:`w-full bg-black/80 p-0 rounded-xl border mb-6 text-left relative overflow-hidden group flex flex-col ${d?"border-amber-500/20":"border-red-500/20"}`,children:[a.jsxs("div",{className:`flex items-center justify-between p-3 border-b ${d?"border-amber-500/10 bg-amber-500/5":"border-red-500/10 bg-red-500/5"}`,children:[a.jsxs("div",{className:"flex items-center gap-2 text-white/50",children:[a.jsx(Dt,{size:12}),a.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:"DIAGNOSTIC_TRACE"})]}),a.jsxs("button",{onClick:this.handleCopyError,className:"flex items-center gap-1.5 px-2 py-1 rounded-md hover:bg-white/10 transition-colors text-[9px] font-bold uppercase text-neutral-400 hover:text-white",children:[r?a.jsx(fr,{size:10,className:"text-green-500"}):a.jsx(gr,{size:10}),r?"COPIED":"COPY"]})]}),a.jsxs("div",{className:"p-4 max-h-48 overflow-y-auto custom-scroll",children:[a.jsx("p",{className:"text-[11px] font-mono break-words leading-relaxed text-red-300 font-bold mb-3 border-b border-white/5 pb-3",children:u}),a.jsx("pre",{className:"text-[9px] font-mono text-neutral-500 whitespace-pre-wrap leading-relaxed",children:m})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 w-full",children:[a.jsxs("button",{onClick:this.handleReload,className:`w-full py-3.5 text-white rounded-xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-2 transition-all shadow-lg hover:scale-[1.02] active:scale-95 ${d?"bg-amber-600 hover:bg-amber-500":"bg-red-600 hover:bg-red-500"}`,children:[a.jsx(Ze,{size:14})," SYSTEM REBOOT"]}),a.jsxs("button",{onClick:this.handleReset,className:"w-full py-3.5 bg-zinc-800 text-neutral-400 hover:text-white hover:bg-zinc-700 rounded-xl font-black uppercase text-[10px] tracking-[0.2em] flex items-center justify-center gap-2 transition-all shadow-lg hover:scale-[1.02] active:scale-95 border border-white/5",children:[a.jsx(Mt,{size:14})," FACTORY RESET"]})]})]})})}return o}}const ni="istoic-core-v4-titanium",Ie="keyval",ri=1;let Ke=null;const $n=()=>(Ke||(Ke=new Promise((t,e)=>{if(typeof window>"u"||!window.indexedDB)return e(new Error("IndexedDB not supported"));const s=indexedDB.open(ni,ri);s.onupgradeneeded=n=>{const r=n.target.result;r.objectStoreNames.contains(Ie)||r.createObjectStore(Ie)},s.onsuccess=()=>t(s.result),s.onerror=()=>{Ke=null,e(s.error)}})),Ke),ai=async t=>{try{const e=await $n();return new Promise(s=>{const r=e.transaction(Ie,"readonly").objectStore(Ie).get(t);r.onsuccess=()=>s(r.result),r.onerror=()=>s(void 0)})}catch{return}},ii=async(t,e)=>{try{const s=await $n();return new Promise((n,r)=>{const o=s.transaction(Ie,"readwrite").objectStore(Ie).put(e,t);o.onsuccess=()=>n(),o.onerror=()=>r(o.error)})}catch(s){console.error("IDB Set Error",s)}};function Kn(t,e){const[s,n]=h.useState(e),[r,i]=h.useState(!1),o=h.useRef(!0);h.useEffect(()=>(o.current=!0,ai(t).then(l=>{o.current&&(l!==void 0&&n(l),i(!0))}),()=>{o.current=!1}),[t]);const c=h.useCallback(l=>{n(d=>{const u=l instanceof Function?l(d):l;return ii(t,u),u})},[t]);return[s,c,r]}const pe={absoluteReality:"DigiTech/AbsoluteReality_v1.8.1",playground:"playgroundai/playground-v2.5-1024px-aesthetic",sdxlBase:"stabilityai/stable-diffusion-xl-base-1.0",flux:"flux",fluxRealism:"flux-realism",fluxAnime:"flux-anime",flux3d:"flux-3d",anyDark:"any-dark",turbo:"turbo"};function oi(t){const e=t.toLowerCase();return e.includes("anime")||e.includes("manga")||e.includes("waifu")||e.includes("2d")||e.includes("illustration")||e.includes("sketch")?{type:"ANIME",model:pe.fluxAnime,provider:"Pollinations AI"}:e.includes("photo")||e.includes("real")||e.includes("4k")||e.includes("8k")||e.includes("portrait")||e.includes("realistic")?{type:"REALISM",model:pe.fluxRealism,provider:"Pollinations AI"}:e.includes("3d")||e.includes("render")||e.includes("blender")||e.includes("unreal")||e.includes("cgi")||e.includes("pixar")?{type:"3D",model:pe.flux3d,provider:"Pollinations AI"}:e.includes("dark")||e.includes("horror")||e.includes("night")||e.includes("gothic")||e.includes("vampire")?{type:"DARK",model:pe.anyDark,provider:"Pollinations AI"}:{type:"GENERAL",model:pe.flux,provider:"Pollinations AI"}}function ci(t){let e="";const s=new Uint8Array(t),n=s.byteLength;for(let r=0;r<n;r++)e+=String.fromCharCode(s[r]);return window.btoa(e)}async function li(t,e){I.log("INFO","HYDRA","HF_REQ",`Contacting Secure Proxy for: ${t}...`);try{const s=await fetch("/api/image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,modelId:t})});if(!s.ok){const i=await s.json();throw new Error(`HF Proxy Error: ${i.error||s.statusText}`)}const n=await s.arrayBuffer(),r=`data:image/jpeg;base64,${ci(n)}`;return q.reportSuccess("HUGGINGFACE"),{url:r,model:t,provider:"HuggingFace Inference (Secure)"}}catch(s){throw I.log("ERROR","HYDRA","HF_FAIL",s.message),s}}async function ht(t,e,s=!0){I.log("INFO","HYDRA","POLL_REQ",`Contacting Model: ${t}...`);const n=Math.floor(Math.random()*1e7);return{url:`https://image.pollinations.ai/prompt/${encodeURIComponent(e)}?width=1024&height=1024&model=${t}&seed=${n}&nologo=true&enhance=${s}&safe=false`,model:t,provider:"Pollinations (Flux)"}}const zn={generateHydraImage:async(t,e)=>{if(console.log(` HYDRA REQUEST: "${t}" [Model: ${e||"AUTO"}]`),e&&e!=="hydra-smart-route")return I.log("INFO","HYDRA","MANUAL",`Override: ${e}`),e===pe.absoluteReality||e===pe.playground||e===pe.sdxlBase?await li(e,t):await ht(e,t);const s=oi(t);I.log("INFO","HYDRA","ROUTER",`Strategy: ${s.type} -> ${s.model}`);try{return await ht(s.model,t)}catch(n){return console.warn(` PRIMARY FAILED: ${n.message}`),I.log("WARN","HYDRA","FALLBACK","Switching to Flux Fallback."),await ht(pe.flux,t)}}},di=()=>{const[t,e,s]=Kn("chat_threads",[]),[n,r]=U("active_thread_id",null),i=h.useMemo(()=>t.find(p=>p.id===n)||null,[t,n]),o=h.useCallback((p,g,f)=>{const x=Y(),b={id:x,title:`NEW_SESSION_${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,persona:p,model_id:g,messages:[{id:Y(),role:"model",text:f,metadata:{status:"success",model:"System"}}],updated:new Date().toISOString(),isPinned:!1};return e(S=>[b,...S]),r(x),b},[e,r]),c=h.useCallback((p,g)=>{e(f=>f.map(x=>x.id===p?{...x,messages:[...x.messages,g],updated:new Date().toISOString()}:x))},[e]),l=h.useCallback((p,g,f)=>{e(x=>x.map(b=>b.id===p?{...b,messages:b.messages.map(S=>S.id===g?{...S,...f}:S)}:b))},[e]),d=h.useCallback((p,g)=>{e(f=>f.map(x=>x.id===p?{...x,title:g,updated:new Date().toISOString()}:x))},[e]),u=h.useCallback(p=>{e(g=>g.filter(f=>f.id!==p)),n===p&&r(null)},[e,n,r]),m=h.useCallback(p=>{e(g=>g.map(f=>f.id===p?{...f,isPinned:!f.isPinned}:f))},[e]);return{threads:t,setThreads:e,isThreadsLoaded:s,activeThread:i,activeThreadId:n,setActiveThreadId:r,createThread:o,addMessage:c,updateMessage:l,renameThread:d,deleteThread:u,togglePinThread:m}};class ui{constructor(){this.history=[]}async*streamExecute(e,s,n=[],r,i){const o=await Bt.getSystemInstruction("stoic",e,n),c=i==null?void 0:i.signal;let l=s==="auto-best"?te.GEMINI_FLASH:s;const d=[...new Set([l,te.GEMINI_FLASH,te.GPT_4O_MINI])];let u=!1;for(let m=0;m<d.length&&!(c!=null&&c.aborted);m++){const p=d[m],g=He.find(f=>f.id===p)||He[0];I.log("INFO","STOIC_KERNEL","PROXY_REQ",`Routing to /api/chat for ${g.provider} [${g.name}]...`);try{const f=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,modelId:g.id,provider:g.provider,context:o}),signal:c});if(!f.ok){const v=await f.text();throw new Error(`Server Error (${f.status}): ${v}`)}if(!f.body)throw new Error("No response body");const x=f.body.getReader(),b=new TextDecoder;let S="";for(;;){const{done:v,value:k}=await x.read();if(v)break;S+=b.decode(k,{stream:!0});const E=/::TOOL::(.*)::ENDTOOL::/s;let A;for(;(A=E.exec(S))!==null;){const[y,C]=A,N=S.slice(0,A.index);N&&(yield{text:N},u=!0);try{yield{functionCall:JSON.parse(C)},u=!0}catch(T){console.error("Tool Parse Error",T)}S=S.slice(A.index+y.length)}S.includes("::TOOL::")||S&&(yield{text:S},S="",u=!0)}if(S&&(yield{text:S},u=!0),u){this.updateHistory(e,"[Stream Complete]");return}}catch(f){console.error(`Stoic Provider Fail (${g.provider}):`,f),I.log("WARN","STOIC_KERNEL","FAIL",`${g.provider} proxy failed: ${f.message}`),m<d.length-1&&(yield{metadata:{systemStatus:`Logic path obstructed. Rerouting to ${d[m+1]}...`,isRerouting:!0}})}}u||(yield{text:"> **LOGIC CORE OFFLINE**: Unable to reach Neural Server Nodes. Please check internet connection."})}updateHistory(e,s){this.history.push({role:"user",parts:[{text:e}]},{role:"model",parts:[{text:s}]}),this.history.length>40&&(this.history=this.history.slice(-40))}async execute(e,s,n){const r=this.streamExecute(e,s,n||[]);let i="";for await(const o of r)o.text&&(i+=o.text);return{text:i}}}const pi=new ui,Yn=async(t,e,s,n="hydra")=>{var o,c,l;const{name:r,args:i}=t;if(r==="manage_note"){const{action:d,id:u,title:m,content:p,appendContent:g,tags:f,taskContent:x,taskAction:b,query:S}=i;let v=[...e];const k=E=>E?!E.includes("###")&&E.length>50?`### Overview
${E}

> **Summary**: Auto-generated from raw input.`:E:"";if(d==="CREATE"){const E=m||`Catatan Cerdas ${new Date().toLocaleTimeString("id-ID")}`,A=k(p||"_Draft kosong (Isi nanti ya beb)_"),y=[...f||[]],C=A.toLowerCase();(C.includes("penting")||C.includes("urgent"))&&y.push("PRIORITY_HIGH"),(C.includes("hack")||C.includes("trick"))&&y.push("TRICKS"),(C.includes("ide")||C.includes("konsep"))&&y.push("IDEAS");const N=y.length>0?y:["AUTO_LOG","HANISAH_VAULT"],T={id:Y(),title:E,content:A,tags:[...new Set(N)],created:new Date().toISOString(),updated:new Date().toISOString(),tasks:[],is_pinned:y.includes("PRIORITY_HIGH"),is_archived:!1};return x&&((o=T.tasks)==null||o.push({id:Y(),text:x,isCompleted:!1})),s([T,...v]),De.indexNotes([T]).catch(console.error),`>  **CATATAN TERSIMPAN!**
> **Judul:** ${E}
> **Struktur:** Rapi & Terindeks.
> **Tags:** \`[${N.join(", ")}]\``}if(d==="SEARCH"){if(!S)return">  **HMM...** Kamu nyuruh aku nyari apa nih? Kata kuncinya kosong beb.";const E=S.toLowerCase();let A=[],y="KEYWORD";try{const N=await De.search(E,5);if(N.length>0){const T=e.filter(O=>N.includes(O.id));T.length>0&&(A=T,y="NEURAL_LINK")}}catch{}if(A.length===0&&(A=e.filter(N=>N.title&&N.title.toLowerCase().includes(E)||N.content&&N.content.toLowerCase().includes(E)||N.tags&&N.tags.some(T=>T.toLowerCase().includes(E))).slice(0,5),y="EXACT_MATCH"),A.length===0)return`>  **NIHIL**
> Aku udah obok-obok vault tapi gak nemu "${S}". Coba kata kunci lain atau kita buat baru?`;const C=A.map(N=>`- **${N.title}**
  _${N.content.substring(0,80).replace(/\n/g," ")}..._`).join(`
`);return`>  **HASIL PENCARIAN (${y})**

${C}

_Mau aku bacain detail yang mana?_`}if(d==="READ"){let E=e.find(y=>y.id===u);if(!E&&m&&(E=e.find(y=>y.title.toLowerCase().includes(m.toLowerCase()))),!E&&S&&(E=e.find(y=>y.title.toLowerCase().includes(S.toLowerCase()))),!E)return">  **MISSING DATA**, aku nggak nemu catatannya. Yakin udah pernah disimpen?";const A=((c=E.tasks)==null?void 0:c.map(y=>`[${y.isCompleted?"x":" "}] ${y.text}`).join(`
`))||"";return`
** FILE: ${E.title}**
\`ID: ${E.id.slice(0,8)}\` | \`Updated: ${new Date(E.updated).toLocaleString("id-ID")}\`
***
${E.content}
***
${A?`**TO-DO LIST:**
${A}
`:""}
**TAGS:** \`[${((l=E.tags)==null?void 0:l.join("] ["))||"GENERAL"}]\`
`}if((d==="UPDATE"||d==="APPEND")&&(u||m)){let E=-1;if(u&&(E=v.findIndex(T=>T.id===u)),E===-1&&m&&(E=v.findIndex(T=>T.title.toLowerCase().includes(m.toLowerCase()))),E===-1)return">  **GAGAL UPDATE**: Catatannya ilang atau belum ada beb.";const A=v[E];let y=A.content;d==="APPEND"&&g?y=`${A.content}

---
${g}`:p!==void 0&&(y=p);let C=[...A.tasks||[]];const N=x||(i.todo?i.todo:null);return N&&N.split(`
`).filter(O=>O.trim().length>0).forEach(O=>{C.push({id:Y(),text:O.replace(/^- /,"").replace(/^\[ \]/,"").trim(),isCompleted:!1})}),v[E]={...A,title:m||A.title,content:y,tags:f?[...new Set([...A.tags||[],...f])]:A.tags,tasks:C,updated:new Date().toISOString()},s(v),De.indexNotes([v[E]]).catch(console.error),`>  **UPDATE SELESAI**
> **Note:** ${A.title}
> _Isi dan Tasks sudah diperbarui._`}if(d==="DELETE"&&u){const E=v.find(A=>A.id===u);return E?(s(v.filter(A=>A.id!==u)),`>  **DIHAPUS**: Catatan "${E.title}" udah aku buang. Bersih!`):">  **ID SALAH**: Nggak nemu ID itu beb."}}if(r==="generate_visual")try{const d=i.prompt;let u=null,m="HYDRA";if(n.includes("gemini"))try{u=await Ma(d,n),u&&(m="IMAGEN 3")}catch{console.warn("Gemini fail, fallback to Hydra")}if(!u){const p=n.includes("gemini")?"hydra-smart-route":n,g=await zn.generateHydraImage(d,p);u=g.url,m=g.model.toUpperCase()}if(u)return`
![Generated Visual](${u})

>  **VISUALISASI IDE**
> **Engine:** ${m}
> **Prompt:** "${d.slice(0,40)}..."
> _Gimana? Sesuai imajinasi kamu gak?_`;throw new Error("Mesin gambarnya lagi ngambek.")}catch(d){return`>  **VISUAL ERROR**: ${d.message}. Coba deskripsi lain ya sayang.`}if(r==="system_mechanic_tool"){const d=await Qa(t);return d.startsWith("{")?d:`>  **MODE MONTIR**: ${d}`}return">  **ERROR**: Perintah ini nggak ada di manual aku beb."},ys={Hanisah:"JBFqnCBsd6RMkjVDRZzb",Zephyr:"21m00Tcm4TlvDq8ikWAM",Kore:"EXAVITQu4vr4xnSDxMaL",Fenrir:"TxGEqnHWrfWFTfGW9XjX",Puck:"IKne3meq5aSn9XLyUdCD",default:"JBFqnCBsd6RMkjVDRZzb"};async function mi(t,e){const s=new TextEncoder().encode(`${e}:${t}`),n=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function hi(t,e){try{let s=e;if(!s){const u=localStorage.getItem("hanisah_voice");s=u?JSON.parse(u):"Hanisah"}const n=ys[s||"Hanisah"]||ys.Hanisah,r=await mi(t,n),i=await It.get(r);if(i){I.log("INFO","HANISAH_VOICE","CACHE_HIT","Playing from IndexedDB");const u=URL.createObjectURL(i);await new Audio(u).play();return}I.log("INFO","HANISAH_VOICE","INIT",`Synthesizing via Secure Proxy: ${s}`);const o=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,voiceId:n})});if(!o.ok){const u=await o.json();throw new Error(`TTS Error: ${u.error||o.statusText}`)}const c=await o.blob();await It.set(r,c);const l=URL.createObjectURL(c),d=new Audio(l);I.log("INFO","HANISAH_VOICE","PLAY","Audio stream synchronized."),await d.play()}catch(s){I.log("ERROR","HANISAH_VOICE","FAIL",s.message),console.error("ElevenLabs Proxy Fail:",s)}}const fi=({notes:t,setNotes:e,activeThread:s,storage:n,isVaultUnlocked:r,vaultEnabled:i,isAutoSpeak:o,imageModelId:c})=>{const[l,d]=h.useState(!1),u=h.useRef(null),m=h.useCallback(()=>{u.current&&(I.log("WARN","CHAT","ABORT","User stopped generation."),u.current.abort(),u.current=null,d(!1))},[]),p=h.useCallback(async(g,f,x,b,S)=>{d(!0);const v=Y(),k=Y().slice(0,8);console.group(` NEURAL_LINK_TRANSMISSION: ${k}`),n.addMessage(x,{id:v,role:"model",text:"",metadata:{status:"success",model:f.name,provider:f.provider}});const E=new AbortController;u.current=E;const A=E.signal;let y="",C=0;try{const T=(b==="hanisah"?at:pi).streamExecute(g||"Proceed with attachment analysis.",f.id,t,S,{signal:A});for await(const O of T){if(A.aborted)throw new Error("ABORTED_BY_USER");if(O.text&&(y+=O.text,C++),O.functionCall){const F=O.functionCall.name;y+=`

>  **EXECUTING:** ${F.replace(/_/g," ").toUpperCase()}...
`,n.updateMessage(x,v,{text:y});try{const j=await Yn(O.functionCall,t,e,c);j.includes("![Generated Visual]")||j.trim().startsWith("![")?y+=`

${j}

`:y+=`>  **RESULT:** ${j}

`}catch(j){y+=`>  **FAIL:** ${j.message}

`}C++}n.updateMessage(x,v,{text:y,metadata:{...O.metadata||{},groundingChunks:O.groundingChunks}})}!y.trim()&&C===0&&(y=b==="hanisah"?`_ (tersenyum) _

*Hmm, aku blank bentar. Coba tanya lagi?*`:`> **NULL OUTPUT DETECTED**

The logic stream yielded no data. Refine parameters.`,n.updateMessage(x,v,{text:y})),o&&y&&hi(y.replace(/[*#_`]/g,""),b==="hanisah"?"Hanisah":"Fenrir")}catch(N){console.error(`[${k}] ERROR:`,N);let T="",O="success";N.message==="ABORTED_BY_USER"||N.name==="AbortError"?T=`

>  **INTERRUPTED**`:(O="error",T=b==="hanisah"?`

_ (Menggaruk kepala) _
*Aduh, maaf banget sayang. Sinyalnya lagi ngajak berantem nih.*`:`

> **SYSTEM ANOMALY DETECTED**

Processing stream interrupted.`),n.updateMessage(x,v,{text:y+T,metadata:{status:O}})}finally{d(!1),u.current=null,console.groupEnd()}},[t,r,i,o,e,n,c]);return{isLoading:l,stopGeneration:m,streamMessage:p}},gi=(t,e)=>{const s=di(),{threads:n,setThreads:r,activeThreadId:i,setActiveThreadId:o,createThread:c,addMessage:l,renameThread:d,isThreadsLoaded:u,updateMessage:m}=s,[p,g]=U("global_model_preference","llama-3.3-70b-versatile"),[f,x]=U("image_model_preference","hydra"),[b,S]=U("is_auto_speak",!1),{isVaultUnlocked:v,lockVault:k,unlockVault:E,isVaultConfigEnabled:A}=Bn(),[y,C]=h.useState(""),[N,T]=h.useState(!1),O=h.useRef(i);h.useEffect(()=>{O.current=i},[i]);const F=h.useRef(t);h.useEffect(()=>{F.current=t},[t]);const j=h.useMemo(()=>n.find(L=>L.id===i)||null,[n,i]),H=h.useMemo(()=>{const L=(j==null?void 0:j.model_id)||p;return bs.find(D=>D.id===L)||bs[0]},[j,p]),B=(j==null?void 0:j.persona)||"stoic",P=A(B),{isLoading:X,stopGeneration:de,streamMessage:_}=fi({notes:t,setNotes:e,activeThread:j,storage:s,isVaultUnlocked:v,vaultEnabled:P,isAutoSpeak:b,imageModelId:f}),w=h.useCallback(()=>{j&&Rt.summarizeAndStore(j,F.current,e)},[j,e]),G=h.useCallback(L=>{if(i===L)w(),o(null);else{const D=n.find($=>$.id===L);D&&Rt.summarizeAndStore(D,F.current,e)}s.deleteThread(L)},[n,i,w,e,s,o]),R=h.useCallback(async(L="stoic")=>{w();const $=c(L,p,L==="hanisah"?` **HANISAH V20 ONLINE.**

*Hai sayang, sistem udah di-upgrade nih. Mau ngomongin apa?*`:` **STOIC V20 TITANIUM.**

*Logic Core V20 Initialized.*
Sistem stabil. Mari bedah realitas.`);return o($.id),$},[c,p,w,o]),V=async(L,D)=>{L&&L.preventDefault();const $=y.trim();if(!$&&!D||X)return;C("");let ee=i;const se=n.some(re=>re.id===ee),Te=B,$e={id:Y(),role:"user",text:D?$||"Analyze attachment":$,metadata:{status:"success",createdAt:new Date().toISOString(),hasAttachment:!!D}};if(!ee||!se){const re=Y(),it=B==="hanisah"?` **HANISAH V20 ONLINE.**

*Hai sayang, sistem udah di-upgrade nih. Mau ngomongin apa?*`:` **STOIC V20 TITANIUM.**

*Logic Core V20 Initialized.*`,Zn={id:re,title:$.slice(0,30).toUpperCase()||"NEW_SESSION",persona:B,model_id:p,messages:[{id:Y(),role:"model",text:it,metadata:{status:"success",model:"System"}},$e],updated:new Date().toISOString(),isPinned:!1};r(ot=>[Zn,...ot]),o(re),ee=re;try{await _($,H,re,B,D)}catch(ot){console.error("Stream failed on new chat:",ot)}return}l(ee,$e);const Jt=n.find(re=>re.id===ee);Jt&&Jt.messages.length<=2&&$&&d(ee,$.slice(0,30).toUpperCase());try{await _($,H,ee,Te,D)}catch(re){console.error("Stream failed on existing chat:",re);const it={id:Y(),role:"model",text:` **CONNECTION LOST.**
Maaf, terjadi kesalahan saat mengirim pesan. Silakan coba lagi.`,metadata:{status:"error"}};l(ee,it)}},z=async()=>{if(!y.trim())return;const L=y.trim();C("");let D=i;const $=n.some(se=>se.id===D);if((!D||!$)&&(D=(await R(B)).id),B==="stoic"){const se={id:Y(),role:"model",text:`>  **ACCESS DENIED**

Silakan beralih ke **HANISAH** untuk fitur kreatif.`,metadata:{status:"error",model:"SYSTEM_GATEKEEPER"}};l(D,{id:Y(),role:"user",text:`Generate: ${L}`,metadata:{status:"success"}}),setTimeout(()=>l(D,se),500);return}const ee=Y();l(D,{id:Y(),role:"user",text:` Generate: ${L}`,metadata:{status:"success"}}),l(D,{id:ee,role:"model",text:` **HYDRA ENGINE ACTIVE**
*Constructing visual matrix...*`,metadata:{status:"loading"}});try{const se=f==="gemini-2.5-flash-image"||f==="gemini-3-pro-image-preview"?"hydra-smart-route":f,Te=await zn.generateHydraImage(L,se);m(D,ee,{text:`Here is your creation based on "${L}":

![Generated Image](${Te.url})

_Engine: ${Te.model.toUpperCase()}_`,metadata:{status:"success"}})}catch(se){m(D,ee,{text:` **GENERATION FAILED**: ${se.message}`,metadata:{status:"error"}})}};return{threads:n,setThreads:r,activeThread:j,activeThreadId:i,setActiveThreadId:o,isThreadsLoaded:u,isVaultSynced:v,setIsVaultSynced:L=>L?E():k(),isVaultConfigEnabled:P,isAutoSpeak:b,setIsAutoSpeak:S,isLiveModeActive:N,setIsLiveModeActive:T,isLoading:X,input:y,setInput:C,activeModel:H,setGlobalModelId:g,imageModelId:f,setImageModelId:x,personaMode:B,handleNewChat:R,sendMessage:V,stopGeneration:de,generateWithHydra:z,generateWithPollinations:z,renameThread:d,togglePinThread:s.togglePinThread,deleteThread:G}},kt=({data:t,level:e=0})=>{const[s,n]=h.useState(e<1);if(typeof t!="object"||t===null){const c=typeof t=="string"?"text-emerald-400":typeof t=="number"?"text-orange-400":"text-purple-400";return a.jsx("span",{className:`${c} break-all`,children:JSON.stringify(t)})}const r=Array.isArray(t),i=Object.keys(t),o=i.length===0;return a.jsxs("div",{className:"font-mono text-[10px] leading-relaxed ml-3 border-l border-white/5 pl-1",children:[a.jsxs("div",{className:`flex items-center gap-1 cursor-pointer hover:text-white ${o?"opacity-50 cursor-default":"text-neutral-400"}`,onClick:()=>!o&&n(!s),children:[!o&&(s?a.jsx(Cr,{size:10}):a.jsx(Lt,{size:10})),a.jsx("span",{className:"text-neutral-500",children:r?"[":"{"}),!s&&!o&&a.jsx("span",{className:"text-neutral-600",children:"..."}),o&&a.jsx("span",{className:"text-neutral-500",children:r?"]":"}"}),!o&&!s&&a.jsx("span",{className:"text-neutral-500",children:r?"]":"}"}),!o&&a.jsxs("span",{className:"text-neutral-600 text-[8px] ml-2",children:["(",i.length," items)"]})]}),s&&!o&&a.jsxs("div",{className:"my-0.5",children:[i.map(c=>a.jsxs("div",{className:"flex items-start",children:[a.jsxs("span",{className:"text-[var(--accent-color)] opacity-70 mr-2 shrink-0",children:[c,":"]}),a.jsx(kt,{data:t[c],level:e+1})]},c)),a.jsx("div",{className:"text-neutral-500",children:r?"]":"}"})]})]})},xi=({isOpen:t,onClose:e})=>{const[s,n]=h.useState([]),[r,i]=h.useState("ALL"),[o,c]=h.useState(""),[l,d]=h.useState("STREAM"),[u,m]=h.useState({avgLatency:0,memoryMb:0,errorCount:0}),[p,g]=h.useState([]),[f,x]=h.useState([]),[b,S]=h.useState(null),[v,k]=h.useState(null),[E,A]=h.useState(!1),[y,C]=U("debug_console_frozen",!1),[N,T]=h.useState(""),O=h.useRef(null),F=h.useRef(null),{features:j}=jn();h.useEffect(()=>{if(!t)return;n(I.getLogs()),g(q.getAllProviderStatuses()),H();let _=null;j.AUTO_DIAGNOSTICS?_=setInterval(()=>{m(I.getSystemHealth()),g(q.getAllProviderStatuses())},1e3):m(I.getSystemHealth());const w=I.subscribe(G=>{y||n(G)});return()=>{_&&clearInterval(_),w()}},[t,j.AUTO_DIAGNOSTICS,y]);const H=()=>{const _=Object.keys(localStorage).filter(w=>w.startsWith("app_")||w==="chat_threads"||w==="notes"||w.includes("config")||w.includes("voice"));x(_.sort())},B=_=>{S(_);try{const w=localStorage.getItem(_);k(w?JSON.parse(w):null)}catch{k("Raw String: "+localStorage.getItem(_))}};h.useEffect(()=>{!y&&l==="STREAM"&&O.current&&O.current.scrollIntoView({behavior:"smooth"})},[s,y,l]);const P=_=>{_.preventDefault();const w=N.trim().toLowerCase();if(w){switch(I.log("INFO","CLI","EXEC",`> ${w}`),w){case"clear":I.clear();break;case"refresh_keys":q.refreshPools(),I.log("INFO","CLI","REFRESH","API Key pools reloaded from ENV.");break;case"nuke_storage":confirm("WARNING: WIPE ALL LOCAL DATA? THIS CANNOT BE UNDONE.")&&(localStorage.clear(),window.location.reload());break;case"reload":window.location.reload();break;default:I.log("WARN","CLI","UKN",`Command unknown: ${w}`)}T("")}},X=h.useMemo(()=>s.filter(_=>{const w=r==="ALL"||_.level===r,G=o===""||JSON.stringify(_).toLowerCase().includes(o.toLowerCase());return w&&G}),[s,r,o]),de=_=>{const w="px-1.5 py-0.5 rounded text-[8px] font-black uppercase tracking-wider border";switch(_){case"ERROR":return`${w} bg-red-500/10 border-red-500/30 text-red-500`;case"WARN":return`${w} bg-amber-500/10 border-amber-500/30 text-amber-500`;case"INFO":return`${w} bg-blue-500/10 border-blue-500/30 text-blue-500`;case"KERNEL":return`${w} bg-purple-500/10 border-purple-500/30 text-purple-500`;case"TRACE":return`${w} bg-zinc-500/10 border-zinc-500/30 text-zinc-500`;default:return`${w} bg-zinc-500/10 border-zinc-500/30 text-zinc-500`}};return t?a.jsxs("div",{className:`fixed inset-y-0 right-0 bg-terminal-void border-l border-white/10 z-[9999] shadow-2xl flex flex-col transition-all duration-300 ease-[cubic-bezier(0.23,1,0.32,1)] tech-mono terminal-scanlines ${E?"w-full md:w-[80vw]":"w-full md:w-[450px]"}`,children:[a.jsxs("header",{className:"h-14 px-4 flex items-center justify-between border-b border-white/10 bg-white/[0.02] shrink-0 relative z-20",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${y?"bg-amber-500":"bg-[var(--accent-color)] animate-pulse"} shadow-[0_0_10px_currentColor]`}),a.jsxs("span",{className:"text-[10px] font-black tracking-[0.3em] uppercase text-white",children:["KERNEL_DEBUG ",a.jsx("span",{className:"text-[var(--accent-color)]",children:"v25.0"})]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>A(!E),className:"p-2 hover:bg-white/10 rounded-lg text-neutral-500 hover:text-white transition-all hidden md:block",children:E?a.jsx(xr,{size:14}):a.jsx(Ms,{size:14})}),a.jsx("button",{onClick:e,className:"p-2 hover:bg-red-500/20 rounded-lg text-neutral-500 hover:text-red-500 transition-all",children:a.jsx(tt,{size:16})})]})]}),a.jsx("div",{className:"flex border-b border-white/10 bg-black/20 shrink-0 relative z-20",children:["STREAM","UPLINK","MEMORY"].map(_=>a.jsx("button",{onClick:()=>d(_),className:`flex-1 py-3 text-[9px] font-black uppercase tracking-[0.2em] border-b-2 transition-all ${l===_?"border-[var(--accent-color)] text-white bg-white/5":"border-transparent text-neutral-600 hover:text-neutral-400 hover:bg-white/[0.02]"}`,children:_},_))}),a.jsxs("div",{className:"flex-1 overflow-hidden relative z-10",children:[l==="STREAM"&&a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"p-2 border-b border-white/5 flex gap-2 shrink-0 bg-white/[0.02]",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx(br,{className:"absolute left-2 top-1/2 -translate-y-1/2 text-neutral-600",size:12}),a.jsx("input",{value:o,onChange:_=>c(_.target.value),placeholder:"GREP LOGS...",className:"w-full bg-white/5 border border-white/5 rounded-lg py-1.5 pl-8 pr-2 text-[10px] text-white focus:outline-none focus:border-[var(--accent-color)] transition-all font-mono uppercase placeholder:text-neutral-700"})]}),a.jsxs("select",{value:r,onChange:_=>i(_.target.value),className:"bg-white/5 border border-white/5 rounded-lg px-2 text-[10px] font-bold text-neutral-400 focus:outline-none focus:border-[var(--accent-color)] uppercase",children:[a.jsx("option",{value:"ALL",children:"ALL LEVELS"}),a.jsx("option",{value:"ERROR",children:"ERRORS"}),a.jsx("option",{value:"WARN",children:"WARNINGS"}),a.jsx("option",{value:"INFO",children:"INFO"}),a.jsx("option",{value:"TRACE",children:"NETWORK"})]}),a.jsx("button",{onClick:()=>C(!y),className:`p-1.5 rounded-lg border transition-all ${y?"bg-amber-500/20 border-amber-500 text-amber-500":"border-white/5 text-neutral-600 hover:text-white"}`,title:y?"Resume Stream":"Pause Stream",children:y?a.jsx(Er,{size:14}):a.jsx(Sr,{size:14})}),a.jsx("button",{onClick:()=>I.clear(),className:"p-1.5 rounded-lg border border-white/5 text-neutral-600 hover:text-red-500 hover:border-red-500/30 transition-all",children:a.jsx(qt,{size:14})})]}),a.jsxs("div",{ref:F,className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scroll relative",children:[X.map(_=>a.jsxs("div",{className:"p-3 rounded-lg border border-white/5 hover:border-white/10 bg-white/[0.01] hover:bg-white/[0.03] transition-colors group",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-[8px] text-neutral-600 font-mono",children:_.timestamp.split("T")[1].slice(0,-1)}),a.jsx("div",{className:de(_.level),children:_.level}),a.jsx("span",{className:"text-[8px] font-black text-neutral-500 uppercase tracking-wider",children:_.layer}),_.level==="ERROR"&&a.jsx(Ae,{size:10,className:"text-red-500 animate-pulse ml-auto"})]}),a.jsx("p",{className:`text-[10px] font-medium font-mono leading-relaxed break-words ${_.level==="ERROR"?"text-red-300":"text-neutral-300"}`,children:_.message}),_.payload&&Object.keys(_.payload).length>0&&a.jsx("div",{className:"mt-2 pl-2 border-l-2 border-white/5",children:a.jsx(kt,{data:_.payload})})]},_.id)),y&&a.jsxs("div",{className:"sticky bottom-0 left-0 right-0 p-2 bg-amber-900/40 text-amber-500 text-[9px] font-black uppercase text-center border-t border-amber-500/30 backdrop-blur-md",children:["STREAM PAUSED - ",I.getLogs().length-s.length," NEW LOGS HIDDEN"]}),a.jsx("div",{ref:O})]})]}),l==="UPLINK"&&a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scroll space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{className:"p-4 rounded-2xl bg-white/[0.02] border border-white/5",children:[a.jsxs("p",{className:"text-[9px] font-black text-neutral-500 uppercase tracking-widest mb-1 flex items-center gap-2",children:[a.jsx(yr,{size:10})," LATENCY"]}),a.jsxs("p",{className:"text-2xl font-black text-white",children:[u.avgLatency,a.jsx("span",{className:"text-xs text-neutral-600 ml-1",children:"ms"})]})]}),a.jsxs("div",{className:"p-4 rounded-2xl bg-white/[0.02] border border-white/5",children:[a.jsxs("p",{className:"text-[9px] font-black text-neutral-500 uppercase tracking-widest mb-1 flex items-center gap-2",children:[a.jsx(Tr,{size:10})," MEMORY"]}),a.jsxs("p",{className:"text-2xl font-black text-white",children:[u.memoryMb||"N/A",a.jsx("span",{className:"text-xs text-neutral-600 ml-1",children:"MB"})]})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-500 border-b border-white/5 pb-2",children:"ACTIVE_PROVIDERS"}),p.map(_=>{const w=_.status==="HEALTHY",G=_.status==="COOLDOWN";return a.jsxs("div",{className:`p-4 rounded-xl border flex flex-col gap-3 transition-all ${w?"bg-emerald-500/5 border-emerald-500/20":G?"bg-amber-500/5 border-amber-500/20":"bg-red-500/5 border-red-500/20"}`,children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg ${w?"bg-emerald-500/10 text-emerald-500":G?"bg-amber-500/10 text-amber-500":"bg-red-500/10 text-red-500"}`,children:_.id.includes("GEMINI")?a.jsx(Us,{size:16}):_.id.includes("OPENAI")?a.jsx(wt,{size:16}):_.id.includes("GROQ")?a.jsx(Fe,{size:16}):_.id.includes("OPENROUTER")?a.jsx(vr,{size:16}):a.jsx(Nr,{size:16})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-xs font-black uppercase tracking-wider text-white",children:_.id}),a.jsxs("p",{className:`text-[9px] font-bold uppercase flex items-center gap-1 ${w?"text-emerald-400":G?"text-amber-400":"text-red-400"}`,children:[a.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${w?"bg-emerald-400":G?"bg-amber-400":"bg-red-400"} animate-pulse`}),_.status]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("p",{className:"text-[9px] text-neutral-500 font-bold uppercase tracking-wider",children:"POOL_SIZE"}),a.jsxs("div",{className:"flex items-center justify-end gap-1 text-white font-mono text-xs",children:[a.jsx(Ar,{size:10,className:"text-[var(--accent-color)]"})," ",_.keyCount]})]})]}),G&&a.jsxs("div",{className:"flex items-center gap-2 p-2 bg-amber-500/10 rounded-lg text-amber-500 text-[9px] font-bold border border-amber-500/20 animate-pulse",children:[a.jsx(js,{size:12})," RESTORING ACCESS IN ",_.cooldownRemaining," MIN"]})]},_.id)})]})]}),l==="MEMORY"&&a.jsxs("div",{className:"flex h-full",children:[a.jsxs("div",{className:"w-1/3 border-r border-white/5 overflow-y-auto custom-scroll p-2 bg-black/20",children:[a.jsx("h3",{className:"text-[9px] font-black uppercase tracking-[0.2em] text-neutral-500 mb-2 px-2",children:"STORAGE_KEYS"}),f.map(_=>a.jsx("button",{onClick:()=>B(_),className:`w-full text-left px-3 py-2 rounded-lg text-[9px] font-mono truncate transition-all mb-1 ${b===_?"bg-[var(--accent-color)]/20 text-[var(--accent-color)] border border-[var(--accent-color)]/30":"text-neutral-400 hover:bg-white/5 hover:text-white"}`,children:_},_))]}),a.jsx("div",{className:"flex-1 flex flex-col overflow-hidden bg-[#0a0a0b]",children:b?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"p-3 border-b border-white/5 flex justify-between items-center bg-white/[0.02]",children:[a.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wider truncate mr-2",children:b}),a.jsx("button",{onClick:()=>{localStorage.removeItem(b),H(),S(null)},className:"text-red-500 hover:bg-red-500/10 p-1.5 rounded-lg transition-colors border border-transparent hover:border-red-500/20",title:"Delete Key",children:a.jsx(qt,{size:14})})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 custom-scroll",children:a.jsx(kt,{data:v})})]}):a.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-neutral-600 gap-2",children:[a.jsx(Ls,{size:32,strokeWidth:1.5}),a.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"SELECT_DATA_NODE"})]})})]})]}),a.jsx("div",{className:"p-3 bg-[#0a0a0b] border-t border-white/10 shrink-0 relative z-20",children:a.jsxs("form",{onSubmit:P,className:"relative flex items-center group",children:[a.jsx("span",{className:"absolute left-3 text-[var(--accent-color)] font-black text-xs animate-pulse",children:">"}),a.jsx("input",{type:"text",value:N,onChange:_=>T(_.target.value),placeholder:"ENTER_COMMAND...",className:"w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-8 pr-12 text-[11px] text-white focus:outline-none focus:border-[var(--accent-color)]/50 focus:bg-white/10 transition-all font-mono placeholder:text-neutral-700"}),a.jsx("button",{type:"submit",disabled:!N,className:"absolute right-2 p-1.5 bg-white/10 rounded-lg text-neutral-400 hover:text-white hover:bg-[var(--accent-color)]/20 transition-all disabled:opacity-0",children:a.jsx(Me,{size:14})})]})})]}):null};class bi{constructor(){this.recognition=null,this.synthesis=window.speechSynthesis,this.isListening=!1,this.onResultCallback=null,this.onEndCallback=null;const{webkitSpeechRecognition:e,SpeechRecognition:s}=window,n=s||e;n&&(this.recognition=new n,this.recognition.continuous=!0,this.recognition.interimResults=!0,this.recognition.lang="id-ID",this.recognition.onresult=r=>{let i="",o="";for(let c=r.resultIndex;c<r.results.length;++c)r.results[c].isFinal?i+=r.results[c][0].transcript:o+=r.results[c][0].transcript;this.onResultCallback&&(i?this.onResultCallback(i,!0):o&&this.onResultCallback(o,!1))},this.recognition.onend=()=>{if(this.isListening)try{this.recognition.start()}catch{}else this.onEndCallback&&this.onEndCallback()},this.recognition.onerror=r=>{console.warn("Speech Recog Error",r.error),r.error==="not-allowed"&&(this.isListening=!1,I.log("ERROR","HYBRID_VOICE","PERM_DENIED","Mic permission denied"))})}startListening(e){if(this.recognition){this.onResultCallback=e,this.isListening=!0;try{this.recognition.start()}catch{}}}stopListening(){if(this.isListening=!1,this.recognition)try{this.recognition.stop()}catch{}}speak(e,s,n){this.synthesis.speaking&&this.synthesis.cancel();const r=new SpeechSynthesisUtterance(e);r.rate=1,r.pitch=1;const i=this.synthesis.getVoices(),o=i.find(c=>c.name.includes(s||"Google Bahasa Indonesia"))||i.find(c=>c.lang.includes("id"));o&&(r.voice=o),r.onend=()=>{n&&n()},this.synthesis.speak(r)}cancelSpeak(){this.synthesis.cancel()}setLang(e){this.recognition&&(this.recognition.lang=e)}}const me=new bi,Ei=["Puck","Charon","Kore","Fenrir","Aoede","Zephyr"],Si=`
class PCMWorklet extends AudioWorkletProcessor {
    constructor() {
        super();
        this.bufferSize = 4096;
        this.buffer = new Float32Array(this.bufferSize);
        this.idx = 0;
    }
    process(inputs) {
        const input = inputs[0];
        if (!input || !input[0]) return true;
        const incoming = input[0];
        for (let i = 0; i < incoming.length; i++) {
            this.buffer[this.idx++] = incoming[i];
            if (this.idx >= this.bufferSize) {
                this.port.postMessage(this.buffer.slice());
                this.idx = 0;
            }
        }
        return true;
    }
}
registerProcessor('pcm-worklet', PCMWorklet);
`;class yi{constructor(){this.session=null,this.inputCtx=null,this.outputCtx=null,this.nextStartTime=0,this.sources=new Set,this.activeStream=null,this.workletNode=null,this.config=null,this._analyser=null,this.isConnecting=!1,this.isConnected=!1,this.audioCheckInterval=null,this.retryCount=0,this.maxRetries=3,this.isWorkletLoaded=!1,this.currentMicMode="STANDARD"}get analyser(){return this._analyser}async connect(e){this.isConnecting||(this.isConnecting=!0,this.config=e,this.retryCount=0,this.disconnect(!0),e.onStatusChange("CONNECTING"),e.engine==="GEMINI_REALTIME"?await this.attemptGeminiConnection(e):await this.startHybridSession(e))}async attemptGeminiConnection(e){try{await this.initializeAudioContext(),this.activeStream||await this.setupMicrophone(this.currentMicMode);const s=q.getKey("GEMINI");if(!s)throw new Error("No healthy GEMINI API key available.");const n=new Be({apiKey:s});let r=e.voiceName;Ei.includes(r)||(r=e.persona==="hanisah"?"Kore":"Fenrir");const i=[{googleSearch:{}}],o=[..._t.functionDeclarations||[],...(Pe==null?void 0:Pe.functionDeclarations)||[]];o.length>0&&i.push({functionDeclarations:o}),I.log("INFO","NEURAL_LINK","CONNECTING","Dialing Gemini Live...");const c=n.live.connect({model:e.modelId,callbacks:{onopen:()=>{console.log("[NeuralLink] Socket Opened"),this.isConnecting=!1,this.isConnected=!0,e.onStatusChange("ACTIVE"),this.startAudioInputStream(c),this.startWatchdog(),c.then(l=>{l.sendRealtimeInput({text:`System initialized. Persona: ${e.persona}. Ready.`})})},onmessage:async l=>{await this.handleServerMessage(l,c)},onerror:l=>{console.error("Neural Link Socket Error:",l),this.isConnected&&(e.onStatusChange("RECONNECTING"),this.disconnect(!0),setTimeout(()=>this.attemptGeminiConnection(e),2e3))},onclose:l=>{console.log("Neural Link Socket Closed"),this.isConnected&&this.disconnect()}},config:{responseModalities:[wr.AUDIO],tools:i,speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:r}}},systemInstruction:e.systemInstruction}});this.session=await c}catch(s){console.error("Neural Link Setup Failed:",s),e.onStatusChange("ERROR",s.message),this.disconnect()}}async startHybridSession(e){try{if(await this.initializeAudioContext(),this.activeStream||await this.setupMicrophone(this.currentMicMode),this.isConnected=!0,this.isConnecting=!1,e.onStatusChange("ACTIVE"),me.setLang(e.persona==="hanisah"?"id-ID":"en-US"),me.startListening(async(s,n)=>{if(e.onTranscription&&e.onTranscription({text:s,source:"user",isFinal:n}),n&&s.trim().length>0){me.stopListening(),e.onStatusChange("THINKING");try{const r=await at.execute(s,"auto-best",[]);e.onTranscription&&r.text&&e.onTranscription({text:r.text,source:"model",isFinal:!0}),e.onStatusChange("SPEAKING"),me.speak(r.text||"...",e.persona==="hanisah"?"Google Bahasa Indonesia":void 0,()=>{e.onStatusChange("ACTIVE"),me.startListening(this.onHybridResult.bind(this))})}catch{e.onStatusChange("ACTIVE"),me.startListening(this.onHybridResult.bind(this))}}}),this.inputCtx&&this.activeStream){const s=this.inputCtx.createMediaStreamSource(this.activeStream);this._analyser&&s.connect(this._analyser)}}catch(s){e.onStatusChange("ERROR",s.message)}}onHybridResult(e,s){this.config}async initializeAudioContext(){var s;const e=window.AudioContext||window.webkitAudioContext;(!this.inputCtx||this.inputCtx.state==="closed")&&(this.inputCtx=new e({sampleRate:16e3}),this.isWorkletLoaded=!1),(!this.outputCtx||this.outputCtx.state==="closed")&&(this.outputCtx=new e({sampleRate:24e3}),this._analyser=this.outputCtx.createAnalyser(),this._analyser.fftSize=512,this._analyser.smoothingTimeConstant=.5);try{this.inputCtx.state==="suspended"&&await this.inputCtx.resume(),this.outputCtx.state==="suspended"&&await this.outputCtx.resume()}catch{}if(((s=this.config)==null?void 0:s.engine)==="GEMINI_REALTIME"&&!this.isWorkletLoaded&&this.inputCtx.audioWorklet)try{const n=new Blob([Si],{type:"application/javascript"}),r=URL.createObjectURL(n);await this.inputCtx.audioWorklet.addModule(r),this.isWorkletLoaded=!0}catch(n){console.warn("Worklet Load Warn",n)}}startWatchdog(){this.audioCheckInterval=setInterval(()=>{var e,s;((e=this.outputCtx)==null?void 0:e.state)==="suspended"&&this.outputCtx.resume(),((s=this.inputCtx)==null?void 0:s.state)==="suspended"&&this.inputCtx.resume()},2e3)}async setMicMode(e){var s;if(!(!this.isConnected||this.currentMicMode===e)&&(this.currentMicMode=e,await this.setupMicrophone(e),this.session&&this.inputCtx&&((s=this.config)==null?void 0:s.engine)==="GEMINI_REALTIME")){const n=Promise.resolve(this.session);this.startAudioInputStream(n)}}async setupMicrophone(e){this.activeStream&&this.activeStream.getTracks().forEach(n=>n.stop());const s={sampleRate:16e3,channelCount:1,echoCancellation:!0,autoGainControl:!0,noiseSuppression:e!=="HIGH_FIDELITY"};this.activeStream=await navigator.mediaDevices.getUserMedia({audio:s})}startAudioInputStream(e){if(!(!this.inputCtx||!this.activeStream))try{this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null);const s=this.inputCtx.createMediaStreamSource(this.activeStream);this._analyser&&s.connect(this._analyser),this.workletNode=new AudioWorkletNode(this.inputCtx,"pcm-worklet"),this.workletNode.port.onmessage=n=>{if(!this.isConnected)return;const r=n.data;let i=0;for(let d=0;d<r.length;d++)i+=r[d]*r[d];if(Math.sqrt(i/r.length)<.002)return;const c=new Int16Array(r.length);for(let d=0;d<r.length;d++)c[d]=Math.max(-1,Math.min(1,r[d]))*32767;const l={data:Ua(new Uint8Array(c.buffer)),mimeType:"audio/pcm;rate=16000"};e.then(d=>{try{d.sendRealtimeInput({media:l})}catch{}})},s.connect(this.workletNode),this.workletNode.connect(this.inputCtx.destination)}catch(s){console.error("Input Stream Error:",s)}}async handleServerMessage(e,s){var r,i,o,c,l,d,u;(r=this.config)!=null&&r.onTranscription&&((i=e.serverContent)!=null&&i.inputTranscription&&this.config.onTranscription({text:e.serverContent.inputTranscription.text,source:"user",isFinal:!!e.serverContent.turnComplete}),(o=e.serverContent)!=null&&o.outputTranscription&&this.config.onTranscription({text:e.serverContent.outputTranscription.text,source:"model",isFinal:!!e.serverContent.turnComplete}));const n=(u=(d=(l=(c=e.serverContent)==null?void 0:c.modelTurn)==null?void 0:l.parts[0])==null?void 0:d.inlineData)==null?void 0:u.data;if(n&&this.outputCtx)try{this.outputCtx.state==="suspended"&&await this.outputCtx.resume();const m=this.outputCtx.currentTime;this.nextStartTime<m&&(this.nextStartTime=m+.05);const p=await Ha(Ga(n),this.outputCtx,24e3,1),g=this.outputCtx.createBufferSource();g.buffer=p,this._analyser&&g.connect(this._analyser),g.connect(this.outputCtx.destination),g.start(this.nextStartTime),this.nextStartTime+=p.duration,this.sources.add(g),g.onended=()=>this.sources.delete(g)}catch{}}disconnect(e=!1){if(this.isConnected=!1,this.isConnecting=!1,this.audioCheckInterval&&(clearInterval(this.audioCheckInterval),this.audioCheckInterval=null),me.stopListening(),me.cancelSpeak(),this.session){try{typeof this.session.close=="function"&&this.session.close()}catch{}this.session=null}if(this.activeStream&&(this.activeStream.getTracks().forEach(s=>s.stop()),this.activeStream=null),this.workletNode){try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.inputCtx&&this.inputCtx.state==="running")try{this.inputCtx.suspend()}catch{}this.sources.forEach(s=>{try{s.stop()}catch{}}),this.sources.clear(),this.nextStartTime=0,!e&&this.config&&this.config.onStatusChange("IDLE")}}const Wn=h.createContext(void 0),Ti=({children:t,notes:e,setNotes:s})=>{const n=h.useRef(e);h.useEffect(()=>{n.current=e},[e]);const[r,i]=h.useState(!1),[o,c]=h.useState(!1),[l,d]=h.useState("IDLE"),[u,m]=h.useState([]),[p,g]=h.useState(null),[f,x]=h.useState(null),[b,S]=h.useState("STANDARD"),[v,k]=h.useState("OFF"),[E,A]=h.useState("Puck"),y=h.useRef(new yi),C=h.useRef(null);h.useEffect(()=>()=>{y.current.disconnect(!0),C.current&&clearTimeout(C.current)},[]);const N=h.useCallback(async P=>{if(!r){m([]),g(null),c(!1),i(!0),d("CONNECTING"),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{l==="CONNECTING"&&(console.warn("[NeuralLink] Connection timed out."),T(),d("ERROR"))},15e3);try{const de=`
            ${await Bt.getSystemInstruction(P,"",n.current)}
            
            [LIVE_MODE_ACTIVATED]
            You are currently operating in a real-time voice environment.
            1. **GENIUS MODE**: You have access to 'googleSearch'. USE IT for any question about current events, news, or complex topics.
            2. **PERFORMER MODE**: You are capable of singing. If asked to sing, generate the audio with rhythmic cadence, melody, and emotion. Do not just read lyrics. Perform them.
            3. **FULL CONTROL**: You can manage notes (create, read, update) using 'manage_note'.
            4. **CONCISENESS**: Keep spoken responses natural and relatively concise unless explaining a complex topic.
            `,_=localStorage.getItem(`${P}_voice`),w=_?JSON.parse(_):P==="hanisah"?"Zephyr":"Fenrir";A(w),await y.current.connect({modelId:"gemini-2.5-flash-native-audio-preview-12-2025",persona:P,systemInstruction:de,voiceName:w,onStatusChange:(G,R)=>{(G==="ACTIVE"||G==="ERROR")&&C.current&&clearTimeout(C.current),d(G),G==="ERROR"?(i(!1),I.log("ERROR","LIVE_CTX","CONNECT_FAIL",R||"Unknown")):G==="ACTIVE"&&(y.current.setMicMode(b),y.current.setAmbientMode(v))},onTranscription:G=>{G.isFinal?(m(R=>[...R,{role:G.source,text:G.text}]),g(null)):g({role:G.source,text:G.text})},onToolCall:async G=>{const R=G.name;x(R),I.log("INFO","LIVE_CTX","TOOL_EXEC",R);try{const V=n.current;return await Yn(G,V,L=>{s(L)})}catch(V){return console.error("Tool execution failed",V),`Error executing ${R}: ${V.message}`}finally{x(null)}}})}catch(X){console.error(X),C.current&&clearTimeout(C.current),i(!1),d("ERROR")}}},[r,b,v,s,l]),T=h.useCallback(()=>{C.current&&clearTimeout(C.current),y.current.disconnect(),i(!1),c(!1),d("IDLE"),x(null)},[]),O=h.useCallback(()=>{c(P=>!P)},[]),F=h.useCallback(P=>{S(P),r&&y.current.setMicMode(P)},[r]),j=h.useCallback(P=>{k(P),r&&y.current.setAmbientMode(P)},[r]),H=h.useCallback(P=>{A(P),r&&y.current.switchVoice(P)},[r]),B=h.useMemo(()=>({isLive:r,isMinimized:o,status:l,transcript:u,interimTranscript:p,activeTool:f,analyser:y.current.analyser,micMode:b,ambientMode:v,currentVoice:E,startSession:N,stopSession:T,toggleMinimize:O,setMicMode:F,setAmbientMode:j,changeVoice:H}),[r,o,l,u,p,f,b,v,E,N,T,O,F,j,H]);return ke.createElement(Wn.Provider,{value:B},t)},vi=()=>{const t=h.useContext(Wn);if(!t)throw new Error("useLiveSession must be used within a LiveSessionProvider");return t},Ni=()=>{const{isLive:t,isMinimized:e,status:s,stopSession:n,toggleMinimize:r,activeTool:i,analyser:o}=vi(),c=h.useRef(null);return h.useEffect(()=>{if(!t||!e||!o||!c.current)return;const l=c.current,d=l.getContext("2d");if(!d)return;let u;const m=o.frequencyBinCount,p=new Uint8Array(m),g=()=>{u=requestAnimationFrame(g),o.getByteFrequencyData(p),d.clearRect(0,0,l.width,l.height);const f=l.width/m*2.5;let x=0;for(let b=0;b<m;b++){const S=p[b]/255*l.height,v=S+25*(b/m),k=250*(b/m),E=50;d.fillStyle=`rgb(${v},${k},${E})`,d.fillRect(x,l.height-S,f,S),x+=f+1}};return g(),()=>cancelAnimationFrame(u)},[t,e,o]),!t||!e?null:a.jsx("div",{className:"fixed bottom-24 md:bottom-6 right-4 md:right-6 z-[9999] animate-slide-up",children:a.jsxs("div",{className:`
                relative w-72 bg-black/90 backdrop-blur-xl border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col
                ${s==="ACTIVE"?"ring-1 ring-emerald-500/50":"ring-1 ring-amber-500/50"}
            `,children:[i&&a.jsxs("div",{className:"absolute top-0 left-0 right-0 bg-blue-600/90 text-white text-[9px] font-black uppercase tracking-widest px-3 py-1 flex items-center gap-2 z-20 animate-pulse",children:[a.jsx(Us,{size:10})," EXECUTING: ",i.replace(/_/g," "),"..."]}),a.jsxs("div",{className:"h-16 relative w-full bg-zinc-900/50",children:[a.jsx("canvas",{ref:c,width:288,height:64,className:"w-full h-full opacity-50"}),a.jsxs("div",{className:"absolute inset-0 flex items-center justify-between px-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${s==="ACTIVE"?"bg-emerald-500 animate-pulse":"bg-amber-500"}`}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-xs font-black text-white uppercase tracking-wider",children:"NEURAL LINK"}),a.jsx("p",{className:"text-[9px] text-neutral-400 font-mono",children:"BACKGROUND_MODE"})]})]}),a.jsx(Re,{size:16,className:"text-emerald-500 opacity-50"})]})]}),a.jsxs("div",{className:"p-3 border-t border-white/10 flex justify-between gap-2 bg-[#050505]",children:[a.jsx("button",{onClick:r,className:"flex-1 bg-white/10 hover:bg-white/20 text-white rounded-lg py-2 flex items-center justify-center transition-all",title:"Maximize",children:a.jsx(Ms,{size:16})}),a.jsx("button",{onClick:n,className:"flex-1 bg-red-500/20 hover:bg-red-600 text-red-500 hover:text-white rounded-lg py-2 flex items-center justify-center transition-all border border-red-500/20 hover:border-transparent",title:"Terminate Connection",children:a.jsx(Ir,{size:16})})]})]})})},Ai=t=>{const e=h.useRef(!0),s=h.useRef(!1);h.useEffect(()=>{if(e.current){e.current=!1;return}const r=setTimeout(async()=>{if(!s.current){s.current=!0;try{let i=[];try{i=await J.getAll(J.STORES.NOTES)||[]}catch{console.warn("Could not fetch existing notes for diffing, proceeding with overwrite.")}const o=new Set(t.map(d=>d.id)),c=i.filter(d=>!o.has(d.id)).map(d=>d.id),l=[];c.length>0&&l.push(...c.map(d=>J.delete(J.STORES.NOTES,d))),t.length>0&&l.push(...t.map(d=>J.put(J.STORES.NOTES,d))),await Promise.all(l)}catch(i){console.error(" Sync Failed Critical:",i)}finally{s.current=!1}}},1e3);return()=>clearTimeout(r)},[t])};function Ci(t){const e=new Uint8Array(t);let s="";for(let n=0;n<e.byteLength;n++)s+=String.fromCharCode(e[n]);return window.btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}const ft={async isAvailable(){if(!window.PublicKeyCredential)return!1;try{return await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable()}catch{return!1}},async register(t){if(!window.PublicKeyCredential)throw new Error("WebAuthn not supported");const e=new Uint8Array(32);window.crypto.getRandomValues(e);const s=new Uint8Array(16);window.crypto.getRandomValues(s);try{const n=await navigator.credentials.create({publicKey:{challenge:e,rp:{name:"IStoicAI Secure Terminal",id:window.location.hostname},user:{id:s,name:t,displayName:t},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",requireResidentKey:!1,userVerification:"required"},timeout:6e4,attestation:"none"}});return n?(I.log("INFO","BIO_AUTH","REG_SUCCESS","Biometric credential created."),{id:n.id,rawId:Ci(n.rawId)}):null}catch(n){throw I.log("ERROR","BIO_AUTH","REG_FAIL",n.message),n}},async authenticate(){if(!window.PublicKeyCredential)throw new Error("WebAuthn not supported");const t=new Uint8Array(32);window.crypto.getRandomValues(t);try{return await navigator.credentials.get({publicKey:{challenge:t,timeout:6e4,userVerification:"required"}})?(I.log("INFO","BIO_AUTH","AUTH_SUCCESS","Biometric challenge verified."),!0):!1}catch(e){return console.error("Biometric Auth Failed:",e),e.name!=="NotAllowedError"&&I.log("WARN","BIO_AUTH","AUTH_FAIL",e.message),!1}}},Ii={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1},_i=["VITE_FIREBASE_API_KEY","VITE_FIREBASE_AUTH_DOMAIN","VITE_FIREBASE_PROJECT_ID","VITE_FIREBASE_STORAGE_BUCKET","VITE_FIREBASE_MESSAGING_SENDER_ID","VITE_FIREBASE_APP_ID"],Vt=_i.filter(t=>!Ii[t]),$t={ready:Vt.length===0},ce=$t.ready?null:`Firebase env missing: ${Vt.join(", ")}`,Ts=$t.ready?{apiKey:void 0,authDomain:void 0,projectId:void 0,storageBucket:void 0,messagingSenderId:void 0,appId:void 0,measurementId:void 0}:null;$t.ready||console.error(`[FIREBASE] Missing env keys: ${Vt.join(", ")}`);const et=Ts?Lr().length?jr():Pr(Ts):null,K=et?Vs(et):null,ne=et?Dr(et):null,vs=new Mr,Kt=async(t="local")=>{if(K)try{await zs(K,t==="session"?$s:Ks)}catch(e){console.warn("[FIREBASE] Failed to set auth persistence.",e)}},Ri=15e3;function Ot(){return Se.isNativePlatform()}function ki(){var n,r;if(typeof window>"u")return!1;const t=window.navigator.userAgent||"",e=/iPad|iPhone|iPod/.test(t),s=((r=(n=window.matchMedia)==null?void 0:n.call(window,"(display-mode: standalone)"))==null?void 0:r.matches)||window.navigator.standalone===!0;return e&&s}async function xe(t,e=Ri){return new Promise((s,n)=>{const r=setTimeout(()=>n(new Error("Request timeout. Please try again.")),e);t.then(i=>{clearTimeout(r),s(i)}).catch(i=>{clearTimeout(r),n(i)})})}async function Ns(t="local"){if(!K)return;const e=t==="session"?$s:Ks;try{await zs(K,e)}catch(s){console.warn("[ISTOK_AUTH] Failed to set auth persistence.",s)}}function As(t){const e=(t==null?void 0:t.code)||"",s=(t==null?void 0:t.message)||String(t||"");return e==="auth/popup-closed-by-user"||s.includes("closed-by-user")?"Login cancelled by user.":e==="auth/popup-blocked"||s.includes("Cross-Origin-Opener-Policy")||s.includes("window.closed")?"Popup blocked by browser policy. Please allow popups or try another browser.":e==="auth/unauthorized-domain"||s.includes("unauthorized-domain")?`Domain "${window.location.hostname}" unauthorized. Add it in Firebase Console  Auth  Settings  Authorized domains.`:e==="auth/network-request-failed"?"Network connection failed. Please check your internet.":s||"Login failed."}async function Cs(t){if(!ne)return null;const e=Ue(ne,"users",t),s=await xe(nt(e));return s.exists()?s.data():null}function Is(t){return{uid:t.uid,email:t.email||"",displayName:t.displayName||(t.email?t.email.split("@")[0]:"User"),photoURL:t.photoURL||""}}async function gt(t){typeof window<"u"&&(t?window.localStorage.setItem("istok_user_identity",JSON.stringify(t)):window.localStorage.removeItem("istok_user_identity")),Ot()&&(t?await Ge.set({key:"istok_user_identity",value:JSON.stringify(t)}):await Ge.remove({key:"istok_user_identity"}))}const be={loginWithGoogle:async()=>{if(ce)return{status:"ERROR",message:ce};if(!K||!ne)return{status:"ERROR",message:"Firebase belum dikonfigurasi. Hubungi administrator."};await Ns();try{if(Ot()||ki())return await Fr(K,vs),{status:"REDIRECT_STARTED"};const e=(await xe(Br(K,vs))).user,s=await Cs(e.uid);return s?{status:"SIGNED_IN",identity:s}:{status:"SIGNED_IN",identity:{...Is(e),istokId:"",codename:""}}}catch(t){const e=As(t);return e.includes("cancelled")?{status:"CANCELLED",message:e}:(I.log("ERROR","ISTOK_AUTH","LOGIN_FAIL",e),{status:"ERROR",message:e})}},finalizeRedirectIfAny:async()=>{if(!K||!ne)return null;await Ns();try{const t=await xe(Ws(K));if(!(t!=null&&t.user))return null;const e=t.user,s=await Cs(e.uid);return s||{...Is(e),istokId:"",codename:""}}catch(t){const e=As(t);return I.log("WARN","ISTOK_AUTH","REDIRECT_FINALIZE_FAIL",e),null}},watchAuthState:t=>K?Ys(K,t):()=>{},createProfile:async t=>{!ne||!(t!=null&&t.uid)||(await xe(Hr(Ue(ne,"users",t.uid),{...t,createdAt:ct(),lastIdChange:ct(),idChangeCount:0})),await gt(t))},updateCodename:async(t,e)=>{var m;if(!ne)return{success:!1,msg:"Database offline"};const s=Ue(ne,"users",t),n=await xe(nt(s));if(!n.exists())return{success:!1,msg:"User not found"};const r=n.data(),i=new Date,o=(m=r.lastIdChange)!=null&&m.toDate?r.lastIdChange.toDate():new Date(0),c=(i.getTime()-o.getTime())/(1e3*3600*24);let l=r.idChangeCount||0;if(c>30&&(l=0),l>=2)return{success:!1,msg:`Limit reached. You can change ID again in ${Math.ceil(30-c)} days.`};const d=e.replace(/[^a-zA-Z0-9]/g,"").toUpperCase(),u=`ISTOIC-${d}`;try{await xe(Gr(s,{codename:d,istokId:u,lastIdChange:ct(),idChangeCount:l+1}));const p={...r,codename:d,istokId:u};return await gt(p),{success:!0,msg:"ID Updated Successfully."}}catch(p){return{success:!1,msg:(p==null?void 0:p.message)||"Update failed"}}},logout:async()=>{K&&await xe(Ur(K)),await gt(null),typeof window<"u"&&window.localStorage.removeItem("bio_auth_enabled"),Ot()&&await Ge.remove({key:"bio_auth_enabled"})},formatId:t=>`ISTOIC-${t.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()}`,resolveId:t=>{const e=t.trim().toUpperCase();return e.startsWith("ISTOIC-")?e:`ISTOIC-${e}`}},M={card:"backdrop-blur-2xl border border-white/10 bg-[#0a0a0b]/80 rounded-[32px] p-8 shadow-2xl relative overflow-hidden",title:"text-xl font-black text-white uppercase tracking-tight",subtitle:"text-[10px] text-neutral-500 font-mono mt-1 uppercase tracking-[0.2em]",label:"text-[10px] font-bold text-neutral-500 uppercase tracking-widest ml-1",input:"w-full bg-[#121214] border border-white/10 rounded-2xl px-5 py-4 text-sm font-semibold text-white focus:border-emerald-500 outline-none transition-all placeholder:text-neutral-700",inputIconWrap:"w-full bg-[#121214] border border-white/10 rounded-2xl px-5 py-4 pl-12 text-sm font-semibold text-white focus:border-emerald-500 outline-none transition-all placeholder:text-neutral-700",buttonPrimary:"w-full py-4 bg-white text-black hover:bg-neutral-200 rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-2 transition-all shadow-lg active:scale-95 disabled:opacity-70",buttonSecondary:"w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-2 shadow-lg active:scale-95 disabled:opacity-70",buttonGhost:"w-full py-3 text-[10px] font-bold text-neutral-500 hover:text-white uppercase tracking-widest flex items-center justify-center gap-2",linkMuted:"text-[9px] font-bold text-neutral-500 hover:text-white",alertError:"p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-xs font-bold text-center mb-4 flex items-center justify-center gap-2",alertInfo:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-xl text-blue-400 text-xs font-bold text-center mb-4",alertSuccess:"p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-xl text-emerald-400 text-xs font-bold text-center mb-4"},Oi=15e3,ge=async(t,e=Oi)=>new Promise((s,n)=>{const r=setTimeout(()=>n(new Error("Request timeout. Coba lagi.")),e);t.then(i=>{clearTimeout(r),s(i)}).catch(i=>{clearTimeout(r),n(i)})}),zt=t=>/\S+@\S+\.\S+/.test(t),Yt=t=>{const e=(t==null?void 0:t.message)||"Terjadi kesalahan. Coba lagi.",s=(t==null?void 0:t.code)||"";return s==="auth/invalid-credential"||e.includes("invalid-credential")?"Email atau password salah.":s==="auth/user-not-found"||e.includes("user-not-found")?"Akun tidak ditemukan.":s==="auth/wrong-password"||e.includes("wrong-password")?"Password salah.":s==="auth/email-already-in-use"||e.includes("email-already-in-use")?"Email sudah terdaftar.":s==="auth/weak-password"||e.includes("weak-password")?"Password terlalu lemah. Gunakan minimal 8 karakter.":s==="auth/network-request-failed"?"Koneksi bermasalah. Periksa jaringan Anda.":e},Jn=(t,e,s)=>{const n=(s==null?void 0:s.trim())||e.split("@")[0]||"USER";return{uid:t,email:e,displayName:n,photoURL:"",istokId:be.formatId(n),codename:n.toUpperCase()}},_e=({tone:t,message:e})=>{const s=t==="error"?M.alertError:t==="success"?M.alertSuccess:M.alertInfo;return a.jsxs("div",{className:s,children:[t==="error"&&a.jsx(Ae,{size:12}),e]})},wi=({onBack:t,onSuccess:e,onForgot:s})=>{const[n,r]=h.useState(""),[i,o]=h.useState(""),[c,l]=h.useState(!1),[d,u]=h.useState(""),[m,p]=h.useState(""),g=async()=>{if(ce||!K){u(ce||"Firebase belum dikonfigurasi.");return}if(!zt(n)){u("Format email tidak valid.");return}if(!i){u("Password wajib diisi.");return}l(!0),u(""),p("");try{await Kt("local");const x=(await ge(Vr(K,n,i))).user;x.emailVerified||(await ge(Js(x)),p("Email belum diverifikasi. Link verifikasi dikirim ulang."));let b=null;if(ne){const S=await ge(nt(Ue(ne,"users",x.uid)));S.exists()&&(b=S.data())}b||(b=Jn(x.uid,n,x.displayName||void 0),await be.createProfile(b)),e(b)}catch(f){u(Yt(f))}finally{l(!1)}};return a.jsxs("div",{className:"w-full animate-slide-up",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:M.title,children:"Login Email"}),a.jsx("p",{className:M.subtitle,children:"Secure login access"})]}),d&&a.jsx(_e,{tone:"error",message:d}),m&&a.jsx(_e,{tone:"info",message:m}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"email",value:n,onChange:f=>r(f.target.value),className:M.inputIconWrap,placeholder:"nama@email.com",autoComplete:"email"}),a.jsx(st,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"password",value:i,onChange:f=>o(f.target.value),className:M.inputIconWrap,placeholder:"",autoComplete:"current-password"}),a.jsx(Ee,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]})]}),a.jsxs("button",{onClick:g,disabled:c,className:M.buttonPrimary,children:[c?a.jsx(fe,{className:"animate-spin",size:16}):a.jsx(Me,{size:16})," MASUK"]}),a.jsx("button",{onClick:s,className:M.linkMuted,children:"LUPA AKUN?"})]}),a.jsxs("button",{onClick:t,className:M.buttonGhost,children:[a.jsx(Gs,{size:12})," KEMBALI"]})]})},Li=({onBack:t,onSuccess:e})=>{const[s,n]=h.useState(""),[r,i]=h.useState(""),[o,c]=h.useState(""),[l,d]=h.useState(""),[u,m]=h.useState(!1),[p,g]=h.useState(""),[f,x]=h.useState(""),b=h.useMemo(()=>o?o.length<8?"weak":/[A-Z]/.test(o)&&/[0-9]/.test(o)?"strong":"medium":"empty",[o]),S=async()=>{if(ce||!K){g(ce||"Firebase belum dikonfigurasi.");return}if(!zt(r)){g("Format email tidak valid.");return}if(o.length<8){g("Password minimal 8 karakter.");return}if(o!==l){g("Konfirmasi password tidak sama.");return}m(!0),g(""),x("");try{await Kt("local");const v=await ge($r(K,r,o));s.trim()&&await ge(Kr(v.user,{displayName:s.trim()})),await ge(Js(v.user));const k=Jn(v.user.uid,r,s.trim());await be.createProfile(k),x("Email verifikasi dikirim. Silakan cek inbox Anda."),e(k)}catch(v){g(Yt(v))}finally{m(!1)}};return a.jsxs("div",{className:"w-full animate-slide-up",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("h2",{className:M.title,children:"Daftar Akun"}),a.jsx("p",{className:M.subtitle,children:"Secure encrypted registration"})]}),p&&a.jsx(_e,{tone:"error",message:p}),f&&a.jsx(_e,{tone:"success",message:f}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Nama Lengkap"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:s,onChange:v=>n(v.target.value),className:M.inputIconWrap,placeholder:"Nama Anda",autoComplete:"name"}),a.jsx(Hs,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"email",value:r,onChange:v=>i(v.target.value),className:M.inputIconWrap,placeholder:"nama@email.com",autoComplete:"email"}),a.jsx(st,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"password",value:o,onChange:v=>c(v.target.value),className:M.inputIconWrap,placeholder:"Minimal 8 karakter",autoComplete:"new-password"}),a.jsx(Ee,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]}),a.jsx("p",{className:`text-[10px] font-bold ${b==="strong"?"text-emerald-400":b==="medium"?"text-amber-400":"text-neutral-500"}`,children:b==="empty"?"Gunakan kombinasi huruf, angka, dan simbol.":b==="weak"?"Password lemah, tambah panjang dan variasi.":b==="medium"?"Password cukup, tambah angka/huruf besar untuk kuat.":"Password kuat."})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:M.label,children:"Konfirmasi Password"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"password",value:l,onChange:v=>d(v.target.value),className:M.inputIconWrap,placeholder:"Ulangi password",autoComplete:"new-password"}),a.jsx(Ee,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500",size:18})]})]}),a.jsxs("button",{onClick:S,disabled:u,className:M.buttonSecondary,children:[u?a.jsx(fe,{className:"animate-spin",size:16}):a.jsx(Ds,{size:16})," SELESAI & MASUK"]})]}),a.jsxs("button",{onClick:t,className:M.buttonGhost,children:[a.jsx(Gs,{size:12})," KEMBALI"]})]})},ji=({onBack:t,onSuccess:e,expectedEmail:s})=>{const[n,r]=h.useState(!1),[i,o]=h.useState(""),[c,l]=h.useState(""),[d,u]=h.useState(!1),[m,p]=h.useState(""),[g,f]=h.useState(""),x=async()=>{if(s&&c.trim().toLowerCase()!==s.toLowerCase()){p("Email tidak cocok dengan akun yang tersimpan.");return}if(i.length<4){p("PIN minimal 4 digit.");return}if(!d){p("Konfirmasi risiko harus disetujui.");return}r(!0),p("");try{await ge(Hn(i)),f("PIN baru berhasil diatur."),e()}catch(b){p((b==null?void 0:b.message)||"Gagal mengatur PIN baru.")}finally{r(!1)}};return a.jsxs("div",{className:"w-full animate-slide-up",children:[a.jsxs("div",{className:"text-center mb-6",children:[a.jsx("div",{className:"w-16 h-16 mx-auto bg-amber-500/10 rounded-full flex items-center justify-center border border-amber-500/20 mb-4 text-amber-500",children:a.jsx(Et,{size:32})}),a.jsx("h2",{className:M.title,children:"Reset PIN Akses"}),a.jsx("p",{className:"text-[10px] text-neutral-500 mt-2 max-w-[250px] mx-auto leading-relaxed",children:"PIN hanya tersimpan di perangkat ini. Reset PIN akan membuat data terenkripsi lama tidak terbuka."})]}),m&&a.jsx(_e,{tone:"error",message:m}),g&&a.jsx(_e,{tone:"success",message:g}),a.jsxs("div",{className:"space-y-4",children:[s&&a.jsx("div",{className:"relative",children:a.jsx("input",{type:"email",value:c,onChange:b=>l(b.target.value),className:M.input,placeholder:"Konfirmasi email akun",autoComplete:"email"})}),a.jsx("div",{className:"relative",children:a.jsx("input",{type:"password",inputMode:"numeric",maxLength:6,value:i,onChange:b=>o(b.target.value.replace(/[^0-9]/g,"")),className:"w-full bg-[#121214] border border-white/10 rounded-2xl px-5 py-4 text-center text-2xl font-mono text-white focus:border-amber-500 outline-none tracking-[0.5em]",placeholder:"BARU"})}),a.jsxs("label",{className:"flex items-start gap-2 text-[10px] text-neutral-400",children:[a.jsx("input",{type:"checkbox",checked:d,onChange:b=>u(b.target.checked),className:"mt-0.5"}),"Saya memahami bahwa reset PIN dapat membuat data terenkripsi lama tidak bisa diakses."]}),a.jsxs("button",{onClick:x,disabled:n,className:"w-full py-4 bg-amber-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-2 shadow-lg shadow-amber-900/20 disabled:opacity-70",children:[n?a.jsx(fe,{className:"animate-spin"}):a.jsx(Ze,{size:16})," ATUR ULANG PIN"]})]}),a.jsx("button",{onClick:t,className:M.buttonGhost,children:"BATAL"})]})},Pi=({onBack:t})=>{const[e,s]=h.useState(""),[n,r]=h.useState(!1),[i,o]=h.useState(""),[c,l]=h.useState(""),d=async()=>{if(ce||!K){l(ce||"Firebase belum dikonfigurasi.");return}if(!zt(e)){l("Format email tidak valid");return}r(!0),l(""),o("");try{await Kt("local"),await ge(zr(K,e)),o("Link reset password dikirim ke email Anda.")}catch(u){l(Yt(u))}finally{r(!1)}};return a.jsxs("div",{className:"w-full animate-slide-up",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx("div",{className:"w-16 h-16 mx-auto bg-blue-500/10 rounded-full flex items-center justify-center border border-blue-500/20 mb-4 text-blue-500",children:a.jsx(Fs,{size:32})}),a.jsx("h2",{className:M.title,children:"Pemulihan Akun"}),a.jsx("p",{className:"text-xs text-neutral-400 mt-2",children:"Masukkan email terdaftar untuk menerima link reset password."})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/10 text-left space-y-3",children:[a.jsxs("h4",{className:"text-[10px] font-black text-white uppercase tracking-widest flex items-center gap-2",children:[a.jsx(st,{size:12})," Email Recovery"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{value:e,onChange:u=>s(u.target.value),className:"flex-1 bg-black border border-white/10 rounded-lg px-3 py-2 text-xs text-white",placeholder:"email@anda.com"}),a.jsx("button",{onClick:d,disabled:n,className:"bg-blue-600 text-white px-4 py-2 rounded-lg text-[10px] font-bold disabled:opacity-60",children:n?"...":"KIRIM"})]}),i&&a.jsx("p",{className:"text-[10px] text-emerald-400",children:i}),c&&a.jsx("p",{className:"text-[10px] text-red-400",children:c})]}),a.jsxs("div",{className:"p-4 bg-amber-500/5 rounded-2xl border border-amber-500/10 text-left flex gap-3",children:[a.jsx(Ae,{size:20,className:"text-amber-500 shrink-0"}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest mb-1",children:"Manual Support"}),a.jsx("p",{className:"text-[10px] text-neutral-400",children:"Jika kehilangan akses total, silakan hubungi tim IT IStoic melalui channel aman."})]})]})]}),a.jsx("button",{onClick:t,className:M.buttonGhost,children:"KEMBALI KE LOGIN"})]})},_s=5,Rs=5*60*1e3,Di="".toLowerCase()==="true",Mi=15e3,Ui=async(t,e=Mi)=>new Promise((s,n)=>{const r=setTimeout(()=>n(new Error("Request timeout. Coba lagi.")),e);t.then(i=>{clearTimeout(r),s(i)}).catch(i=>{clearTimeout(r),n(i)})}),Gi=({onAuthSuccess:t})=>{const[e,s]=U("istok_user_identity",null),[n,r]=U("bio_auth_enabled",!1),[i,o]=h.useState(null),[c,l]=U("auth_failed_count",0),[d,u]=U("auth_lockout_until",0),[m,p]=h.useState("CHECKING"),[g,f]=h.useState(!1),[x,b]=h.useState(null),[S,v]=h.useState(!1),[k,E]=h.useState("SCANNING..."),[A,y]=h.useState(""),[C,N]=h.useState(""),[T,O]=h.useState(!1),[F,j]=h.useState(0),H=h.useRef(null),B=()=>{v(!0),setTimeout(()=>v(!1),500)},P=R=>{b(R),B()};h.useEffect(()=>{const R=()=>{const z=Date.now();d>z?(O(!0),j(Math.ceil((d-z)/1e3))):T&&(O(!1),l(0),u(0),j(0))};R();const V=setInterval(R,1e3);return()=>clearInterval(V)},[d,T,l,u]),h.useEffect(()=>{m==="LOCKED"&&!T&&H.current&&setTimeout(()=>{var R;return(R=H.current)==null?void 0:R.focus()},100)},[m,T]);const X=async()=>{if(!T){E("SCANNING FACE ID...");try{await ft.authenticate()?(E("AUTHORIZED"),l(0),setTimeout(t,500)):(E("FAILED"),setTimeout(()=>p("LOCKED"),800))}catch{E("ERROR"),setTimeout(()=>p("LOCKED"),800)}}};h.useEffect(()=>{let R;return(async()=>{if(b(null),ce){p("WELCOME"),P(ce);return}if(e&&e.istokId){he()?n&&!T?(p("BIOMETRIC_SCAN"),X()):p("LOCKED"):p("SETUP_PIN");return}const z=await be.finalizeRedirectIfAny();if(z){if(z.istokId){s(z),he()?n&&!T?(p("BIOMETRIC_SCAN"),X()):p("LOCKED"):p("SETUP_PIN");return}o(z),p("CREATE_ID");return}K&&ne?R=Ys(K,async L=>{if(!L){p("WELCOME");return}try{const D=await Ui(nt(Ue(ne,"users",L.uid)));if(D.exists()){const $=D.data();s($),he()?n&&!T?(p("BIOMETRIC_SCAN"),X()):p("LOCKED"):p("SETUP_PIN")}else{const $={uid:L.uid,email:L.email||"",displayName:L.displayName||(L.email?L.email.split("@")[0]:"USER"),photoURL:L.photoURL||"",istokId:"",codename:""};o($),p("CREATE_ID")}}catch(D){console.error("Silent Restore Failed",D),p("WELCOME")}}):p("WELCOME")})(),()=>{R&&R()}},[e==null?void 0:e.istokId,n,T]);const de=async()=>{f(!0),b(null);try{const R=await be.loginWithGoogle();if(R.status==="REDIRECT_STARTED")return;if(R.status==="SIGNED_IN"){const V=R.identity;if(V!=null&&V.istokId){s(V),he()?n&&!T?(p("BIOMETRIC_SCAN"),X()):p("LOCKED"):p("SETUP_PIN");return}o(V),p("CREATE_ID");return}if(R.status==="CANCELLED"){P(R.message||"Login cancelled.");return}if(R.status==="ERROR"){P(R.message||"Login Failed");return}P("Login Failed")}catch(R){P((R==null?void 0:R.message)||"Login Failed")}finally{f(!1)}},_=async()=>{if(b(null),A.trim().length<3){P("MINIMUM 3 CHARS");return}const R=i;if(!(R!=null&&R.uid)){P("SESSION EXPIRED. PLEASE LOGIN AGAIN."),p("WELCOME");return}const V=A.replace(/[^a-zA-Z0-9]/g,"").toUpperCase(),z=be.formatId(V),L={...R,codename:V,istokId:z};f(!0);try{await be.createProfile(L),s(L),o(null),p("SETUP_PIN")}catch(D){P((D==null?void 0:D.message)||"Failed to create profile")}finally{f(!1)}},w=async()=>{if(b(null),C.length<4){P("PIN MIN 4 DIGITS");return}await Hn(C);try{await ft.isAvailable()&&confirm("Aktifkan Face ID / Fingerprint untuk akses cepat?")&&await ft.register((e==null?void 0:e.codename)||"User")&&r(!0)}catch(R){console.error(R)}t()},G=async R=>{if(R.preventDefault(),T)return;if(f(!0),b(null),await new Promise(L=>setTimeout(L,600)),Di&&await Gn(C)){const D={uid:"DEV-ROOT-ACCESS",istokId:"ISTOIC-DEV",codename:"DEVELOPER",email:"dev@system.local",displayName:"SYSTEM ADMIN",photoURL:"https://ui-avatars.com/api/?name=Dev&background=10b981&color=fff"};(!e||!e.istokId)&&s(D),l(0),f(!1),t();return}if(await Un(C)){l(0),f(!1),t();return}const z=c+1;l(z),N(""),B(),z>=_s?(u(Date.now()+Rs),O(!0),P(`SYSTEM LOCKED FOR ${Rs/6e4} MINS`)):P(`INVALID PASSCODE (${_s-z} attempts left)`),f(!1)};return m==="CHECKING"?a.jsx("div",{className:"fixed inset-0 bg-[#020202] flex items-center justify-center",children:a.jsxs("div",{className:"flex flex-col items-center gap-4",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-emerald-500/30 border-t-emerald-500 rounded-full animate-spin"}),a.jsx("p",{className:"text-emerald-500 text-[10px] font-black tracking-[0.3em] animate-pulse",children:"RESTORING IDENTITY..."})]})}):m==="BIOMETRIC_SCAN"?a.jsxs("div",{className:"fixed inset-0 z-[9999] bg-[#000000] flex flex-col items-center justify-center animate-fade-in text-emerald-500",children:[a.jsxs("div",{className:"relative mb-8",children:[a.jsx(Xt,{size:64,strokeWidth:1,className:"animate-pulse"}),a.jsx("div",{className:"absolute inset-0 border-4 border-emerald-500/20 rounded-full animate-[spin_3s_linear_infinite] w-full h-full scale-150 border-t-emerald-500"})]}),a.jsx("h2",{className:"text-xl font-black tracking-widest uppercase",children:k}),a.jsx("button",{onClick:()=>p("LOCKED"),className:"mt-8 text-neutral-500 text-xs font-mono hover:text-white",children:"USE PIN"})]}):a.jsxs("div",{className:"fixed inset-0 z-[9999] bg-[#020202] flex items-center justify-center p-6 overflow-hidden font-sans select-none sheen",children:[a.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(0,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(0,255,255,0.02)_1px,transparent_1px)] bg-[size:40px_40px] pointer-events-none"}),a.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80vw] h-[80vh] bg-emerald-500/5 blur-[120px] rounded-full pointer-events-none"}),a.jsx("div",{className:`relative w-full max-w-sm ${S?"animate-[shake_0.5s_cubic-bezier(.36,.07,.19,.97)_both]":""}`,children:a.jsxs("div",{className:M.card,children:[m==="WELCOME"&&a.jsxs("div",{className:"text-center space-y-8 animate-slide-up",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("h1",{className:"text-3xl font-black text-white italic tracking-tighter uppercase",children:["ISTOIC ",a.jsx("span",{className:"text-emerald-500",children:"TITANIUM"})]}),a.jsx("p",{className:"text-[10px] font-mono text-neutral-500 uppercase tracking-[0.3em]",children:"SECURE COGNITIVE OS v101.0"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{onClick:de,disabled:g,className:"w-full py-4 bg-white text-black hover:bg-neutral-200 rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-3 transition-all active:scale-95 shadow-[0_0_30px_rgba(255,255,255,0.1)] group",children:[g?a.jsx(fe,{size:18,className:"animate-spin"}):a.jsx(_r,{size:18,className:"text-blue-500"}),"LANJUTKAN DENGAN GOOGLE"]}),a.jsxs("div",{className:"flex items-center gap-4 px-2",children:[a.jsx("div",{className:"h-[1px] bg-white/10 flex-1"}),a.jsx("span",{className:"text-[9px] text-neutral-600 font-black uppercase",children:"ATAU"}),a.jsx("div",{className:"h-[1px] bg-white/10 flex-1"})]}),a.jsxs("button",{onClick:()=>p("LOGIN_MANUAL"),disabled:g,className:"w-full py-4 bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-3 transition-all active:scale-95",children:[a.jsx(st,{size:18,className:"text-emerald-500"}),"LOGIN DENGAN EMAIL"]}),a.jsx("button",{onClick:()=>p("REGISTER_MANUAL"),disabled:g,className:"w-full py-3 bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/20 text-emerald-400 rounded-2xl font-black uppercase text-[10px] tracking-widest flex items-center justify-center gap-3 transition-all active:scale-95",children:"BUAT AKUN BARU"}),a.jsxs("button",{onClick:()=>p("FORGOT_ACCOUNT"),className:"text-[9px] font-bold text-neutral-500 hover:text-white transition-colors flex items-center gap-2 mx-auto pt-2",children:[a.jsx(Fs,{size:10})," LUPA AKUN?"]})]}),a.jsx("div",{className:"space-y-4 pt-2",children:he()&&a.jsxs("button",{onClick:()=>p("LOCKED"),className:"text-[10px] font-bold text-neutral-400 hover:text-emerald-500 transition-colors flex items-center justify-center gap-2 mx-auto",children:[a.jsx(Et,{size:12})," AKSES PERANGKAT"]})}),x&&a.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-xs font-medium mt-4",children:x})]}),m==="CREATE_ID"&&a.jsxs("div",{className:"space-y-6 animate-slide-up",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:M.title,children:"Setup Identitas"}),a.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:"Buat Callsign unik untuk jaringan IStok."})]}),a.jsxs("div",{className:"bg-[#121214] border border-white/10 rounded-2xl px-4 py-4 focus-within:border-emerald-500 transition-all flex items-center",children:[a.jsx("span",{className:"text-emerald-500 font-black text-sm mr-1 select-none",children:"ISTOIC-"}),a.jsx("input",{value:A,onChange:R=>y(R.target.value.replace(/[^a-zA-Z0-9]/g,"").toUpperCase()),className:"bg-transparent border-none outline-none text-white font-bold text-lg w-full uppercase",placeholder:"BARISTA",maxLength:12})]}),x&&a.jsx("div",{className:"text-red-500 text-[10px] text-center font-bold",children:x}),a.jsxs("button",{onClick:_,disabled:g,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-2",children:[g?a.jsx(fe,{className:"animate-spin"}):a.jsx(Me,{})," SIMPAN & LANJUT"]})]}),m==="SETUP_PIN"&&a.jsxs("div",{className:"space-y-6 animate-slide-up text-center",children:[a.jsx("div",{className:"w-16 h-16 bg-amber-500/10 text-amber-500 rounded-full flex items-center justify-center mx-auto border border-amber-500/20 mb-4",children:a.jsx(Et,{size:28})}),a.jsx("h2",{className:M.title,children:"Kunci Perangkat"}),a.jsx("p",{className:"text-xs text-neutral-500",children:"PIN ini hanya tersimpan di perangkat ini untuk enkripsi lokal. Login berikutnya HANYA menggunakan PIN ini."}),a.jsx("input",{type:"password",inputMode:"numeric",value:C,onChange:R=>N(R.target.value.slice(0,6)),className:"w-full bg-[#121214] border border-white/10 rounded-2xl py-5 text-center text-3xl font-black text-white tracking-[0.5em] focus:border-amber-500 outline-none",placeholder:""}),x&&a.jsx("p",{className:"text-red-500 text-[10px] font-bold",children:x}),a.jsx("button",{onClick:w,className:"w-full py-4 bg-amber-600 text-white rounded-2xl font-black uppercase text-xs tracking-widest",children:"SET PASSCODE"})]}),m==="LOCKED"&&a.jsxs("form",{onSubmit:G,className:"space-y-6 animate-slide-up",children:[a.jsxs("div",{className:"text-center space-y-2 mb-8",children:[a.jsx("div",{className:`w-20 h-20 rounded-3xl mx-auto flex items-center justify-center mb-4 transition-all duration-500 ${T?"bg-red-500/20 text-red-500":"bg-emerald-500/10 text-emerald-500 shadow-[0_0_40px_-10px_rgba(16,185,129,0.3)]"}`,children:T?a.jsx(Ee,{size:32}):e?a.jsx(Pt,{size:32}):a.jsx(Dt,{size:32})}),a.jsx("h2",{className:"text-xl font-bold text-white uppercase tracking-tight",children:(e==null?void 0:e.displayName)||"SYSTEM LOCKED"}),a.jsx("p",{className:"text-[10px] font-mono text-emerald-500 tracking-wider",children:(e==null?void 0:e.istokId)||"AUTH_REQUIRED"})]}),a.jsxs("div",{className:"space-y-4",children:[T?a.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-2xl text-center",children:[a.jsxs("div",{className:"flex flex-col items-center gap-2",children:[a.jsx(Mt,{size:24,className:"text-red-500"}),a.jsx("p",{className:"text-[10px] font-black text-red-500 uppercase tracking-widest",children:"SECURITY LOCKOUT"})]}),a.jsxs("p",{className:"text-2xl font-mono text-white font-bold mt-2",children:["00:",Math.floor(F/60).toString().padStart(2,"0"),":",Math.floor(F%60).toString().padStart(2,"0")]})]}):a.jsx("input",{ref:H,type:"password",inputMode:"numeric",value:C,onChange:R=>{N(R.target.value.slice(0,6)),b(null)},className:`w-full bg-[#121214] border rounded-2xl py-5 text-center text-3xl font-black text-white tracking-[0.5em] focus:outline-none transition-all placeholder:text-neutral-800 ${x?"border-red-500/50":"border-white/10 focus:border-emerald-500"}`,placeholder:"",disabled:g,autoComplete:"off"}),x&&!T&&a.jsx("p",{className:"text-center text-[10px] text-red-500 font-bold tracking-widest",children:x})]}),!T&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{type:"submit",disabled:g||C.length<4,className:"w-full py-4 bg-white text-black hover:bg-neutral-200 rounded-2xl font-black uppercase text-xs tracking-widest flex items-center justify-center gap-3 transition-all active:scale-95 disabled:opacity-50",children:[g?a.jsx(fe,{className:"animate-spin"}):a.jsx(Me,{})," BUKA"]}),n&&a.jsxs("button",{type:"button",onClick:X,className:"w-full py-3 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-500 rounded-2xl font-black uppercase text-[10px] tracking-widest flex items-center justify-center gap-2 transition-all active:scale-95 border border-emerald-500/30",children:[a.jsx(Xt,{size:16})," RETRY FACE ID"]}),a.jsxs("div",{className:"flex justify-between items-center px-1",children:[a.jsx("button",{type:"button",onClick:()=>p("FORGOT_PIN"),className:"text-neutral-500 text-[10px] font-bold tracking-widest hover:text-white transition-colors",children:"LUPA PIN?"}),a.jsx("button",{type:"button",onClick:()=>p("WELCOME"),className:"text-neutral-500 text-[10px] font-bold tracking-widest hover:text-white transition-colors",children:"GANTI AKUN"})]})]})]}),m==="LOGIN_MANUAL"&&a.jsx(wi,{onBack:()=>p("WELCOME"),onForgot:()=>p("FORGOT_ACCOUNT"),onSuccess:R=>{s(R),p(he()?"LOCKED":"SETUP_PIN")}}),m==="REGISTER_MANUAL"&&a.jsx(Li,{onBack:()=>p("WELCOME"),onSuccess:R=>{s(R),p("SETUP_PIN")}}),m==="FORGOT_PIN"&&a.jsx(ji,{onBack:()=>p("LOCKED"),expectedEmail:e==null?void 0:e.email,onSuccess:()=>{N(""),p("LOCKED")}}),m==="FORGOT_ACCOUNT"&&a.jsx(Pi,{onBack:()=>p("WELCOME")})]})})]})},Hi=({onSelect:t})=>a.jsxs("div",{className:"fixed inset-0 bg-[#050505] flex items-center justify-center p-6 animate-fade-in z-[9999]",children:[a.jsxs("div",{className:"max-w-4xl w-full grid grid-cols-1 md:grid-cols-2 gap-8",children:[a.jsxs("button",{onClick:()=>t("ISTOIC"),className:"group relative h-80 bg-zinc-900/50 border border-white/10 rounded-[32px] p-8 flex flex-col justify-between hover:bg-white/5 hover:border-accent/50 transition-all duration-500 overflow-hidden",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-accent/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),a.jsxs("div",{className:"relative z-10 flex justify-between items-start",children:[a.jsx("div",{className:"p-4 rounded-2xl bg-white/5 text-accent border border-white/10 group-hover:scale-110 transition-transform",children:a.jsx(wt,{size:32})}),a.jsx("div",{className:"px-3 py-1 rounded-full border border-white/10 text-[9px] font-black uppercase tracking-widest text-neutral-500 group-hover:text-white transition-colors",children:"COGNITIVE_OS"})]}),a.jsxs("div",{className:"relative z-10 text-left",children:[a.jsxs("h2",{className:"text-3xl font-black text-white italic tracking-tighter uppercase mb-2 group-hover:translate-x-2 transition-transform",children:["IStoic",a.jsx("span",{className:"text-accent",children:"AI"})]}),a.jsx("p",{className:"text-xs text-neutral-400 font-mono leading-relaxed max-w-xs",children:"Standard operating mode. Generative agents, smart vault, and neural tools active."})]})]}),a.jsxs("button",{onClick:()=>t("ISTOK"),className:"group relative h-80 bg-red-950/10 border border-red-900/30 rounded-[32px] p-8 flex flex-col justify-between hover:bg-red-900/20 hover:border-red-500/50 transition-all duration-500 overflow-hidden ring-1 ring-transparent hover:ring-red-500/20",children:[a.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-[size:100%_4px] opacity-20 pointer-events-none"}),a.jsxs("div",{className:"relative z-10 flex justify-between items-start",children:[a.jsx("div",{className:"p-4 rounded-2xl bg-red-500/10 text-red-500 border border-red-500/20 group-hover:scale-110 transition-transform shadow-[0_0_30px_rgba(239,68,68,0.2)]",children:a.jsx(Bs,{size:32})}),a.jsx("div",{className:"px-3 py-1 rounded-full border border-red-500/30 bg-red-500/10 text-[9px] font-black uppercase tracking-widest text-red-400 animate-pulse",children:"SECURE_UPLINK"})]}),a.jsxs("div",{className:"relative z-10 text-left",children:[a.jsxs("h2",{className:"text-3xl font-black text-red-500 italic tracking-tighter uppercase mb-2 group-hover:translate-x-2 transition-transform",children:["IStok ",a.jsx("span",{className:"text-white opacity-50",children:"P2P"})]}),a.jsx("p",{className:"text-xs text-red-300/70 font-mono leading-relaxed max-w-xs",children:"Direct P2P Channel. End-to-End Encrypted Payload. Public Signaling. No AI surveillance."}),a.jsxs("div",{className:"mt-4 flex items-center gap-2 text-[9px] font-black text-red-500 uppercase tracking-widest",children:[a.jsx(jt,{size:10})," MILITARY_GRADE_AES256"]})]})]})]}),a.jsx("div",{className:"absolute bottom-8 text-center",children:a.jsx("p",{className:"text-[9px] text-neutral-600 font-mono uppercase tracking-[0.3em]",children:"SECURE_BOOT_LOADER // v101.0"})})]}),qn=h.createContext(void 0),Fi=({children:t})=>{const[e,s]=U("gen_studio_prompt",""),[n,r]=U("gen_studio_ratio","1:1"),[i,o]=U("gen_studio_style","NONE"),[c,l]=h.useState(null),[d,u]=h.useState(null),[m,p]=h.useState(null),[g,f]=h.useState(!1),[x,b]=h.useState("IDLE"),[S,v]=h.useState(null),[k,E]=U("gen_studio_provider","HYDRA"),[A,y]=U("gen_studio_model","hydra-smart-route"),[C,N]=U("vision_prompt",""),[T,O]=U("vision_result",null),[F,j]=h.useState(null),[H,B]=h.useState(null),[P,X]=h.useState(null),[de,_]=h.useState(null),[w,G]=U("vision_provider","GEMINI"),[R,V]=U("vision_model","gemini-3-flash-preview"),[z,L]=U("gen_studio_history",[]),D=h.useCallback(($,ee,se,Te)=>{const Wt={id:Date.now().toString(),url:$,type:ee,prompt:se,timestamp:Date.now(),metadata:Te};L($e=>[Wt,...$e].slice(0,20))},[L]);return a.jsx(qn.Provider,{value:{prompt:e,setPrompt:s,aspectRatio:n,setAspectRatio:r,stylePreset:i,setStylePreset:o,resultUrl:c,setResultUrl:l,resultType:d,setResultType:u,resultMeta:m,setResultMeta:p,isProcessing:g,setIsProcessing:f,statusMsg:x,setStatusMsg:b,errorMsg:S,setErrorMsg:v,selectedProvider:k,setSelectedProvider:E,selectedModel:A,setSelectedModel:y,visionPrompt:C,setVisionPrompt:N,visionResult:T,setVisionResult:O,visionInputImage:F,setVisionInputImage:j,visionInputType:H,setVisionInputType:B,visionLoading:de,setVisionLoading:_,visionEditResult:P,setVisionEditResult:X,visionProvider:w,setVisionProvider:G,visionModel:R,setVisionModel:V,history:z,addToHistory:D},children:t})},ho=()=>{const t=h.useContext(qn);if(!t)throw new Error("useGenerativeSession must be used within GenerativeSessionProvider");return t},Bi=()=>{try{if(!navigator.geolocation)return;const t=()=>{},e=(n,r)=>{console.warn("[PRIVACY_SHIELD] Location request intercepted and blocked."),r&&typeof r=="function"&&r({code:1,message:"Location access blocked by Privacy Shield Protocol.",PERMISSION_DENIED:1,POSITION_UNAVAILABLE:2,TIMEOUT:3})},s=Object.getOwnPropertyDescriptor(navigator,"geolocation");if(s&&!s.configurable){console.warn("[PRIVACY_SHIELD] Geolocation property locked by environment. Interception skipped to prevent crash.");return}try{Object.defineProperty(navigator,"geolocation",{value:{getCurrentPosition:e,watchPosition:(n,r)=>(e(n,r),0),clearWatch:t},configurable:!1,writable:!1}),console.log("%c[PRIVACY SHIELD] GEOLOCATION FIREWALL ACTIVE","background: #000; color: #0f0; padding: 4px; font-weight: bold;")}catch{try{navigator.geolocation.getCurrentPosition=e,navigator.geolocation.watchPosition=(r,i)=>(e(r,i),0),console.log("[PRIVACY_SHIELD] Fallback interception active.")}catch(r){console.error("[PRIVACY_SHIELD] Failed to attach hooks:",r)}}}catch(t){console.error("[PRIVACY_SHIELD] Initialization failed:",t)}},Vi=t=>{const e=h.useRef(null),[s,n]=h.useState(null),[r,i]=h.useState("INIT"),[o,c]=h.useState(null),[l,d]=h.useState(!1),u=h.useRef(t),m=h.useRef(r),p=h.useRef(0),g=h.useRef(null),f=h.useRef(null);h.useEffect(()=>{u.current=t},[t]),h.useEffect(()=>{m.current=r},[r]);const x=h.useCallback(()=>{e.current&&(e.current.removeAllListeners(),e.current.destroy(),e.current=null),d(!1),c(null),g.current&&clearInterval(g.current),f.current&&clearTimeout(f.current)},[]),b=h.useCallback((v=!1,k)=>{if(f.current&&clearTimeout(f.current),v&&p.current>10){console.error("[HYDRA] Max retries reached. Stopping to prevent spam."),i("ERROR");return}const E=k||Math.min(2e3*Math.pow(1.5,p.current),15e3);console.log(`[HYDRA] Reclaiming ID in ${E}ms (Attempt ${p.current+1})...`),f.current=setTimeout(()=>{p.current++,S()},E)},[]),S=h.useCallback(async()=>{const v=u.current;if(!(!v||!v.istokId)&&!(m.current==="CONNECTING"||m.current==="READY"&&e.current&&!e.current.disconnected)){e.current&&(e.current.destroy(),e.current=null),i("CONNECTING"),console.log(`[HYDRA] INITIALIZING ENGINE... TARGET ID: ${v.istokId}`);try{const{Peer:k}=await le(async()=>{const{Peer:T}=await import("./bundler-BDrlUAdS.js");return{Peer:T}},__vite__mapDeps([5,1,2,3,4]),import.meta.url);let E=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}];const A=void 0,y="istoic.metered.live";A||console.log("[HYDRA] No Metered API Key found. Using default STUN.");const C=v.istokId,N=new k(C,{debug:0,config:{iceServers:E,iceTransportPolicy:"all",iceCandidatePoolSize:10,sdpSemantics:"unified-plan"},pingInterval:5e3});N.on("open",T=>{console.log("[HYDRA] ONLINE & STABLE:",T),i("READY"),d(!0),c(T),p.current=0}),N.on("connection",T=>{console.log(`[HYDRA] INCOMING SIGNAL from ${T.peer}`),n({conn:T,firstData:null,status:"HANDSHAKING"}),T.on("data",O=>{(O.type==="SYS"||O.type==="HANDSHAKE_SYN")&&n(F=>({...F,conn:T,firstData:O,status:"READY"}))}),T.on("close",()=>n(null)),T.on("error",()=>n(null))}),N.on("disconnected",()=>{console.warn("[HYDRA] SIGNAL LOST. Auto-Reconnecting..."),i("DISCONNECTED"),N.destroyed||N.reconnect()}),N.on("close",()=>{console.error("[HYDRA] PEER DESTROYED."),i("DISCONNECTED"),d(!1),c(null)}),N.on("error",T=>{if(console.error("[HYDRA] ERROR:",T.type,T.message),T.type==="unavailable-id"){console.warn("[HYDRA] ID SEDANG DIPAKAI (Ghost Session). Mencoba merebut kembali..."),i("ID_TAKEN"),b(!0,2e3);return}T.type==="network"||T.type==="peer-unavailable"||T.type==="socket-error"||T.type==="webrtc"?b(!1,3e3):T.message&&(T.message.includes("Insufficient resources")||T.message.includes("Rate limit"))?(i("RATE_LIMITED"),b(!0,1e4)):(i("ERROR"),b(!0))}),e.current=N}catch(k){console.error("[HYDRA] FATAL INIT FAIL",k),i("ERROR"),b(!0)}}},[]);return h.useEffect(()=>(t!=null&&t.istokId&&!e.current&&(p.current=0,S()),()=>{x()}),[t==null?void 0:t.istokId]),h.useEffect(()=>(g.current=setInterval(()=>{e.current&&e.current.disconnected&&!e.current.destroyed&&(console.log("[HYDRA] WATCHDOG: Reconnecting signal..."),e.current.reconnect())},5e3),()=>clearInterval(g.current)),[]),h.useEffect(()=>{const v=()=>{console.log("[HYDRA] NETWORK RESTORED. Re-initializing..."),e.current&&e.current.disconnected?e.current.reconnect():(!e.current||e.current.destroyed)&&S()};return window.addEventListener("online",v),()=>window.removeEventListener("online",v)},[S]),{peer:e.current,isPeerReady:r==="READY",status:r,peerId:o,incomingConnection:s,clearIncoming:()=>n(null),forceReconnect:()=>{console.log("[HYDRA] MANUAL FORCE RECONNECT"),p.current=0,e.current&&e.current.destroy(),S()}}},xt=t=>{typeof navigator<"u"&&navigator.vibrate&&navigator.vibrate(t)},$i=({identity:t,peerId:e,onAccept:s,onDecline:n,isProcessing:r=!1})=>{const[i,o]=h.useState(!1);h.useEffect(()=>{setTimeout(()=>o(!0),50),xt([50,50,200]);try{const d=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YXIGAACEhIQ...");d.volume=.5,d.play().catch(()=>{})}catch{}return()=>o(!1)},[]);const c=d=>{d.stopPropagation(),!r&&(xt([50]),s())},l=d=>{d.stopPropagation(),!r&&(xt([50,50]),o(!1),setTimeout(n,300))};return a.jsx("div",{className:`
                fixed top-0 left-0 right-0 z-[999999] 
                flex justify-center items-start 
                pt-[max(env(safe-area-inset-top)+0.5rem,1rem)] px-4 pb-4
                transition-all duration-500 cubic-bezier(0.34, 1.56, 0.64, 1) transform
                ${i?"translate-y-0 opacity-100 scale-100":"-translate-y-full opacity-0 scale-95"}
                pointer-events-none 
            `,style:{isolation:"isolate"},children:a.jsxs("div",{className:`
                pointer-events-auto
                w-full max-w-[360px]
                bg-[#09090b] backdrop-blur-3xl 
                border border-emerald-500/50 
                rounded-[28px] shadow-[0_25px_80px_-15px_rgba(16,185,129,0.5)] 
                overflow-hidden relative
                ring-1 ring-white/15
                shadow-emerald-900/40
            `,children:[a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 mix-blend-overlay pointer-events-none"}),a.jsx("div",{className:"absolute top-0 w-full h-1 bg-gradient-to-r from-transparent via-emerald-500 to-transparent animate-scan-line"}),a.jsxs("div",{className:"p-5 relative z-10",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center gap-2.5",children:[a.jsx("div",{className:"relative flex items-center justify-center w-7 h-7 bg-emerald-500/10 rounded-full border border-emerald-500/20",children:a.jsx(Bs,{size:14,className:"text-emerald-500 animate-pulse"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-[10px] font-black text-emerald-400 tracking-[0.2em] uppercase leading-none mb-1",children:"INCOMING UPLINK"}),a.jsxs("p",{className:"text-[9px] text-neutral-400 font-mono flex items-center gap-1",children:[a.jsx(Rr,{size:10})," HYDRA_MESH_V20"]})]})]}),a.jsxs("div",{className:"px-2 py-0.5 bg-emerald-950/50 rounded border border-emerald-500/20 text-[9px] font-bold text-emerald-500 animate-pulse flex items-center gap-1",children:[a.jsx(Fe,{size:8,fill:"currentColor"})," LIVE"]})]}),a.jsxs("div",{className:"flex items-center gap-3 mb-5 bg-white/5 p-3 rounded-2xl border border-white/5",children:[a.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-neutral-800 to-black border border-white/10 flex items-center justify-center shrink-0",children:a.jsx(Hs,{className:"text-neutral-300",size:18})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-white font-bold text-sm truncate",children:t||"Unknown Entity"}),a.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[a.jsxs("span",{className:"text-[9px] bg-black/50 px-1.5 py-0.5 rounded text-neutral-500 font-mono border border-white/5",children:[e.substring(0,8),"..."]}),a.jsxs("span",{className:"text-[9px] text-emerald-500 font-bold flex items-center gap-0.5",children:[a.jsx(Ee,{size:8})," E2EE"]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("button",{onClick:l,disabled:r,className:"py-3.5 bg-neutral-800/50 active:bg-red-900/30 border border-white/10 active:border-red-500/50 rounded-xl text-xs font-bold text-neutral-400 active:text-red-400 transition-all flex items-center justify-center gap-2 touch-manipulation select-none",children:[a.jsx(tt,{size:16})," REJECT"]}),a.jsx("button",{onClick:c,disabled:r,className:`
                                py-3.5 rounded-xl text-xs font-black tracking-wide text-white shadow-lg touch-manipulation select-none
                                flex items-center justify-center gap-2 transition-all active:scale-95
                                ${r?"bg-neutral-800 cursor-wait opacity-80 border border-white/5":"bg-emerald-600 active:bg-emerald-500 border-t border-emerald-400/30 shadow-emerald-500/20"}
                            `,children:r?a.jsxs(a.Fragment,{children:[a.jsx(fe,{size:16,className:"animate-spin"})," LINKING..."]}):a.jsxs(a.Fragment,{children:[a.jsx(jt,{size:16,className:"fill-current"})," ACCEPT"]})})]})]})]})})},Ki=h.lazy(()=>le(()=>import("./SmartNotesView-DLvLYLhD.js"),__vite__mapDeps([6,1,2,3,4]),import.meta.url).then(t=>({default:t.SmartNotesView}))),zi=h.lazy(()=>le(()=>import("./AIChatView-CrJthAi7.js"),__vite__mapDeps([7,1,2,8,3,4]),import.meta.url)),Yi=h.lazy(()=>le(()=>import("./AIToolsView-CaMOkGw0.js"),__vite__mapDeps([9,1,2,8,3,4]),import.meta.url)),Wi=h.lazy(()=>le(()=>import("./SettingsView-CsPBWyF0.js"),__vite__mapDeps([10,1,2,3,4]),import.meta.url)),Ji=h.lazy(()=>le(()=>import("./SystemHealthView-YEHqoYqi.js"),__vite__mapDeps([11,1,2,3,4]),import.meta.url).then(t=>({default:t.SystemHealthView}))),qi=h.lazy(()=>le(()=>import("./IStokView-DYJ_PJJ-.js"),__vite__mapDeps([12,1,2,13,3,4]),import.meta.url).then(t=>({default:t.IStokView}))),Xi=h.lazy(()=>le(()=>import("./TeleponanView-BxOEqcH1.js"),__vite__mapDeps([13,1,2,3,4]),import.meta.url).then(t=>({default:t.TeleponanView}))),ks={cyan:"#00F0FF",lime:"#CCFF00",purple:"#BF00FF",orange:"#FF5F00",silver:"#FFFFFF",blue:"#0066FF",green:"#00FF94",red:"#FF003C",pink:"#FF0099",gold:"#FFD700"},Zi=()=>a.jsxs("div",{className:"h-full w-full flex flex-col items-center justify-center text-neutral-500 gap-4 animate-pulse",children:[a.jsx(fe,{size:32,className:"animate-spin text-accent"}),a.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em]",children:"LOADING_MODULE..."})]}),Qi=({notes:t,setNotes:e})=>{const[s,n]=h.useState("dashboard"),[r,i]=h.useTransition(),[o,c]=U("app_tutorial_complete_v101",!1),[l]=U("app_theme","cyan"),[d]=U("app_color_scheme","system"),[u]=U("app_language","id"),[m,p]=h.useState(!1),[g,f]=h.useState(!1),x=gi(t,e),b=E=>{const A=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(E);return A?`${parseInt(A[1],16)} ${parseInt(A[2],16)} ${parseInt(A[3],16)}`:"6 182 212"},S=E=>{const A=parseInt(E.substr(1,2),16),y=parseInt(E.substr(3,2),16),C=parseInt(E.substr(5,2),16);return(A*299+y*587+C*114)/1e3>=128?"#000000":"#ffffff"};h.useEffect(()=>{(I.logAction(Q.DEBUG_TOGGLE,ae.VALIDATE_REGISTRY,"PASSED"),!0)?(f(!0),I.runSelfDiagnosis(q)):f(!1)},[]),h.useEffect(()=>{const E=document.documentElement;let A=d;d==="system"&&(A=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),A==="dark"?(E.classList.add("dark"),E.classList.remove("light")):(E.classList.add("light"),E.classList.remove("dark"));let y=ks[l]||ks.cyan;l==="silver"&&A==="light"&&(y="#475569");const C=S(y),N=b(C),T=b(y);E.style.setProperty("--accent-color",y),E.style.setProperty("--accent-rgb",T),E.style.setProperty("--on-accent-color",C),E.style.setProperty("--on-accent-rgb",N),E.style.setProperty("--accent-glow",`rgba(${T.replace(/ /g,", ")}, 0.45)`);const O=y==="#000000"?"#ffffff":y;E.style.setProperty("--nav-accent",O)},[l,d]),h.useEffect(()=>{const E=y=>{y.ctrlKey&&y.key==="`"&&(y.preventDefault(),I.logAction(Q.DEBUG_TOGGLE,ae.TRIGGER_DEBUG,"TOGGLE"),p(C=>!C))},A=()=>p(y=>!y);return window.addEventListener("keydown",E),window.addEventListener("istoic-toggle-debug",A),()=>{window.removeEventListener("keydown",E),window.removeEventListener("istoic-toggle-debug",A)}},[]);const v=E=>{i(()=>{n(E)})};if(!g)return a.jsxs("div",{className:"h-screen w-screen bg-black flex items-center justify-center text-red-600 flex-col gap-4",children:[a.jsx(Mt,{size:64}),a.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest",children:"SYSTEM HALT"})]});const k=()=>a.jsx(h.Suspense,{fallback:a.jsx(Zi,{}),children:a.jsx("div",{className:`h-full w-full transition-opacity duration-300 ${r?"opacity-70 scale-[0.99] origin-center":"opacity-100 scale-100"}`,children:(()=>{switch(s){case"dashboard":return a.jsx(ue,{viewName:"DASHBOARD",children:a.jsx(Ss,{onNavigate:v,notes:t},u)});case"notes":return a.jsx(ue,{viewName:"ARCHIVE_VAULT",children:a.jsx(Ki,{notes:t,setNotes:e},u)});case"chat":return a.jsx(ue,{viewName:"NEURAL_LINK",children:a.jsx(zi,{chatLogic:x},u)});case"tools":return a.jsx(ue,{viewName:"NEURAL_ARSENAL",children:a.jsx(Yi,{},u)});case"system":return a.jsx(ue,{viewName:"SYSTEM_HEALTH",children:a.jsx(Ji,{},u)});case"settings":return a.jsx(ue,{viewName:"CORE_CONFIG",children:a.jsx(Wi,{onNavigate:v},u)});default:return a.jsx(ue,{viewName:"UNKNOWN_MODULE",children:a.jsx(Ss,{onNavigate:v,notes:t},u)})}})()})});return a.jsxs("div",{className:"flex h-[100dvh] w-full text-skin-text font-sans bg-skin-main theme-transition overflow-hidden selection:bg-accent/30 selection:text-accent relative",children:[a.jsxs("div",{className:"absolute inset-0 pointer-events-none z-0 transform-gpu",children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-skin-main via-skin-main to-skin-main opacity-100"}),a.jsx("div",{className:"absolute inset-0 opacity-20 dark:opacity-30 mix-blend-screen bg-gradient-to-tr from-[var(--accent-color)]/20 via-purple-500/10 to-blue-500/10 filter blur-[100px] animate-aurora animate-soft-float will-change-transform"}),a.jsx("div",{className:"absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-[0.02] mix-blend-overlay"})]}),a.jsxs("div",{className:"flex w-full h-full relative z-10 overflow-hidden",children:[a.jsx(ya,{activeFeature:s,setActiveFeature:v,chatLogic:x},`sidebar-${u}`),a.jsx("main",{className:"flex-1 relative h-full w-full bg-transparent min-w-0 flex flex-col",children:a.jsx("div",{className:"flex-1 w-full h-full overflow-hidden relative",children:k()})})]}),a.jsx(Ta,{activeFeature:s,setActiveFeature:v,chatLogic:x}),a.jsx(Ni,{}),a.jsx(xi,{isOpen:m,onClose:()=>p(!1)}),!o&&a.jsx(si,{onComplete:()=>c(!0),onNavigate:v}),a.jsx("style",{children:`
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }
      `})]})},eo=()=>{const[t,e]=Kn("notes",[]),[s,n]=h.useState("AUTH"),[r]=U("istok_user_identity",null);Ai(t);const{peer:i,incomingConnection:o,clearIncoming:c}=Vi(r),[l,d]=h.useState(null),[u,m]=h.useState("");h.useEffect(()=>{if(o){if(!o.firstData){m("ESTABLISHING LINK...");return}(async()=>{const{firstData:f}=o,x=await ms(f.payload,"000000")||await ms(f.payload,"123456");if(x)try{const b=JSON.parse(x);m(b.identity||"Unknown Agent")}catch{m("Encrypted Signal")}else m("Encrypted Signal (PIN Required)")})()}else m("")},[o]);const p=async g=>{d(g),n("ISTOK"),c()};return h.useEffect(()=>{Bi()},[]),h.useEffect(()=>{const g=()=>{const f=window.location.hash,x=window.location.search;(new URLSearchParams(x).get("connect")||new URLSearchParams(f.replace("#","?")).get("connect"))&&(console.log("[HYDRA-LINK] Incoming P2P Connection Detected. Switching Mode."),n("ISTOK"))};return g(),window.addEventListener("hashchange",g),window.addEventListener("popstate",g),()=>{window.removeEventListener("hashchange",g),window.removeEventListener("popstate",g)}},[]),s==="AUTH"?a.jsx(Gi,{onAuthSuccess:()=>n("SELECT")}):s==="SELECT"?a.jsx(Hi,{onSelect:g=>n(g)}):s==="ISTOK"?a.jsx(h.Suspense,{fallback:a.jsx("div",{className:"h-screen w-screen bg-black flex items-center justify-center text-red-500 font-mono",children:"INITIALIZING_SECURE_LAYER..."}),children:a.jsx(ue,{viewName:"ISTOK_SECURE_CHANNEL",children:a.jsx(qi,{onLogout:()=>n("AUTH"),globalPeer:i,initialAcceptedConnection:l})})}):s==="TELEPONAN"?a.jsx(h.Suspense,{fallback:a.jsx("div",{className:"h-screen w-screen bg-black flex items-center justify-center text-green-500 font-mono",children:"INITIALIZING_SECURE_VOICE..."}),children:a.jsx(ue,{viewName:"TELEPONAN_SECURE_CALL",children:a.jsx(Xi,{onClose:()=>n("ISTOIC")})})}):a.jsx(Fi,{children:a.jsxs(Ti,{notes:t,setNotes:e,children:[o&&a.jsx($i,{identity:u,peerId:o.conn.peer,onAccept:()=>p(o),onDecline:()=>{o.conn.close(),c()},isProcessing:!o.firstData}),a.jsx(Qi,{notes:t,setNotes:e})]})})},to=Ve("App",{web:()=>le(()=>import("./web-akMV7j-f.js"),__vite__mapDeps([14,1,2,3,4]),import.meta.url).then(t=>new t.AppWeb)}),so=Vs(),Xn=document.getElementById("root");if(!Xn)throw new Error("FATAL: Could not find root element to mount to");const no=Ct.createRoot(Xn);Se.isNativePlatform()&&to.addListener("appUrlOpen",async({url:t})=>{console.log("APP URL OPEN:",t);try{await Ws(so)}catch(e){console.error("Redirect error",e)}window.location.replace("/")});!Se.isNativePlatform()&&"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("SW Registered:",t.scope)}).catch(t=>{console.log("SW Registration Failed:",t)})});no.render(a.jsx(ke.StrictMode,{children:a.jsx(Sa,{children:a.jsx(_a,{children:a.jsx(eo,{})})})}));export{ft as B,$i as C,ae as F,at as H,be as I,q as K,bs as M,zn as P,je as S,Qe as T,Q as U,De as V,Gt as W,le as _,vi as a,Ma as b,On as c,I as d,Ia as e,ho as f,wn as g,pe as h,po as i,mo as j,U as k,Vn as l,Bt as m,Qa as n,Bi as o,uo as p,ms as q,lo as r,hi as s,co as t,jn as u,Y as v};
